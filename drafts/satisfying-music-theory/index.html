<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, shrink-to-fit=no">

		<meta property="og:title" content="Darius Foo">
		<meta property="og:type" content="article">
		<meta property="og:url" content="https://dariusf.github.io">
		<meta property="og:image" content="https://dariusf.github.io/avatar.png">

		<title>Satisfying Music Theory I</title>
		<meta name="description" content="PhD student, programming languages and formal verification">
		<link rel="alternate" href="/feed/feed.xml" type="application/atom+xml" title="Darius Foo">


		

		

		

		

		
		
		<style>@media (prefers-color-scheme: light) { /**
 * prism.js default theme for JavaScript, CSS and HTML
 * Based on dabblet (http://dabblet.com)
 * @author Lea Verou
 */

code[class*="language-"],
pre[class*="language-"] {
	color: black;
	background: none;
	text-shadow: 0 1px white;
	font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
	font-size: 1em;
	text-align: left;
	white-space: pre;
	word-spacing: normal;
	word-break: normal;
	word-wrap: normal;
	line-height: 1.5;

	-moz-tab-size: 4;
	-o-tab-size: 4;
	tab-size: 4;

	-webkit-hyphens: none;
	-moz-hyphens: none;
	-ms-hyphens: none;
	hyphens: none;
}

pre[class*="language-"]::-moz-selection, pre[class*="language-"] ::-moz-selection,
code[class*="language-"]::-moz-selection, code[class*="language-"] ::-moz-selection {
	text-shadow: none;
	background: #b3d4fc;
}

pre[class*="language-"]::selection, pre[class*="language-"] ::selection,
code[class*="language-"]::selection, code[class*="language-"] ::selection {
	text-shadow: none;
	background: #b3d4fc;
}

@media print {
	code[class*="language-"],
	pre[class*="language-"] {
		text-shadow: none;
	}
}

/* Code blocks */
pre[class*="language-"] {
	padding: 1em;
	margin: .5em 0;
	overflow: auto;
}

:not(pre) > code[class*="language-"],
pre[class*="language-"] {
	background: #f5f2f0;
}

/* Inline code */
:not(pre) > code[class*="language-"] {
	padding: .1em;
	border-radius: .3em;
	white-space: normal;
}

.token.comment,
.token.prolog,
.token.doctype,
.token.cdata {
	color: slategray;
}

.token.punctuation {
	color: #999;
}

.token.namespace {
	opacity: .7;
}

.token.property,
.token.tag,
.token.boolean,
.token.number,
.token.constant,
.token.symbol,
.token.deleted {
	color: #905;
}

.token.selector,
.token.attr-name,
.token.string,
.token.char,
.token.builtin,
.token.inserted {
	color: #690;
}

.token.operator,
.token.entity,
.token.url,
.language-css .token.string,
.style .token.string {
	color: #9a6e3a;
	/* This background color was intended by the author of this theme. */
	background: hsla(0, 0%, 100%, .5);
}

.token.atrule,
.token.attr-value,
.token.keyword {
	color: #07a;
}

.token.function,
.token.class-name {
	color: #DD4A68;
}

.token.regex,
.token.important,
.token.variable {
	color: #e90;
}

.token.important,
.token.bold {
	font-weight: bold;
}
.token.italic {
	font-style: italic;
}

.token.entity {
	cursor: help;
}
 }
@media (prefers-color-scheme: dark) { /**
 * prism.js tomorrow night eighties for JavaScript, CoffeeScript, CSS and HTML
 * Based on https://github.com/chriskempson/tomorrow-theme
 * @author Rose Pritchard
 */

code[class*="language-"],
pre[class*="language-"] {
	color: #ccc;
	background: none;
	font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
	font-size: 1em;
	text-align: left;
	white-space: pre;
	word-spacing: normal;
	word-break: normal;
	word-wrap: normal;
	line-height: 1.5;

	-moz-tab-size: 4;
	-o-tab-size: 4;
	tab-size: 4;

	-webkit-hyphens: none;
	-moz-hyphens: none;
	-ms-hyphens: none;
	hyphens: none;

}

/* Code blocks */
pre[class*="language-"] {
	padding: 1em;
	margin: .5em 0;
	overflow: auto;
}

:not(pre) > code[class*="language-"],
pre[class*="language-"] {
	background: #2d2d2d;
}

/* Inline code */
:not(pre) > code[class*="language-"] {
	padding: .1em;
	border-radius: .3em;
	white-space: normal;
}

.token.comment,
.token.block-comment,
.token.prolog,
.token.doctype,
.token.cdata {
	color: #999;
}

.token.punctuation {
	color: #ccc;
}

.token.tag,
.token.attr-name,
.token.namespace,
.token.deleted {
	color: #e2777a;
}

.token.function-name {
	color: #6196cc;
}

.token.boolean,
.token.number,
.token.function {
	color: #f08d49;
}

.token.property,
.token.class-name,
.token.constant,
.token.symbol {
	color: #f8c555;
}

.token.selector,
.token.important,
.token.atrule,
.token.keyword,
.token.builtin {
	color: #cc99cd;
}

.token.string,
.token.char,
.token.attr-value,
.token.regex,
.token.variable {
	color: #7ec699;
}

.token.operator,
.token.entity,
.token.url {
	color: #67cdcc;
}

.token.important,
.token.bold {
	font-weight: bold;
}
.token.italic {
	font-style: italic;
}

.token.entity {
	cursor: help;
}

.token.inserted {
	color: green;
}
 }
/* This is an arbitrary CSS string added to the bundle */
:root {
	/* --font-family: -apple-system, system-ui, sans-serif; */
	/* --font-family-monospace: Consolas, Menlo, Monaco, Andale Mono WT, Andale Mono, Lucida Console, Lucida Sans Typewriter, DejaVu Sans Mono, Bitstream Vera Sans Mono, Liberation Mono, Nimbus Mono L, Courier New, Courier, monospace;
	*/

    --font-family-monospace: Fira Code, Menlo, Consolas, Monaco, Liberation Mono, Lucida Console, monospace;


  /*    --text-font: Crimson Text, serif;*/
  /*    --text-font: Poppins, Verdana, sans-serif;*/
  /*    --heading-font: Quicksand, sans-serif;*/
  /*    --text-font: Open Sans, sans-serif;*/
  /*    --text-font-size: 16px;*/
  /*    --heading-font: Open Sans, sans-serif;*/
  /*    --text-font: Cabin, sans-serif;*/
  /*    --text-font-size: 16px;*/
  /*    --text-font: Roboto, sans-serif;*/

  /*    --heading-font: Roboto, sans-serif;*/
  /*    --heading-font: Cabin, sans-serif;*/
  /*    --heading-font: Dosis, sans-serif;*/

  /*    --heading-font: Work Sans, sans-serif;*/
  /*    --text-font: Open Sans, sans-serif;*/

      /* --heading-font: Nunito, sans-serif; */
      --heading-font: ui-rounded, 'Hiragino Maru Gothic ProN', Quicksand, Comfortaa, Manjari, 'Arial Rounded MT', 'Arial Rounded MT Bold', Calibri, source-sans-pro, sans-serif;
  /*    --text-font: PT Sans, sans-serif;*/

  /*    --heading-font: Varela Round, sans-serif;*/
  /*    --text-font: Noto Serif, serif;*/

  /*    --text-font: Lato, sans-serif;*/
      --text-font-size: 17px;

  /*    --text-font: Merriweather, sans-serif;*/
  /*    --text-font-size: 16px;*/

  /* https://css-tricks.com/snippets/css/system-font-stack/ */
  /* https://systemfontstack.com/ */

    /* system font on all platforms */
  /*    --heading-font: -apple-system, system-ui, BlinkMacSystemFont, "Segoe UI", Roboto, Ubuntu;*/
      /* --text-font: -apple-system, system-ui, BlinkMacSystemFont, "Segoe UI", Roboto, Ubuntu; */
      --text-font: -apple-system, system-ui, sans-serif;
			/* system-ui, sans-serif; */


/* Theme colors */

	/* --color-gray-20: #e0e0e0;
	--color-gray-50: #C0C0C0;
	--color-gray-90: #333; */

	--background-color: #fff;

	/* --text-color: var(--color-gray-90); */
	/* --text-color-link: #082840; */

	/* --text-color-link: #ff0000; */
	/* --text-color-link-active: #5f2b48; */
	/* --text-color-link-visited: #17050F; */


	/* --syntax-tab-size: 2; */

	--bright-text-color: #222;
	--link-color: #3273dc;
	/* --link-color: #ff5e6c; */
	--link-visited-color: #6e4bbe;
	--background-color: #fff;
	--text-color: #444;
	--faded-text-color: #777;
	--blockquote-text-color: var(--bright-text-color);
	--faint-color: #ccc;
}

@media (prefers-color-scheme: dark) {
	:root {
		/* --color-gray-20: #e0e0e0; */
		/* --color-gray-50: #C0C0C0; */
		/* --color-gray-90: #dad8d8; */

		/* --text-color is assigned to --color-gray-_ above */
		/* --text-color-link: #1493fb; */
		/* --text-color-link-active: #6969f7; */
		/* --text-color-link-visited: #a6a6f8; */

		--background-color: #15202b;

		--bright-text-color: #eee;
		--link-color: #8cc2dd;
		--link-visited-color: #b9a9e0;
		--background-color: #333;
		--text-color: #ddd;
		--faded-text-color: #aaa;
		--slightly-dimmer-text-color: #ccc;
		--blockquote-text-color: var(--slightly-dimmer-text-color);
		--faint-color: #666;

		color-scheme: dark; /* sets scrollbar colour */
	}

	.theme-affected {
		filter: invert(.8);
	}
}

body {
	box-sizing: border-box;

	/* https://github.com/sindresorhus/github-markdown-css */
	min-width: 200px;
	/* max from old blog */
	/* max-width: 40em; */
	/* tiny bit wider because prism adds some padding */
	max-width: 726px;

	margin: 0 auto;
	padding: 0 20px;

	/* enable ligatures */
	text-rendering: optimizeLegibility;

	font-family: var(--text-font);
	font-size: var(--text-font-size);
	color: var(--text-color);
	background-color: var(--background-color);

	/*
	text-align: left;
	word-wrap: break-word;
	overflow-wrap: break-word;
	*/
	/* line-height: 1.5; */
}

@media (max-width: 767px) {
	body {
		padding: 0px 1em;
	}
}

@view-transition {
	navigation: auto;
}

html {
	overflow-y: scroll;
}

/* https://github.com/Kimeiga/bahunya/blob/master/src/parts/_typography.css */
ul, ol {
  padding-left: 2em;
}

li {
	line-height: 1.5;
}

h1, h2, h3, h4, h5, h6 {
	font-family: var(--heading-font);
	color: var(--bright-text-color);
	font-weight: normal;
	line-height: 1.25;
}

footer {
	padding: 35px;
}

/* header {
	border-bottom: 1px dashed var(--color-gray-20);
} */


/* misc changes from here on */

/* https://www.a11yproject.com/posts/how-to-hide-content/ */
.visually-hidden {
	clip: rect(0 0 0 0);
	clip-path: inset(50%);
	height: 1px;
	overflow: hidden;
	position: absolute;
	white-space: nowrap;
	width: 1px;
}

p:has(img) {
	text-align: center;
}
/* Fluid images via https://www.zachleat.com/web/fluid-images/ */
img{
  max-width: 100%;
}
img[width][height] {
  height: auto;
}
/* img[src$=".svg"] {
  width: 100%;
  height: auto;
  max-width: none;
} */
video,
iframe {
	width: 100%;
	height: auto;
}
iframe {
	aspect-ratio: 16/9;
}

p:last-child {
	margin-bottom: 0;
}
p {
	line-height: 1.5;
}

a[href] {
	color: var(--link-color);
	text-decoration: none;
}

/* a[href]:visited {
	color: var(--link-visited-color);
} */

/* a[href]:hover,
a[href]:active { */
	/* color: var(--text-color-link-active); */
	/* text-decoration: underline; */
	/* text-decoration-thickness: 2px; */
/* } */

/* main :first-child {
	margin-top: 0;
} */

/* .links-nextprev {
	display: flex;
	justify-content: space-between;
	gap: .5em 1em;
	list-style: "";
	border-top: 1px dashed var(--color-gray-20);
	padding: 1em 0;
}
.links-nextprev > * {
	flex-grow: 1;
}
.links-nextprev-next {
	text-align: right;
} */

table {
	margin: 1em 0;
	border-collapse: collapse;
}
table td,
table th {
	padding-right: 1em;
}
/* table thead tr th {
  border-bottom: solid var(--text-color) 2px;
  border-top: solid var(--text-color) 2px;
} */

.table-lines td {
  border-bottom: solid var(--text-color) 1px;
  border-top: solid var(--text-color) 1px;
}

/* pre,
code {
	font-family: var(--font-family-monospace) !important;
	font-size: 14px !important;
} */

/* override prism */
/* https://github.com/orgs/PrismJS/discussions/2859 */
code[class*="language-"],
pre[class*="language-"] {
	font-family: var(--font-family-monospace);
	font-size: 14px;
}

pre[class*="language-"] {
	margin-top: 0;
	margin-bottom: 1em;
}

pre:not([class*="language-"]) {
	margin: .5em 0;
	line-height: 1.375; /* 22px /16 */
	/* -moz-tab-size: var(--syntax-tab-size); */
	/* -o-tab-size: var(--syntax-tab-size); */
	/* tab-size: var(--syntax-tab-size); */
	-webkit-hyphens: none;
	-ms-hyphens: none;
	hyphens: none;
	direction: ltr;
	text-align: left;
	white-space: pre;
	word-spacing: normal;
	word-break: normal;
	overflow-x: auto;
}

.scroll-when-overflowing, pre {
	overflow-x: scroll;
  -ms-overflow-style: none;  /* IE and Edge */
  scrollbar-width: none;  /* Firefox */
}

.scroll-when-overflowing::-webkit-scrollbar, pre::-webkit-scrollbar {
  display: none;
}

/* mathjax v4, where display math is not centered */
mjx-container {
	margin: auto;
}
header {
			/* display: flex; */
			/* gap: 2em; */
			border-right: 10px;
			/* flex-wrap: wrap; */
			/* justify-content: space-between; */
			/* align-items: center; */
			align-items: end;
			padding-top: 1em;
			/* padding: 1em; */
		}
.nav-item {
				font-family: var(--heading-font);
				padding-right: 5px;
				display: inline-block;
			}
			
			.nav-item a[href][aria-current="page"] {
				text-decoration: underline;
				text-decoration-thickness: 2px;
			}</style>
	</head>
	<body>
		<a href="#skip" class="visually-hidden">Skip to main content</a>

		

		<header>

			
			
			
			<a href="/" style="padding-right: 10px; color: var(--text-color); font-family: var(--heading-font); font-size: 1.5em;">Darius Foo</a>
			
				
				
				
				
				
				
			
			
			<nav style="display: inline-block">
				<h2 class="visually-hidden" id="top-level-navigation-menu">Top level navigation menu</h2>
				<ul style="list-style: none; padding: 0; margin: 0;">
					<li class="nav-item"><a href="/blog/">Blog</a></li>
					<li class="nav-item"><a href="/research/">Research</a></li>
					<li class="nav-item"><a href="/work/">Work</a></li>
					<li class="nav-item"><a href="/games/">Games</a></li>
				</ul>
			</nav>
		</header>

		<main id="skip">
			

<h1 style="margin-top: 1rem; margin-bottom: 0.2em" id="satisfying-music-theory-i">Satisfying Music Theory I</h1>



<div class="post-metadata">
	
	<time style="font-size: 0.9em;" datetime="2022-12-30">30 Dec 2022</time>
	
	
</div>

<div class="blog-content">
<script src="./abcjs-basic-min.js"></script>
<link rel="stylesheet" type="text/css" href="./abcjs-audio.css">
<script src="./abcjs-driver.js"></script>
<!-- TLDR -->
<span id="joy1">
%%staves vs va vt (vch vb)
X: 1
T: Joy to the World
L: 1/16
K: C
M: 4/4
Q: 1/4=100
V: vs name="S"
V: va name="A"
V: vt name="T"  clef=treble-8
V: vb name="B"  clef=bass middle=d transpose=-24
V: vch name=" "
%
V: vs
%%MIDI program 40
c4 B3 A1 G6 F2 | E4 D4 C6 G2 | A6 A2 B6 B2 | c6 c2 c2 B2 A2 G2 |
 G3 F1 E2 c2 c2 B2 A2 G2 | G3 F1 E2 E2 E2 E2 E2 E1 F1 | G6 G1 F1 D2 D2 D2 D1 E1 | F6 E1 D1 C2 c4 A2 |
 G3 F1 E2 F2 E4 D4 | C8 ||
V: va
%%MIDI program 41
e4 G3 e1 d6 A2 | e4 B4 e6 d2 | e6 e2 d6 d2 | e6 A2 f2 e2 c2 d2 |
 B3 F1 e2 e2 e2 d2 e2 d2 | d3 f1 e2 e2 e2 e2 e2 c1 f1 | d6 d1 f1 d2 d2 d2 d1 e1 | F6 e1 d1 e2 c4 e2 |
 d3 f1 e2 f2 e4 d4 | e8 ||
V: vt
%%MIDI program 42
c4 B3 C1 B6 c2 | c4 B4 c6 B2 | c6 c2 B6 B2 | c6 c2 c2 G2 c2 B2 |
 B3 c1 c2 c2 c2 B2 c2 B2 | B3 c1 c2 C2 c2 c2 c2 C1 c1 | B6 B1 c1 B2 B2 B2 B1 c1 | c6 c1 B1 c2 c4 c2 |
 B3 c1 c2 c2 c4 B4 | c8 ||
V: vb
%%MIDI program 42
e4 d3 e1 d6 c2 | e4 d4 e6 d2 | e6 e2 d6 d2 | e6 e2 c2 e2 e2 d2 |
 d3 c1 e2 e2 e2 d2 e2 d2 | G3 c1 e2 e2 e2 e2 e2 E1 c1 | d6 d1 c1 d2 d2 G2 d1 e1 | c6 e1 d1 e2 e4 e2 |
 d3 c1 e2 c2 e4 G4 | e8 ||
V: vch
"vi"x4 "V"x3 "vi"x1 "V"x6 "IV"x2 | "vi"x4 "V"x4 "vi"x6 "V"x2 | "vi"x6 "vi"x2 "V"x6 "V"x2 | "vi"x6 "vi"x2 "IV"x2 "iii"x2 "vi"x2 "V"x2 |
 "V"x3 "IV"x1 "vi"x2 "vi"x2 "vi"x2 "V"x2 "vi"x2 "V"x2 | "V"x3 "IV"x1 "vi"x2 "vi"x2 "vi"x2 "vi"x2 "vi"x2 "I"x1 "IV"x1 | "V"x6 "V"x1 "IV"x1 "V"x2 "V"x2 "V"x2 "V"x1 "vi"x1 | "IV"x6 "vi"x1 "V"x1 "vi"x2 "vi"x4 "vi"x2 |
 "V"x3 "IV"x1 "vi"x2 "IV"x2 "vi"x4 "V"x4 | "vi"x8 ||
</span>
<script>
// renderMusicIn('joy1', {viewportHorizontal: false, scrollHorizontal: true});
renderMusicIn('joy1');
// renderMusicIn('joy1', { wrap: { minSpacing: 1.8, maxSpacing: 2.7, preferredMeasuresPerLine: 10 } });
for (const v of [1, 2, 3, 4]) {
  for (const e of document.querySelectorAll(`#joy1 .abcjs-v${v}.abcjs-note`)) {
    e.classList.add('generated');
  }
}
for (const e of document.querySelectorAll(`#joy1 .abcjs-chord`)) {
  e.classList.add('generated');
}
</script>
<p>Reharmonization of Joy to the World. The melody is given and the other voices are subject to basic homophonic harmony constraints.</p>
<span id="joy2">
%%staves vs va vt (vch vb)
X: 1
T: Joy to the World
L: 1/16
K: C
M: 4/4
Q: 1/4=100
V: vs name="S"
V: va name="A"
V: vt name="T"  clef=treble-8
V: vb name="B"  clef=bass middle=d transpose=-24
V: vch name=" "
%
V: vs
%%MIDI program 40
c4 B3 A1 G6 F2 | E4 D4 C6 G2 | A6 A2 B6 B2 | c6 c2 c2 B2 A2 G2 |
 G3 F1 E2 c2 c2 B2 A2 G2 | G3 F1 E2 E2 E2 E2 E2 E1 F1 | G6 G1 F1 D2 D2 D2 D1 E1 | F6 E1 D1 C2 c4 A2 |
 G3 F1 E2 F2 E4 D4 | C8 ||
V: va
%%MIDI program 41
G1 G1 F2 e6 (cc6 | cc2)  c1 G6 G6 (cc1 | cc4-c2-c1)  A1 B8 | G1 G4 G1 G2 c2 e2 A2 B2 |
 B1 G1 d1 A1 G8 F1 F1 (GG2 | GG1)  c2 F1 A1 e1 G1 e1 G1 e3 G1 G1 c1 (cc1 | cc2)  G3 d8 d1 d1 G1 | A4 F1 f1 c1 G1 A8 |
 G2 G1 f1 A8 G1 d3 | e8 ||
V: vt
%%MIDI program 42
C4 E4 G1 (CC4-C2-C1 | CC1)  c2 G8 E4 (cc1 | cc4-c2-c1)  F1 B1 G6 G1 | E2 E4 C1 E1 C1 C1 B1 G1 C1 E2 (GG1 | GG3)
 A1 G8 A2 c1 (EE1 | EE3)  F1 C1 C1 C1 E1 C1 C1 C1 E1 B1 E1 (cc2 | cc4)  D8 G2 G1 (CC1 | CC2)  C3 C1 G2 F1 A2 A2 C3 |
 C3 A1 C6 A2 D4 | c8 ||
V: vb
%%MIDI program 42
e1 c1 F2 E4 G4 (cc4 | cc4)  d4 c8 | c6 c1 F1 B2 G4 (GG2 | GG6)  E4 G2 c1 E1 (EE2 | EE1)
 d3 E3 E3 E1 E1 F1 F1 (ee2 | ee2)  G1 d1 c2 E2 E3 E2 B1 c2 | c2 G1 G3 d2 d4 G1 G1 G1 (cc1 | cc4-c2-c1)  d1 F1 A1 F1 F1 F1 F1 F2 |
 c8 E4 G2 G2 | e8 ||
V: vch
"I"x1 "I"x1 "IV"x2 "iii"x3 "vi"x1 "I"x6 "IV"x1 "IV"x1 | "I"x4 "V"x4 "I"x8 | "IV"x8 "V"x8 | "I"x6 "I"x4 "iii"x2 "IV"x1 "vi"x1 "iii"x1 "iii"x1 |
 "iii"x1 "V"x2 "ii"x1 "I"x6 "iii"x2 "ii"x2 "I"x2 | "I"x2 "I"x1 "ii"x1 "vi"x1 "vi"x1 "I"x4 "I"x2 "iii"x2 "I"x1 "IV"x1 | "I"x3 "I"x1 "V"x3 "ii"x1 "ii"x4 "V"x2 "V"x1 "I"x1 | "IV"x6 "I"x1 "V"x1 "IV"x4 "IV"x4 |
 "I"x3 "IV"x1 "vi"x2 "IV"x2 "vi"x3 "vi"x1 "V"x4 | "vi"x8 ||
</span>
<script>
// renderMusicIn('joy2', {viewportHorizontal: false, scrollHorizontal: true});
renderMusicIn('joy2');
// renderMusicIn('joy2', { wrap: { minSpacing: 1.8, maxSpacing: 2.7, preferredMeasuresPerLine: 10 } });
for (const v of [1, 2, 3, 4]) {
  for (const e of document.querySelectorAll(`#joy2 .abcjs-v${v}.abcjs-note`)) {
    e.classList.add('generated');
  }
}
for (const e of document.querySelectorAll(`#joy2 .abcjs-chord`)) {
  e.classList.add('generated');
}
</script>
<p>Same as above, but without the homophonic constraint. Now the voices can move freely and independently, as long as they stick within any harmony constraints induced by the melody line.</p>
<span id="counterpoint1">
%%staves vs (vch va)
X: 1
T: Counterpoint
L: 1/4
K: C
M: 4/4
Q: 1/4=60
V: vs name="S"
V: va name="A"
V: vch name=" "
%
V: vs
%%MIDI program 52
e1 g1 e1 d1 | c1 B1 c1 e1 | d1 c1 d1 e1 | f1 e1 ||
V: va
%%MIDI program 52
e1 e1 a1 g1 | c'1 g1 g1 a1 | g1 c'1 g1 g1 | c1 e1 ||
V: vch
"vi"x1 "iii"x1 "vi"x1 "V"x1 | "I"x1 "iii"x1 "I"x1 "vi"x1 | "V"x1 "I"x1 "V"x1 "I"x1 | "IV"x1 "vi"x1 ||
</span>
<script>
// renderMusicIn('counterpoint1', {viewportHorizontal: false, scrollHorizontal: true});
renderMusicIn('counterpoint1');
// {wrap:{ minSpacing: 1.8, maxSpacing: 2.7, preferredMeasuresPerLine: 4 }}
for (const v of [1, 2]) {
  for (const e of document.querySelectorAll(`#counterpoint1 .abcjs-v${v}.abcjs-note`)) {
    e.classList.add('generated');
  }
}
for (const e of document.querySelectorAll(`#counterpoint1 .abcjs-chord`)) {
  e.classList.add('generated');
}
</script>
<span id="counterpoint2">
%%staves vs (vch va)
X: 1
T: Counterpoint 2
L: 1/4
K: C
M: 4/4
Q: 1/4=60
V: vs name="S"
V: va name="A"
V: vch name=" "
%
V: vs
%%MIDI program 52
g1 e1 f1 e1 | d1 f1 g1 e1 | a1 g1 ||
V: va
%%MIDI program 52
g1 g1 c'1 g1 | g1 d1 c1 g1 | c1 g1 ||
V: vch
"iii"x1 "I"x1 "IV"x1 "iii"x1 | "V"x1 "ii"x1 "I"x1 "iii"x1 | "vi"x1 "I"x1 ||
</span>
<script>
// renderMusicIn('counterpoint2', {viewportHorizontal: false, scrollHorizontal: true});
renderMusicIn('counterpoint2');
// {wrap:{ minSpacing: 1.8, maxSpacing: 2.7, preferredMeasuresPerLine: 4 }}
for (const v of [1, 2]) {
  for (const e of document.querySelectorAll(`#counterpoint2 .abcjs-v${v}.abcjs-note`)) {
    e.classList.add('generated');
  }
}
for (const e of document.querySelectorAll(`#counterpoint2 .abcjs-chord`)) {
  e.classList.add('generated');
}
</script>
<p>Two example exercises, following most of the rules of <a href="https://musictheory.pugetsound.edu/mt21c/FirstSpecies.html">First Species Counterpoint</a>,
as well as <a href="https://musictheory.pugetsound.edu/mt21c/RulesOfMelody.html">general rules for melody</a>.</p>
<span id="ode1">
%%staves vs va vt (vch vb)
X: 1
T: Ode to Joy
L: 1/8
K: C
M: 4/4
Q: 1/4=100
V: vs name="S"
V: va name="A"
V: vt name="T"  clef=treble-8
V: vb name="B"  clef=bass middle=d transpose=-24
V: vch name=" "
%
V: vs
%%MIDI program 20
e2 e2 f2 g2 | g2 f2 e2 d2 | c2 c2 d2 e2 | e3 d1 d4 |
 e2 e2 f2 g2 | g2 f2 e2 d2 | c2 c2 d2 e2 | d3 c1 c4 |
 d2 d2 e2 c2 | d2 e1 f1 e2 c2 | d2 e1 f1 e2 d2 | c2 d2 G4 |
 e2 e2 f2 g2 | g2 f2 e2 d2 | c2 c2 d2 e2 | d3 c1 (cc4 | cc8)
 ||
V: va
%%MIDI program 20
c2 e2 f2 d2 | B2 A2 A2 d2 | e2 e2 d2 e2 | e3 d1 G4 |
 e2 e2 A2 G2 | d2 f2 e2 d2 | e2 e2 d2 e2 | d3 e1 A4 |
 B2 G2 e2 e2 | d2 e1 f1 e2 e2 | d2 e1 f1 e2 d2 | e2 G2 B4 |
 c2 e2 f2 d2 | d2 f2 e2 d2 | e2 e2 d2 A2 | d3 e1 (ee4 | ee8)
 ||
V: vt
%%MIDI program 20
c2 c2 F2 B2 | B2 A2 C2 B2 | c2 c2 B2 c2 | c3 B1 B4 |
 c2 C2 c2 B2 | B2 c2 c2 B2 | c2 c2 B2 c2 | B3 c1 c4 |
 B2 B2 c2 c2 | B2 c1 c1 c2 c2 | B2 c1 c1 B2 D2 | c2 B2 B4 |
 c2 C2 c2 B2 | B2 c2 c2 B2 | c2 c2 B2 c2 | B3 c1 (cc4 | cc8)
 ||
V: vb
%%MIDI program 20
e2 e2 c2 d2 | d2 A2 E2 d2 | e2 e2 d2 e2 | e3 G1 d4 |
 e2 e2 c2 d2 | d2 c2 e2 d2 | e2 e2 d2 e2 | G3 e1 e4 |
 d2 d2 e2 e2 | d2 e1 c1 e2 e2 | d2 e1 c1 e2 d2 | e2 d2 d4 |
 e2 E2 c2 d2 | d2 c2 e2 d2 | e2 e2 d2 e2 | d3 e1 (ee4 | ee8)
 ||
V: vch
"vi"x2 "vi"x2 "IV"x2 "V"x2 | "V"x2 "ii"x2 "vi"x2 "V"x2 | "vi"x2 "vi"x2 "V"x2 "vi"x2 | "vi"x3 "V"x1 "V"x4 |
 "vi"x2 "vi"x2 "IV"x2 "V"x2 | "V"x2 "IV"x2 "vi"x2 "V"x2 | "vi"x2 "vi"x2 "V"x2 "vi"x2 | "V"x3 "vi"x1 "vi"x4 |
 "V"x2 "V"x2 "vi"x2 "vi"x2 | "V"x2 "vi"x1 "IV"x1 "vi"x2 "vi"x2 | "V"x2 "vi"x1 "IV"x1 "iii"x2 "V"x2 | "vi"x2 "V"x2 "V"x4 |
 "vi"x2 "I"x2 "IV"x2 "V"x2 | "V"x2 "IV"x2 "vi"x2 "V"x2 | "vi"x2 "vi"x2 "V"x2 "vi"x2 | "V"x3 "vi"x1 "vi"x4 | "vi"x8
 ||
</span>
<script>
// renderMusicIn('ode1', {viewportHorizontal: false, scrollHorizontal: true});
renderMusicIn('ode1');
// {wrap:{ minSpacing: 1.8, maxSpacing: 2.7, preferredMeasuresPerLine: 4 }}
for (const v of [1, 2, 3, 4]) {
  for (const e of document.querySelectorAll(`#ode1 .abcjs-v${v}.abcjs-note`)) {
    e.classList.add('generated');
  }
}
for (const e of document.querySelectorAll(`#ode1 .abcjs-chord`)) {
  e.classList.add('generated');
}
</script>
<p>Reharmonization of Ode to Joy. Same constraints and setup as the homophonic Joy to the World.</p>
<span id="ode2">
%%staves vs va vt (vch vb)
X: 1
T: Ode to Joy
L: 1/8
K: C
M: 4/4
Q: 1/4=100
V: vs name="S"
V: va name="A"
V: vt name="T"  clef=treble-8
V: vb name="B"  clef=bass middle=d transpose=-24
V: vch name=" "
%
V: vs
%%MIDI program 20
e2 e2 f2 g2 | g2 f2 e2 d2 | c2 c2 d2 e2 | e3 d1 d4 |
 e2 e2 f2 g2 | g2 f2 e2 d2 | c2 c2 d2 e2 | d3 c1 c4 |
 d2 d2 e2 c2 | d2 e1 f1 e2 c2 | d2 e1 f1 e2 d2 | c2 d2 G4 |
 e2 e2 f2 g2 | g2 f2 e2 d2 | c2 c2 d2 e2 | d3 c1 (cc4 | cc8)
 ||
V: va
%%MIDI program 20
c4-c2-c1 (dd1 | dd2)  F1 F1 c2 G1 f1 | F1 f1 F1 c1 G2 (GG2 | GG3)  d1 G1 G1 G1 G1 |
 A4-A1 F1 c1 (cc1 | cc2)  F2 e2 d2 | F4 d1 (AA3 | AA3)  A1 F1 c3 |
 F4 e4 | d2 e1 A1 G2 f1 F1 | G1 G2 f1 A3 f1 | F1 F1 A1 d1 B2 (GG2 | GG1)
 G1 B1 B1 (cc4 | cc2)  f1 (AA4-A1 | AA2)  G1 e1 G2 (GG2 | GG3)  A1 (ee4 | ee8)
 ||
V: vt
%%MIDI program 20
C3 C4 D1 | G2 C1 F1 C1 C1 D2 | F4 D1 D1 (CC2 | CC3)  D1 B4 |
 A4-A1 F1 E1 c1 | G1 G1 D1 D1 (AA4 | AA4)  D1 A3 | D2 A1 c1 C1 F1 c1 c1 |
 A4-A1 E1 E2 | G3 A1 C4 | D2 E1 A1 c1 c1 D2 | c1 c1 A2 B1 E1 B1 B1 |
 E4 c1 (CC3 | CC2)  (AA6 | AA2)  C2 G4 | B3 c1 c1 (cc3 | cc8)
 ||
V: vb
%%MIDI program 20
A3 E1 F1 F1 c1 (dd1 | dd2)  F1 d1 E2 d1 F1 | A4 B2 (GG2 | GG4)  B3 G1 |
 (cc8 | cc2)  F2 A1 E1 (FF2 | FF1)  F1 A1 F1 G1 d1 E2 | d3 (AA4-A1 | AA6)
 A1 A1 | G1 B1 E1 F1 E1 E1 F1 A1 | B2 e1 F1 (AA4 | AA4)  (BB4 | BB1)
 e1 G1 B1 A2 G1 G1 | c1 E1 A4 F1 d1 | e2 (GG6 | GG3)  e1 E1 e1 e1 (ee1 | ee8)
 ||
V: vch
"vi"x4 "IV"x2 "I"x1 "V"x1 | "V"x1 "V"x1 "IV"x1 "ii"x1 "I"x2 "V"x1 "ii"x1 | "IV"x4 "V"x2 "I"x2 | "I"x3 "V"x1 "V"x4 |
 "vi"x4 "IV"x1 "IV"x1 "I"x2 | "I"x2 "ii"x2 "vi"x1 "vi"x1 "ii"x2 | "IV"x4 "V"x1 "ii"x1 "vi"x2 | "ii"x3 "IV"x5 |
 "ii"x3 "ii"x1 "vi"x1 "vi"x3 | "V"x2 "I"x1 "ii"x1 "I"x2 "IV"x1 "IV"x1 | "V"x2 "iii"x1 "ii"x1 "vi"x2 "ii"x2 | "IV"x2 "ii"x1 "ii"x1 "iii"x4 | "iii"x4
 "IV"x2 "I"x2 | "I"x2 "ii"x2 "vi"x1 "vi"x1 "ii"x1 "ii"x1 | "vi"x2 "I"x2 "V"x2 "iii"x2 | "V"x2 "V"x1 "vi"x5 | "vi"x8
 ||
</span>
<script>
// renderMusicIn('ode2', {viewportHorizontal: false, scrollHorizontal: true});
renderMusicIn('ode2');
// {wrap:{ minSpacing: 1.8, maxSpacing: 2.7, preferredMeasuresPerLine: 4 }}
for (const v of [1, 2, 3, 4]) {
  for (const e of document.querySelectorAll(`#ode2 .abcjs-v${v}.abcjs-note`)) {
    e.classList.add('generated');
  }
}
for (const e of document.querySelectorAll(`#ode2 .abcjs-chord`)) {
  e.classList.add('generated');
}
</script>
<span id="jingle">
%%staves vs va vt (vch vb)
X: 1
T: Jingle Bells
L: 1/16
K: C
M: 4/4
Q: 1/4=120
V: vs name="S"
V: va name="A"
V: vt name="T"  clef=treble-8
V: vb name="B"  clef=bass middle=d transpose=-24
V: vch name=" "
%
V: vs
%%MIDI program 53
G2 e2 d2 c2 G6 G1 G1 | G2 e2 d2 c2 A8 | A2 f2 e2 d2 B6 g2 | a2 g2 f2 d2 e8 |
 G2 e2 d2 c2 G6 G1 G1 | G2 e2 d2 c2 A6 A2 | A2 f2 e2 d2 g2 g2 g2 g2 | a2 g2 f2 d2 c8 |
 e2 e2 e4 e2 e2 e4 | e2 g2 c3 d1 e8 | f2 f2 f3 f1 f2 e2 e2 e1 e1 | e2 d2 d2 e2 d4 g4 |
 e2 e2 e4 e2 e2 e4 | e2 g2 c3 d1 e8 | f2 f2 f3 f1 f2 e2 e2 e1 e1 | g2 g2 f2 d2 c8 |
 ||
V: va
%%MIDI program 53
G2 c2 A2 A2 d'6 d'1 d'1 | B2 A2 d'2 e'2 e'8 | e'2 f'2 c'2 d'2 b6 d'2 | e'2 g2 f'2 G2 e'8 |
 e'2 e'2 d'2 e'2 d'6 d1 G1 | G2 a2 d'2 A2 e'6 c'2 | F2 f'2 e'2 d'2 d'2 d'2 d'2 e'2 | c'2 d'2 f'2 d'2 e'8 |
 e'2 e'2 e'4 e'2 e'2 e'4 | e'2 b2 e3 d'1 e'8 | A2 f'2 f'3 f1 f'2 e'2 e'2 e'1 e'1 | e'2 G2 d'2 e'2 B4 d'4 |
 e'2 A2 g4 G2 e'2 e'4 | e'2 d'2 e'3 f'1 c8 | a2 f'2 a3 F1 f'2 c'2 e'2 e'1 e'1 | d'2 d'2 f'2 d'2 e'8 |
 ||
V: vt
%%MIDI program 53
b2 c'2 A2 c'2 G6 b1 b1 | b2 c'2 b2 c'2 c'8 | c'2 c'2 C2 b2 b6 b2 | c'2 b2 c'2 b2 c'8 |
 b2 c'2 b2 c'2 b6 b1 b1 | b2 E2 b2 c'2 c'6 c'2 | A2 c'2 c'2 b2 b2 b2 b2 b2 | c'2 b2 c'2 b2 c'8 |
 c'2 c'2 c'4 c'2 c'2 c'4 | c'2 b2 c'3 b1 c'8 | f2 c'2 c'3 c'1 c'2 c'2 c'2 c'1 c'1 | c'2 b2 b2 G2 b4 B4 |
 c'2 c'2 C4 b2 c'2 c'4 | c'2 b2 c'3 A1 c'8 | c'2 c'2 a3 c'1 c'2 c'2 c'2 c'1 c'1 | b2 b2 c'2 b2 c'8 |
 ||
V: vb
%%MIDI program 53
d'2 e'2 A2 e'2 d'6 d'1 d'1 | d'2 e'2 d'2 e'2 e'8 | e'2 c'2 E2 d'2 e'6 d'2 | e'2 d'2 c'2 d'2 e'8 |
 e'2 e'2 d'2 e'2 b6 d'1 e'1 | d'2 e'2 d'2 e'2 e'6 e'2 | A2 c'2 e'2 d'2 d'2 b2 d'2 e'2 | c'2 d'2 c'2 d'2 e'8 |
 e'2 e'2 e'4 e'2 e'2 e'4 | e'2 d'2 e'3 d'1 e'8 | A2 c'2 c'3 c'1 c'2 e'2 e'2 e'1 e'1 | e'2 d'2 d'2 E2 d'4 d'4 |
 e'2 e'2 e'4 E2 e'2 e'4 | e'2 d'2 e'3 A1 e'8 | c'2 c'2 A3 c'1 c'2 e'2 e'2 e'1 e'1 | d'2 d'2 c'2 d'2 e'8 |
 ||
V: vch
"V"x2 "vi"x2 "ii"x2 "vi"x2 "V"x6 "V"x1 "V"x1 | "V"x2 "vi"x2 "V"x2 "vi"x2 "vi"x8 | "vi"x2 "IV"x2 "I"x2 "V"x2 "iii"x6 "V"x2 | "vi"x2 "V"x2 "IV"x2 "V"x2 "vi"x8 |
 "iii"x2 "vi"x2 "V"x2 "vi"x2 "V"x6 "V"x1 "iii"x1 | "V"x2 "vi"x2 "V"x2 "vi"x2 "vi"x6 "vi"x2 | "ii"x2 "IV"x2 "vi"x2 "V"x2 "V"x2 "V"x2 "V"x2 "iii"x2 | "IV"x2 "V"x2 "IV"x2 "V"x2 "vi"x8 |
 "vi"x2 "vi"x2 "vi"x4 "vi"x2 "vi"x2 "vi"x4 | "vi"x2 "V"x2 "vi"x3 "V"x1 "vi"x8 | "ii"x2 "IV"x2 "IV"x3 "IV"x1 "IV"x2 "vi"x2 "vi"x2 "vi"x1 "vi"x1 | "vi"x2 "V"x2 "V"x2 "I"x2 "V"x4 "V"x4 |
 "vi"x2 "vi"x2 "I"x4 "iii"x2 "vi"x2 "vi"x4 | "vi"x2 "V"x2 "vi"x3 "ii"x1 "vi"x8 | "IV"x2 "IV"x2 "ii"x3 "IV"x1 "IV"x2 "vi"x2 "vi"x2 "vi"x1 "vi"x1 | "V"x2 "V"x2 "IV"x2 "V"x2 "vi"x8 |
 ||
</span>
<script>
// renderMusicIn('jingle', {viewportHorizontal: false, scrollHorizontal: true});
renderMusicIn('jingle');
// {wrap:{ minSpacing: 1.8, maxSpacing: 2.7, preferredMeasuresPerLine: 4 }}
for (const v of [1, 2, 3, 4]) {
  for (const e of document.querySelectorAll(`#jingle .abcjs-v${v}.abcjs-note`)) {
    e.classList.add('generated');
  }
}
for (const e of document.querySelectorAll(`#jingle .abcjs-chord`)) {
  e.classList.add('generated');
}
</script>
<p>Jingle Bells. Fewer constraints to start with, so the middle voices can do crazier things.</p>
<span id="jingle1">
%%staves vs va vt (vch vb)
X: 1
T: Jingle Bells
L: 1/16
K: C
M: 4/4
Q: 1/4=120
V: vs name="S"
V: va name="A"
V: vt name="T"  clef=treble-8
V: vb name="B"  clef=bass middle=d transpose=-24
V: vch name=" "
%
V: vs
%%MIDI program 53
G2 e2 d2 c2 G6 G1 G1 | G2 e2 d2 c2 A8 | A2 f2 e2 d2 B6 g2 | a2 g2 f2 d2 e8 |
 G2 e2 d2 c2 G6 G1 G1 | G2 e2 d2 c2 A6 A2 | A2 f2 e2 d2 g2 g2 g2 g2 | a2 g2 f2 d2 c8 |
 e2 e2 e4 e2 e2 e4 | e2 g2 c3 d1 e8 | f2 f2 f3 f1 f2 e2 e2 e1 e1 | e2 d2 d2 e2 d4 g4 |
 e2 e2 e4 e2 e2 e4 | e2 g2 c3 d1 e8 | f2 f2 f3 f1 f2 e2 e2 e1 e1 | g2 g2 f2 d2 c8 |
 ||
V: va
%%MIDI program 53
b4 a3 e'1 (cc8 | cc4)  d2 f6 d'1 A1 F1 F1 | F1 F1 F1 d'1 A1 B8-B2-B1 | A2 e1 e'1 F4 e4-e1 (bb3 | bb4)
 d2 c2 G1 G2 G1 G2 e'2 | G1 g1 G1 e'1 g1 B1 e'1 c'1 f'1 f'1 c'1 (ff4-f1 | ff4)  G8 (dd4 | dd4)  d4 c'8 |
 e3 e'1 A1 c'1 c'1 c'1 A1 e'1 A1 e'1 (e'e'4 | e'e'2)  g1 e'1 A1 c2 g1 e1 c'1 c'1 g4 e1 | f'8-f'2 e'1 a1 (c'c'4 | c'c'2)  d'1 b1 d'1 a3 d'8 |
 c'8-c'2-c'1 c1 e'1 A1 e1 (ee1 | ee4)  A1 e'1 c'1 G1 c'1 e'3 e'1 A1 e1 a1 | c'8-c'4-c'1 G1 (ee2 | ee1)  e'2 g1 f'1 F1 d2 c8 |
 ||
V: vt
%%MIDI program 53
g4 a3 (gg8-g1 | gg4)  a2 a1 c'1 c'1 c'1 c'1 A1 (aa4 | aa1)  a1 f1 D1 e2 D1 B1 B8 | A1 A1 G2 a1 D1 a2 C4-C1 (bb3 | bb4-b1)
 b1 C8 E2 | b1 b1 G1 E1 b1 b1 g1 c'1 (FF8 | FF4)  c'1 c'1 B1 G4-G1 D1 D1 b1 D1 | D4 F4 C1 c'1 F1 C4-C1 |
 e2 A8-A1 (CC4-C1 | CC1)  A1 c'2 f1 e1 c'1 b2 c'1 E1 E3 c'2 | d8-d2 e1 A4-A1 | E1 E1 D4 c'2 b8 |
 c'1 c'1 c'1 c'1 c'1 A1 c'1 c'1 c'1 c'4-c'2-c'1 | c'4-c'2-c'1 b1 (c'c'8 | c'c'1)  c'1 c1 a1 C1 c'1 c'1 C1 A1 c'3 (ee4 | ee3)  C2 D1 b2 c'8 |
 ||
V: vb
%%MIDI program 53
G4 a3 c'1 (c'c'8 | c'c'1)  c'1 c'1 c'1 A2 c'3 c'1 (ff6 | ff1)  a1 c'1 A1 e1 b8-b2-b1 | f1 f1 e2 F4 e1 e'1 A1 c1 c1 (BB3 | BB6)
 c6 G2 e1 E1 | E1 B4 B1 E2 f1 F1 f3 (dd3 | dd3)  F1 E1 E1 g6 (dd4 | dd2)  G1 G1 F1 d'3 c4-c2-c1 c1 |
 E12 E1 E1 E1 e'1 | e1 A1 E2 F1 E1 E1 g1 E1 e'1 c'1 G4 E1 | a8-a2-a1 e1 e'1 (e'e'3 | e'e'2)  G3 d'1 e2 G8 |
 e'12 e'1 e'2 e'1 | e'1 e'1 e'1 e'2 e'1 e'1 G1 c'4-c'2-c'1 c'1 | c'1 c'4-c'2-c'1 c'1 c'2 E1 c'1 E1 c'2 | E4 F1 F1 G2 c'8 |
 ||
V: vch
"V"x1 "iii"x3 "ii"x1 "ii"x1 "vi"x1 "I"x1 "I"x8 | "I"x3 "I"x1 "ii"x2 "IV"x5 "IV"x1 "ii"x4 | "ii"x1 "IV"x2 "ii"x1 "vi"x1 "iii"x1 "V"x10 | "ii"x2 "I"x2 "ii"x4 "vi"x5 "iii"x3 | "iii"x4
 "V"x2 "IV"x1 "vi"x1 "I"x2 "I"x1 "I"x3 "iii"x2 | "iii"x4 "V"x2 "I"x2 "ii"x2 "IV"x1 "ii"x1 "ii"x1 "ii"x1 "ii"x2 | "ii"x4 "I"x2 "V"x2 "I"x2 "V"x1 "I"x1 "V"x4 | "ii"x2 "V"x2 "ii"x4 "IV"x3 "IV"x1 "IV"x4 |
 "iii"x1 "vi"x1 "vi"x1 "vi"x8 "vi"x1 "vi"x4 | "vi"x1 "vi"x1 "I"x1 "I"x1 "IV"x1 "I"x1 "I"x1 "V"x1 "iii"x1 "vi"x2 "iii"x1 "I"x1 "I"x1 "I"x2 | "ii"x10 "vi"x6 | "vi"x2 "V"x3 "ii"x1 "vi"x2 "V"x8 |
 "vi"x2 "vi"x8 "I"x1 "I"x1 "vi"x3 "I"x1 | "I"x4 "vi"x1 "vi"x1 "vi"x1 "V"x1 "vi"x8 | "IV"x9 "IV"x1 "vi"x1 "I"x2 "iii"x1 "vi"x1 "I"x1 | "I"x1 "I"x1 "iii"x1 "I"x1 "IV"x1 "ii"x1 "V"x2 "vi"x8 |
 ||
</span>
<script>
// renderMusicIn('jingle1', {viewportHorizontal: false, scrollHorizontal: true});
renderMusicIn('jingle1');
// {wrap:{ minSpacing: 1.8, maxSpacing: 2.7, preferredMeasuresPerLine: 4 }}
for (const v of [1, 2, 3, 4]) {
  for (const e of document.querySelectorAll(`#jingle1 .abcjs-v${v}.abcjs-note`)) {
    e.classList.add('generated');
  }
}
for (const e of document.querySelectorAll(`#jingle1 .abcjs-chord`)) {
  e.classList.add('generated');
}
</script>
<p>Without homophonic constraints.</p>
<hr>
<p>Some notes on my experiments in generating music using SMT.</p>
<p>As a teaser, here is a procedurally-generated harmonization of the first line of <!-- the English Christmas carol -->
<em>Joy to the World</em>.
Given the melody (in the soprano voice), the system produces the other three voices (drawn <span class="generated">faded</span>) in a way that makes harmonic sense.</p>
<style>
  .generated {
    color:rgb(162, 162, 162)
  }
</style>
<span id="joy">
X: 1
T: Joy to the World
L: 1/16
K: C
M: 4/4
Q: 1/4=110
V: sop name="S"
V: alto name="A"
V: tenor name="T" clef=treble-8
V: bass name="B" clef=bass middle=d transpose=-24
%
V: sop
c4 B3 A1 G6 F2 E4 D4 C6 G2 A6 A2 B6 B2 c6
V: alto
e4 d4 G6 d2 G6 G6 c6 F4 A2 e2 e1 e4 B1 c6
V: tenor
A4 D4 G6 A2 E1 E3 D4 E4 E6 A6 G4 G1 G3 A6
V: bass
"vi" A4 "V" G3 "ii" F1 "I" G6 "ii" A1 "iii" d1 "V" G6 "I" G6 "I" c6 "vi" d6 "ii" G2 "iii" B3 "iii" G3 "vi" A6
</span>
<script>
renderMusicIn('joy');
for (const v of [1, 2, 3]) {
  for (const e of document.querySelectorAll(`#joy .abcjs-v${v}.abcjs-note`)) {
    e.classList.add('generated');
  }
}
</script>
<p>(If you are on iOS and can’t hear any audio, disable silent mode)</p>
<p>More examples <a href="#examples">here</a>. The rest of the post describes the journey (or at least the first part of it, since it appears to be far from over!).</p>
<h1 id="procedural-music-composition">Procedural music composition</h1>
<!--
The dream of automatic composition
Composition as puzzle-solving
Motivation

The beauty of Renaissance polyphony is deeply intriguing to me.
-->
<p>I’ve always found Renaissance polyphony deeply beautiful and intriguing. As an example, here is a performance of <a href="https://www.youtube.com/watch?v=Pdv9vmGo4EE">Sicut Cervus</a>, one of the hallmark pieces of the period.</p>
<!-- {{< youtube Pdv9vmGo4EE >}} -->
<p>Here is a <a href="https://www.youtube.com/watch?v=0AgZuB9HuIc">visualization</a> of the piece which shows how the four voices move and interact. The voices have individual character, sometimes engage with each other, and all fit together to create cohesive harmony.</p>
<!-- {{< youtube 0AgZuB9HuIc >}} -->
<p>Here’s another example, <a href="https://www.youtube.com/watch?v=VvK6awPV8VQ">Though Amaryllis Dance in Green</a>.</p>
<!-- {{< youtube VvK6awPV8VQ >}} -->
<!-- what is this song about? -->
<!-- As an example. Amaryllis. Like a dance. Voices dancing. See how the lines cross and make up for each other and interact, and yet if you the individual lines they have a character of their own. The singer of each line has clear phrases -->
<p>Check out the <a href="http://youtube.com/watch?v=svvJrkfm5uI">visualization</a> (watch at 2x speed). As an <a href="https://www.sonomabach.org/though-amaryllis---william-byrd.html">analysis</a> describes it,</p>
<!-- {{< youtube svvJrkfm5uI >}} -->
<!--
<script>
  setTimeout(() => {
    let videos = document.querySelectorAll('video')
    videos[videos.length-1].playbackRate = 2;
  }, 1000)
</script>
-->
<blockquote>
<p>What makes the piece special - and very fun to hear and to sing - is the liveliness of Byrd’s setting. The five parts are extremely independent of each other, each filled with syncopations and leaps, like five dancers improvising, individually but in relation to each other. It makes me think of <a href="https://www.invaluable.com/auction-lot/schomer-frank-lichtner-wisconsin-1905-2006-dancers-89-c-cf06fdea43">this wonderful painting</a> by Frank Schomer Lichtner.</p>
</blockquote>
<!--
Fugues are layered puzzles

1.75
[fair phyllis](https://www.youtube.com/watch?v=a-9XLm5ulHg)

1.75
[if ye love me](https://www.youtube.com/watch?v=Vc-NFZN_EjU)
[part 2](https://www.youtube.com/watch?v=RZ6DrEWjVnQ)
-->
<p>How are such intricate pieces created? Can it be done systematically?</p>
<p>The simple approach of choosing chords first, then choosing notes which fit wouldn’t result in independent voices.
Perhaps a nice, pleasing melody would work as a base, then the other voices could be written, ensuring they work with the harmony, which now emerges from the voices.
Presumably this would get harder and harder with each voice added, as new ideas would necessitate revisions of earlier voices to admit them and keep everything cohesive.
And this would be done iteratively until the piece is complete.</p>
<!-- This whole process would be iterated to a fixed point. -->
<!-- And this is only the basic level, before creating the texture you want with all kinds of chords. -->
<p>This sort of interleaved and iterative process of refinement might remind one of constraint propagation algorithms, and indeed, computer-aided composition using constraint solvers is its own subfield.
The “omnidirectional” nature of the solving process points to modelling the entire thing as a single constraint satisfaction problem <a href="https://adamsmith.as/papers/fdg2013_shortcuts.pdf">for more effective propagation</a>.</p>
<!-- section 5.5 -->
<!--
Interdependent constraints
Not at all obvious where to start or what order to solve them in
-->
<p>At this point I was curious to see how well a simple, baseline approach with an SMT solver would work.
Writing small prototypes is always fun, just to get a feel for the workflow and requirements, and if the idea would even work at all.
SMT solvers are a staple in my area of research, so how far could I get by simply writing some constraints in Python, solving them with Z3, then rendering the result?</p>
<p>This turned out to be <em>way</em> more of a rabbit hole than I anticipated.</p>
<h1 id="vision">Vision</h1>
<!-- and applications -->
<!--
begin by stating assumptions on the
the type of musical tasks they aim to tackle,
Famous last words. My assumptions are in the next section.
-->
<p>Many existing systems tackle specific musical tasks,
e.g. <a href="https://github.com/blapiere/Rhythm-Box">generating rhythm</a>, <a href="http://musictech.mit.edu/sites/default/files/documents/pbchen_meng.pdf">automatic harmonization</a>, <a href="https://github.com/sprockeelsd/Melodizer">generating melody given a rhythm and chord progression</a>, <a href="https://dl.acm.org/doi/10.1145/3036290.3036295">generating a countermelody</a>, etc.</p>
<p>What I hoped to build was something more general, more of a logical foundation for all these tasks. A follow-up goal would then be to build a <a href="https://pure.york.ac.uk/portal/en/publications/mixed-initiative-creative-interfaces">mixed-initiative</a> composition tool on top of this foundation, perhaps even one accessible to <a href="https://computationalcreativity.net/iccc2015/proceedings/10_2Compton.pdf">casual creators</a>.</p>
<p>In particular, I was inspired by work on ASP-based procedural narrative generation, which encodes stories in logical form and searches for solutions to procedural generation tasks.
Section 6 of <a href="https://adamsmith.as/papers/a17-chen.pdf">this paper</a> describes how in this very general setting, changing the amount of initial input leads to many modes of interaction with the system.
Specializing them to our musical use case:</p>
<ol>
<li><em>Tabula rasa</em> generation: using the background theory (e.g. harmony and melody constraints) to generate a piece from scratch</li>
<li>Constrained generation: finishing an incomplete piece; satisfying a melody (harmonization), chord progression, etc.</li>
<li>Generation based on a partial piece: starting with a piece that satisfies constraints (e.g. a well-known classic work), remove constraints to generate variations</li>
</ol>
<p>There is a fourth use case which other systems in the typed music composition community highlight:</p>
<ol start="4">
<li>Validation: if the piece does not satisfy constraints, the violated constraints show mistakes in the piece or (more likely) inadequacies in our music theory</li>
</ol>
<!-- sight singing exercises -->
<!-- This led to the choice of encoding. -->
<h1 id="encoding">Encoding</h1>
<p>There are many possible logical encodings for musical scores and concepts, with different tradeoffs with respect to expressiveness and solver performance.
For example, a naive one would be to represent rhythm as a fixed grid of boolean variables, which would work for some kinds of music.
The <a href="https://strasheela.sourceforge.net/documents/TorstenAnders-PhDThesis.pdf">Strasheela thesis</a> covers numerous encoding schemes, so I’ll just go over my specific choices.</p>
<!-- The encoding I settled on may seem simple, even naive, but the finding here is that with only limited understanding of how theory solvers work, a good heuristic for solver performance is to keep constraints dead simple. -->
<p>Pitch is represented by bounded integer variables.</p>
<div style="display: flex; align-items: center;"><mjx-container class="MathJax" jax="SVG" overflow="overflow" display="true"><svg style="vertical-align: -0.858ex;" xmlns="http://www.w3.org/2000/svg" width="54.458ex" height="2.354ex" role="img" focusable="false" viewBox="0 -716.5 26085.3 1127.4" xmlns:xlink="http://www.w3.org/1999/xlink"><defs><path id="MJX-261-STX-MI-70" d="M225-11C376-11 488 119 488 307C488 423 428 479 353 479C303 479 261 450 215 396L215 397L211 397L225 474L206 474L63 459L63 434C63 434 80 436 95 436C121 436 132 427 132 407C132 400 131 394 130 388L5-220L201-220L208-193C128-193 107-166 107-143C107-129 109-111 111-101L135 15C155 3 194-11 225-11M146 65L196 307C223 368 262 423 324 423C352 423 400 402 400 307C400 131 334 32 232 32C191 32 163 50 146 65Z"></path><path id="MJX-261-STX-MI-69" d="M115-9C181-9 220 47 255 96L235 111C219 93 191 59 157 59C145 59 139 65 139 78C139 92 144 120 144 120L219 476L197 476L57 465L57 438C57 438 74 440 91 440C118 440 123 424 123 411C123 394 120 380 120 380L69 142C56 83 52 61 52 44C52 9 75-9 115-9M188 556C218 556 243 576 243 610C243 643 224 665 191 665C158 665 136 644 136 610C136 575 158 556 188 556Z"></path><path id="MJX-261-STX-MI-74" d="M115-9C194-9 236 65 265 104L245 119C210 74 189 59 160 59C146 59 143 69 143 80C143 97 150 130 150 130L211 428L310 428L318 467L219 467L245 593L215 593C165 506 140 482 76 449L72 428L129 428L61 101C59 91 54 61 54 44C54 13 73-9 115-9Z"></path><path id="MJX-261-STX-MI-63" d="M183-13C273-13 336 46 376 108L359 123C329 85 290 57 225 57C150 57 117 95 117 183C117 300 176 446 282 446C313 446 330 434 330 419C330 403 311 375 311 349C311 327 325 314 349 314C386 314 405 346 405 386C405 451 354 479 292 479C152 479 34 337 34 167C34 58 85-13 183-13Z"></path><path id="MJX-261-STX-MI-68" d="M384-10C456-10 496 60 522 97L501 112C486 93 462 60 426 60C413 60 407 68 407 79C407 91 411 103 411 103L467 334C470 348 476 382 476 408C476 444 461 479 411 479C296 479 206 334 165 259L157 259L182 377L253 705L230 705L93 694L93 668C93 668 114 670 127 670C147 670 159 659 159 644C159 629 156 610 156 610L31 0L113 0L148 160C179 230 290 407 361 407C383 407 390 390 390 367C390 347 383 319 383 319L324 88C322 83 319 65 319 49C319 19 334-10 384-10Z"></path><path id="MJX-261-STX-I-1D45D" d="M275-220L282-193C202-193 181-166 181-143C181-129 183-111 185-101L209 15C229 3 268-11 300-11C456-11 572 119 572 307C572 423 510 479 432 479C380 479 338 451 290 397L285 397L299 474L280 474L137 459L137 434C137 434 154 436 169 436C195 436 206 427 206 407C206 400 205 394 204 388L77-220M272 311C300 370 340 423 404 423C434 423 484 402 484 307C484 131 415 32 308 32C266 32 238 49 221 64Z"></path><path id="MJX-261-STX-N-2261" d="M658 28L658 96L62 96L62 28M658 225L658 293L62 293L62 225M658 422L658 489L62 489L62 422Z"></path><path id="MJX-261-STX-N-7B" d="M25 245C72 240 115 233 115 173C115 126 96 8 96-52C96-167 184-197 282-197L282-165C225-165 170-150 170-64C170-13 185 68 185 129C185 212 144 247 93 267L93 273C144 293 185 328 185 411C185 472 170 552 170 603C170 689 225 704 282 704L282 736C184 736 96 706 96 591C96 531 115 414 115 367C115 307 72 300 25 295Z"></path><path id="MJX-261-STX-I-1D70C" d="M122 104L130 104C143 54 175-11 249-11C387-11 495 133 495 307C496 432 433 481 362 481C213 481 124 383 71 141C48 42 27-80-5-213L8-216C100-216 103-155 109-45C111-3 114 47 122 104M147 191C148 333 259 395 338 395C390 395 446 371 446 273C446 148 355 71 254 71C194 71 147 103 147 191Z"></path><path id="MJX-261-STX-I-1D456" d="M219 476L197 476L57 465L57 438C57 438 74 440 91 440C118 440 123 424 123 411C123 394 120 380 120 380L69 142C56 83 52 61 52 44C52 9 75-9 115-9C181-9 220 47 255 96L235 111C219 93 191 59 157 59C145 59 139 65 139 78C139 92 144 120 144 120M243 610C243 643 224 665 191 665C158 665 136 644 136 610C136 575 158 556 188 556C218 556 243 576 243 610Z"></path><path id="MJX-261-STX-N-2223" d="M170-194L170 706L102 706L102-194Z"></path><path id="MJX-261-STX-I-1D45A" d="M403 0L435 138C472 228 587 407 649 407C672 407 679 390 679 367C679 346 670 308 663 282L612 88C611 83 607 65 607 49C607 19 622-10 673-10C744-10 784 60 810 97L790 112C774 93 750 60 715 60C702 60 696 68 696 79C696 91 699 103 699 103L754 334C757 348 764 382 764 408C764 444 750 479 700 479C596 479 514 346 471 270L463 270L480 334C481 339 489 379 489 408C489 444 476 479 426 479C312 479 227 338 185 259L177 259L227 476L204 476L66 465L66 438C66 438 85 440 98 440C122 440 130 430 130 413C130 398 127 380 127 380L47 0L129 0L160 137C210 250 309 407 375 407C398 407 405 390 405 367C405 351 400 328 399 325C375 215 349 107 320 0Z"></path><path id="MJX-261-STX-I-1D45B" d="M521 112C506 93 481 60 447 60C433 60 428 68 428 79C428 91 430 103 430 103L487 334C490 348 496 382 496 408C496 444 481 479 430 479C312 479 227 334 185 259L177 259L227 476L205 476L66 465L66 438C66 438 86 440 99 440C122 440 131 430 131 413C131 398 128 380 128 380L47 0L129 0L165 158C197 227 307 407 380 407C403 407 410 390 410 367C410 347 403 319 403 319L344 88C343 83 339 65 339 49C339 19 354-10 404-10C476-10 516 60 542 97Z"></path><path id="MJX-261-STX-N-2264" d="M650 52L650 116L207 337L650 557L650 623L71 342L71 332M650-106L650-38L71-38L71-106Z"></path><path id="MJX-261-STX-I-1D44E" d="M502 472L449 472L413 426L409 426C388 456 358 479 305 479C174 479 49 341 49 159C49 43 100-12 172-12C229-12 288 22 339 85L346 85C343 67 339 53 339 38C339 5 359-10 395-10C455-10 497 33 539 97L519 112C506 95 477 60 445 60C429 60 425 68 425 81C425 96 430 118 430 118M389 344C389 313 378 240 358 181C329 96 285 54 218 54C168 54 138 77 138 169C138 303 202 441 302 441C358 441 389 397 389 344Z"></path><path id="MJX-261-STX-I-1D465" d="M315 298L312 298L300 349C286 403 267 447 243 475L228 475L89 459L89 429C89 429 104 432 120 432C186 433 203 406 230 322L258 231L186 126C147 70 129 69 125 69C108 69 84 82 62 82C38 82 23 60 23 40C23 15 38-9 81-9C141-9 174 38 206 90L270 194L274 194L299 93C313 28 335-10 381-10C449-10 491 58 520 102L499 118C472 82 453 62 427 62C396 62 376 99 348 191L327 259L388 356C405 384 419 398 442 398C455 398 478 388 494 388C521 388 540 411 540 435C540 463 528 479 490 479C431 479 391 430 364 382Z"></path><path id="MJX-261-STX-N-2C" d="M70-132C110-114 194-80 194 33C194 88 167 121 117 121C77 121 55 94 55 62C55 33 71 8 110 8C121 8 130 10 141 14C141-67 95-91 58-107Z"></path><path id="MJX-261-STX-N-30" d="M468 317C468 523 378 642 249 642C104 642 27 510 27 320C27 143 86-11 247-11C404-11 468 146 468 317M371 311C371 119 326 25 247 25C167 25 123 121 123 315C123 513 167 608 246 608C328 608 371 514 371 311Z"></path><path id="MJX-261-STX-N-3C" d="M650-25L650 42L207 260L650 478L650 547L71 265L71 255Z"></path><path id="MJX-261-STX-N-7D" d="M302 295C255 300 212 307 212 367C212 414 231 531 231 591C231 706 143 736 45 736L45 704C102 704 157 689 157 603C157 552 142 472 142 411C142 328 183 293 234 273L234 267C183 247 142 212 142 129C142 68 157-13 157-64C157-150 102-165 45-165L45-197C143-197 231-167 231-52C231 8 212 126 212 173C212 233 255 240 302 245Z"></path><path id="MJX-261-STX-N-2208" d="M646 293L155 293C165 390 223 476 352 476L646 476L646 543L347 543C183 543 75 411 75 260C75 108 181-26 344-26L646-26L646 42L353 42C224 42 166 128 155 225L646 225Z"></path><path id="MJX-261-STX-I-1D446" d="M505 473L539 667L515 667C505 646 493 638 476 638C454 638 431 667 344 667C232 667 126 604 126 488C126 396 181 358 247 316C248 316 248 315 249 315C319 270 384 229 383 144C382 67 321 30 238 30C137 29 103 63 94 201L66 201L24-15L54-15C58 5 73 18 87 18C110 18 140-12 244-12C368-12 476 64 476 191C476 287 405 327 332 375C267 415 211 456 211 517C211 589 260 631 343 631C444 631 472 583 476 473Z"></path><path id="MJX-261-STX-I-1D434" d="M642 0L648 30C588 30 574 53 561 119L482 661L440 661L94 160C19 46 0 30-55 30L-62 0L147 0L154 30C110 30 96 36 96 57C96 76 107 94 121 113L191 219L449 219L459 129C460 117 461 103 461 87C461 37 430 30 381 30L375 0M445 259L215 259L409 548L412 548Z"></path><path id="MJX-261-STX-I-1D447" d="M628 484L658 657L121 657L80 484L112 484C156 593 167 618 278 618L335 618L236 131C217 40 203 30 119 30L113 0L398 0L404 30C319 30 307 40 326 131L425 618L482 618C593 618 597 593 597 484Z"></path><path id="MJX-261-STX-I-1D435" d="M413 349C508 371 588 420 588 528C588 600 540 657 371 657L118 657L112 627C186 627 205 616 188 536L103 125C86 42 69 30-7 30L-13 0L275 0C432 0 556 73 556 207C556 291 491 333 413 344M233 322L292 322C376 322 453 296 453 204C453 56 328 36 237 36C212 36 199 37 176 39M241 362L293 616C314 618 323 619 343 619C455 619 489 575 489 521C489 422 437 362 299 362Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math" data-latex="\mathit{pitch}_p \equiv \{\, \rho_i \mid min_p \le \rho_i \le max_p,\, 0 \le i < n \,\},\, p \in \{\,S, A, T, B\,\}
"><g data-mml-node="msub" data-latex="\mathit{pitch}_p"><g data-mml-node="TeXAtom" data-latex="\mathit{pitch}" data-mjx-texclass="ORD"><g data-mml-node="mi" data-latex="pitch"><use data-c="70" xlink:href="#MJX-261-STX-MI-70"></use><use data-c="69" xlink:href="#MJX-261-STX-MI-69" transform="translate(521,0)"></use><use data-c="74" xlink:href="#MJX-261-STX-MI-74" transform="translate(800,0)"></use><use data-c="63" xlink:href="#MJX-261-STX-MI-63" transform="translate(1098,0)"></use><use data-c="68" xlink:href="#MJX-261-STX-MI-68" transform="translate(1506,0)"></use></g></g><g data-mml-node="mi" transform="translate(2088,-255.4) scale(0.707)" data-latex="p"><use data-c="1D45D" xlink:href="#MJX-261-STX-I-1D45D"></use></g></g><g data-mml-node="mo" data-latex="\equiv" transform="translate(2838.6,0)"><use data-c="2261" xlink:href="#MJX-261-STX-N-2261"></use></g><g data-mml-node="mo" data-latex="\{" transform="translate(3836.4,0) translate(0 -19.5)"><use data-c="7B" xlink:href="#MJX-261-STX-N-7B"></use></g><g data-mml-node="mspace" data-latex="\," transform="translate(4163.4,0)"></g><g data-mml-node="msub" data-latex="\rho_i" transform="translate(4330.4,0)"><g data-mml-node="mi" data-latex="\rho"><use data-c="1D70C" xlink:href="#MJX-261-STX-I-1D70C"></use></g><g data-mml-node="mi" transform="translate(580,-150) scale(0.707)" data-latex="i"><use data-c="1D456" xlink:href="#MJX-261-STX-I-1D456"></use></g></g><g data-mml-node="mo" data-latex="\mid" transform="translate(5431.9,0)"><use data-c="2223" xlink:href="#MJX-261-STX-N-2223"></use></g><g data-mml-node="mi" data-latex="m" transform="translate(5981.7,0)"><use data-c="1D45A" xlink:href="#MJX-261-STX-I-1D45A"></use></g><g data-mml-node="mi" data-latex="i" transform="translate(6811.7,0)"><use data-c="1D456" xlink:href="#MJX-261-STX-I-1D456"></use></g><g data-mml-node="msub" data-latex="n_p" transform="translate(7085.7,0)"><g data-mml-node="mi" data-latex="n"><use data-c="1D45B" xlink:href="#MJX-261-STX-I-1D45B"></use></g><g data-mml-node="mi" transform="translate(598,-150) scale(0.707)" data-latex="p"><use data-c="1D45D" xlink:href="#MJX-261-STX-I-1D45D"></use></g></g><g data-mml-node="mo" data-latex="\le" transform="translate(8434.3,0)"><use data-c="2264" xlink:href="#MJX-261-STX-N-2264"></use></g><g data-mml-node="msub" data-latex="\rho_i" transform="translate(9432.1,0)"><g data-mml-node="mi" data-latex="\rho"><use data-c="1D70C" xlink:href="#MJX-261-STX-I-1D70C"></use></g><g data-mml-node="mi" transform="translate(580,-150) scale(0.707)" data-latex="i"><use data-c="1D456" xlink:href="#MJX-261-STX-I-1D456"></use></g></g><g data-mml-node="mo" data-latex="\le" transform="translate(10533.6,0)"><use data-c="2264" xlink:href="#MJX-261-STX-N-2264"></use></g><g data-mml-node="mi" data-latex="m" transform="translate(11531.4,0)"><use data-c="1D45A" xlink:href="#MJX-261-STX-I-1D45A"></use></g><g data-mml-node="mi" data-latex="a" transform="translate(12361.4,0)"><use data-c="1D44E" xlink:href="#MJX-261-STX-I-1D44E"></use></g><g data-mml-node="msub" data-latex="x_p" transform="translate(12916.4,0)"><g data-mml-node="mi" data-latex="x"><use data-c="1D465" xlink:href="#MJX-261-STX-I-1D465"></use></g><g data-mml-node="mi" transform="translate(592,-150) scale(0.707)" data-latex="p"><use data-c="1D45D" xlink:href="#MJX-261-STX-I-1D45D"></use></g></g><g data-mml-node="mo" data-latex="," transform="translate(13981.3,0)"><use data-c="2C" xlink:href="#MJX-261-STX-N-2C"></use></g><g data-mml-node="mspace" data-latex="\," transform="translate(14226.3,0)"></g><g data-mml-node="mn" data-latex="0" transform="translate(14559.9,0)"><use data-c="30" xlink:href="#MJX-261-STX-N-30"></use></g><g data-mml-node="mo" data-latex="\le" transform="translate(15332.7,0)"><use data-c="2264" xlink:href="#MJX-261-STX-N-2264"></use></g><g data-mml-node="mi" data-latex="i" transform="translate(16330.5,0)"><use data-c="1D456" xlink:href="#MJX-261-STX-I-1D456"></use></g><g data-mml-node="mo" data-latex="<" transform="translate(16882.3,0)"><use data-c="3C" xlink:href="#MJX-261-STX-N-3C"></use></g><g data-mml-node="mi" data-latex="n" transform="translate(17880,0)"><use data-c="1D45B" xlink:href="#MJX-261-STX-I-1D45B"></use></g><g data-mml-node="mspace" data-latex="\," transform="translate(18445,0)"></g><g data-mml-node="mo" data-latex="\}" transform="translate(18612,0) translate(0 -19.5)"><use data-c="7D" xlink:href="#MJX-261-STX-N-7D"></use></g><g data-mml-node="mo" data-latex="," transform="translate(18939,0)"><use data-c="2C" xlink:href="#MJX-261-STX-N-2C"></use></g><g data-mml-node="mspace" data-latex="\," transform="translate(19184,0)"></g><g data-mml-node="mi" data-latex="p" transform="translate(19517.7,0)"><use data-c="1D45D" xlink:href="#MJX-261-STX-I-1D45D"></use></g><g data-mml-node="mo" data-latex="\in" transform="translate(20393.5,0)"><use data-c="2208" xlink:href="#MJX-261-STX-N-2208"></use></g><g data-mml-node="mo" data-latex="\{" transform="translate(21391.3,0) translate(0 -19.5)"><use data-c="7B" xlink:href="#MJX-261-STX-N-7B"></use></g><g data-mml-node="mspace" data-latex="\," transform="translate(21718.3,0)"></g><g data-mml-node="mi" data-latex="S" transform="translate(21885.3,0)"><use data-c="1D446" xlink:href="#MJX-261-STX-I-1D446"></use></g><g data-mml-node="mo" data-latex="," transform="translate(22424.3,0)"><use data-c="2C" xlink:href="#MJX-261-STX-N-2C"></use></g><g data-mml-node="mi" data-latex="A" transform="translate(22835.9,0)"><use data-c="1D434" xlink:href="#MJX-261-STX-I-1D434"></use></g><g data-mml-node="mo" data-latex="," transform="translate(23516.9,0)"><use data-c="2C" xlink:href="#MJX-261-STX-N-2C"></use></g><g data-mml-node="mi" data-latex="T" transform="translate(23928.6,0)"><use data-c="1D447" xlink:href="#MJX-261-STX-I-1D447"></use></g><g data-mml-node="mo" data-latex="," transform="translate(24586.6,0)"><use data-c="2C" xlink:href="#MJX-261-STX-N-2C"></use></g><g data-mml-node="mi" data-latex="B" transform="translate(24998.3,0)"><use data-c="1D435" xlink:href="#MJX-261-STX-I-1D435"></use></g><g data-mml-node="mspace" data-latex="\," transform="translate(25591.3,0)"></g><g data-mml-node="mo" data-latex="\}" transform="translate(25758.3,0) translate(0 -19.5)"><use data-c="7D" xlink:href="#MJX-261-STX-N-7D"></use></g></g></g></svg></mjx-container></div><p>Rhythm is represented by duration variables.
Each note and chord has a duration, whose <em>start</em> is represented as an offset from the beginning of the piece.
The first duration has value 0, the last is strictly smaller than the total duration of the piece, and the sequences of durations within a part are monotonically increasing.</p>
<div style="display: flex; align-items: center;"><mjx-container class="MathJax" jax="SVG" overflow="overflow" display="true"><svg style="vertical-align: -0.858ex;" xmlns="http://www.w3.org/2000/svg" width="51.756ex" height="2.354ex" role="img" focusable="false" viewBox="0 -716.5 24790.9 1127.4" xmlns:xlink="http://www.w3.org/1999/xlink"><defs><path id="MJX-262-STX-MI-72" d="M134 0L165 143C204 238 277 395 318 395C321 395 331 358 363 358C389 358 416 377 416 421C416 460 392 479 361 479C280 479 219 326 188 259L178 259L229 476L207 476L68 465L68 438C68 438 88 440 99 440C127 440 132 429 132 410C132 392 127 366 123 348L49 0Z"></path><path id="MJX-262-STX-MI-68" d="M384-10C456-10 496 60 522 97L501 112C486 93 462 60 426 60C413 60 407 68 407 79C407 91 411 103 411 103L467 334C470 348 476 382 476 408C476 444 461 479 411 479C296 479 206 334 165 259L157 259L182 377L253 705L230 705L93 694L93 668C93 668 114 670 127 670C147 670 159 659 159 644C159 629 156 610 156 610L31 0L113 0L148 160C179 230 290 407 361 407C383 407 390 390 390 367C390 347 383 319 383 319L324 88C322 83 319 65 319 49C319 19 334-10 384-10Z"></path><path id="MJX-262-STX-MI-79" d="M2-220C69-220 126-139 234 15C244 29 348 175 398 268C429 325 441 365 441 401C441 457 411 482 377 482C349 482 334 464 334 442C334 403 383 383 383 346C383 330 374 303 350 264L235 79L229 79L220 179L198 325C186 405 179 437 157 475L142 475L8 464L8 435C17 436 26 437 35 437C94 437 100 393 108 343L165-9C137-51 57-163 35-163C19-163 4-109-37-109C-59-109-76-124-76-152C-76-193-38-220 2-220Z"></path><path id="MJX-262-STX-MI-74" d="M115-9C194-9 236 65 265 104L245 119C210 74 189 59 160 59C146 59 143 69 143 80C143 97 150 130 150 130L211 428L310 428L318 467L219 467L245 593L215 593C165 506 140 482 76 449L72 428L129 428L61 101C59 91 54 61 54 44C54 13 73-9 115-9Z"></path><path id="MJX-262-STX-MI-6D" d="M661-10C732-10 772 60 798 97L778 112C762 93 738 60 703 60C690 60 684 68 684 79C684 91 687 103 687 103L742 334C745 348 752 382 752 408C752 444 738 479 690 479C585 479 502 337 461 259L456 259L475 334C476 339 484 379 484 408C484 444 471 479 422 479C311 479 228 338 187 259L179 259L228 476L205 476L68 465L68 438C68 438 87 440 100 440C124 440 132 430 132 413C132 398 129 380 129 380L49 0L131 0L162 137C211 249 307 407 371 407C393 407 400 390 400 367C400 351 395 326 395 326C371 214 344 107 315 0L398 0L425 126C454 211 574 407 638 407C660 407 667 390 667 367C667 346 658 308 651 282L600 88C599 83 595 65 595 49C595 19 610-10 661-10Z"></path><path id="MJX-262-STX-I-1D45D" d="M275-220L282-193C202-193 181-166 181-143C181-129 183-111 185-101L209 15C229 3 268-11 300-11C456-11 572 119 572 307C572 423 510 479 432 479C380 479 338 451 290 397L285 397L299 474L280 474L137 459L137 434C137 434 154 436 169 436C195 436 206 427 206 407C206 400 205 394 204 388L77-220M272 311C300 370 340 423 404 423C434 423 484 402 484 307C484 131 415 32 308 32C266 32 238 49 221 64Z"></path><path id="MJX-262-STX-N-2261" d="M658 28L658 96L62 96L62 28M658 225L658 293L62 293L62 225M658 422L658 489L62 489L62 422Z"></path><path id="MJX-262-STX-N-7B" d="M25 245C72 240 115 233 115 173C115 126 96 8 96-52C96-167 184-197 282-197L282-165C225-165 170-150 170-64C170-13 185 68 185 129C185 212 144 247 93 267L93 273C144 293 185 328 185 411C185 472 170 552 170 603C170 689 225 704 282 704L282 736C184 736 96 706 96 591C96 531 115 414 115 367C115 307 72 300 25 295Z"></path><path id="MJX-262-STX-I-1D451" d="M529 705L507 705L371 694L371 668C371 668 390 670 402 670C432 670 437 656 437 639C437 625 434 607 434 607L401 439L398 439C374 464 341 479 296 479C157 479 37 340 37 162C37 45 89-12 163-12C222-12 279 24 329 85L337 85C335 73 332 54 332 42C332 11 353-10 393-10C462-10 499 53 530 97L510 112C496 93 469 60 437 60C424 60 418 65 418 79C418 92 423 121 423 121M346 177C319 101 274 54 206 54C157 54 126 78 126 169C126 299 190 441 291 441C349 441 377 394 377 351C377 333 372 252 346 177Z"></path><path id="MJX-262-STX-I-1D456" d="M219 476L197 476L57 465L57 438C57 438 74 440 91 440C118 440 123 424 123 411C123 394 120 380 120 380L69 142C56 83 52 61 52 44C52 9 75-9 115-9C181-9 220 47 255 96L235 111C219 93 191 59 157 59C145 59 139 65 139 78C139 92 144 120 144 120M243 610C243 643 224 665 191 665C158 665 136 644 136 610C136 575 158 556 188 556C218 556 243 576 243 610Z"></path><path id="MJX-262-STX-N-2223" d="M170-194L170 706L102 706L102-194Z"></path><path id="MJX-262-STX-N-30" d="M468 317C468 523 378 642 249 642C104 642 27 510 27 320C27 143 86-11 247-11C404-11 468 146 468 317M371 311C371 119 326 25 247 25C167 25 123 121 123 315C123 513 167 608 246 608C328 608 371 514 371 311Z"></path><path id="MJX-262-STX-N-3D" d="M658 327L658 395L62 395L62 327M658 123L658 190L62 190L62 123Z"></path><path id="MJX-262-STX-N-2C" d="M70-132C110-114 194-80 194 33C194 88 167 121 117 121C77 121 55 94 55 62C55 33 71 8 110 8C121 8 130 10 141 14C141-67 95-91 58-107Z"></path><path id="MJX-262-STX-N-3C" d="M650-25L650 42L207 260L650 478L650 547L71 265L71 255Z"></path><path id="MJX-262-STX-N-31" d="M426 0L426 28C334 28 297 46 297 95L297 639L268 639L74 584L74 551C105 561 156 567 176 567C201 567 209 553 209 518L209 95C209 45 174 28 80 28L80 0Z"></path><path id="MJX-262-STX-N-2E" d="M183 50C183 84 161 114 122 114C85 114 62 85 62 51C62 17 81-8 121-8C161-8 183 19 183 50Z"></path><path id="MJX-262-STX-I-1D45B" d="M521 112C506 93 481 60 447 60C433 60 428 68 428 79C428 91 430 103 430 103L487 334C490 348 496 382 496 408C496 444 481 479 430 479C312 479 227 334 185 259L177 259L227 476L205 476L66 465L66 438C66 438 86 440 99 440C122 440 131 430 131 413C131 398 128 380 128 380L47 0L129 0L165 158C197 227 307 407 380 407C403 407 410 390 410 367C410 347 403 319 403 319L344 88C343 83 339 65 339 49C339 19 354-10 404-10C476-10 516 60 542 97Z"></path><path id="MJX-262-STX-I-1D461" d="M317 467L216 467L244 593L214 593C164 506 139 482 75 449L71 428L128 428L60 101C58 91 53 61 53 44C53 13 72-9 114-9C193-9 235 65 264 104L244 119C209 74 188 59 159 59C145 59 142 69 142 80C142 97 149 130 149 130L208 428L309 428Z"></path><path id="MJX-262-STX-N-2264" d="M650 52L650 116L207 337L650 557L650 623L71 342L71 332M650-106L650-38L71-38L71-106Z"></path><path id="MJX-262-STX-N-7D" d="M302 295C255 300 212 307 212 367C212 414 231 531 231 591C231 706 143 736 45 736L45 704C102 704 157 689 157 603C157 552 142 472 142 411C142 328 183 293 234 273L234 267C183 247 142 212 142 129C142 68 157-13 157-64C157-150 102-165 45-165L45-197C143-197 231-167 231-52C231 8 212 126 212 173C212 233 255 240 302 245Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math" data-latex="\mathit{rhythm}_p \equiv \{\, d_i \mid d_0 = 0,\, d_0 < d_1 < ... < d_n < d_t,\, 0 \le i < n \}
"><g data-mml-node="msub" data-latex="\mathit{rhythm}_p"><g data-mml-node="TeXAtom" data-latex="\mathit{rhythm}" data-mjx-texclass="ORD"><g data-mml-node="mi" data-latex="rhythm"><use data-c="72" xlink:href="#MJX-262-STX-MI-72"></use><use data-c="68" xlink:href="#MJX-262-STX-MI-68" transform="translate(383,0)"></use><use data-c="79" xlink:href="#MJX-262-STX-MI-79" transform="translate(932,0)"></use><use data-c="74" xlink:href="#MJX-262-STX-MI-74" transform="translate(1378,0)"></use><use data-c="68" xlink:href="#MJX-262-STX-MI-68" transform="translate(1676,0)"></use><use data-c="6D" xlink:href="#MJX-262-STX-MI-6D" transform="translate(2225,0)"></use></g></g><g data-mml-node="mi" transform="translate(3083,-255.4) scale(0.707)" data-latex="p"><use data-c="1D45D" xlink:href="#MJX-262-STX-I-1D45D"></use></g></g><g data-mml-node="mo" data-latex="\equiv" transform="translate(3833.6,0)"><use data-c="2261" xlink:href="#MJX-262-STX-N-2261"></use></g><g data-mml-node="mo" data-latex="\{" transform="translate(4831.4,0) translate(0 -19.5)"><use data-c="7B" xlink:href="#MJX-262-STX-N-7B"></use></g><g data-mml-node="mspace" data-latex="\," transform="translate(5158.4,0)"></g><g data-mml-node="msub" data-latex="d_i" transform="translate(5325.4,0)"><g data-mml-node="mi" data-latex="d"><use data-c="1D451" xlink:href="#MJX-262-STX-I-1D451"></use></g><g data-mml-node="mi" transform="translate(589,-150) scale(0.707)" data-latex="i"><use data-c="1D456" xlink:href="#MJX-262-STX-I-1D456"></use></g></g><g data-mml-node="mo" data-latex="\mid" transform="translate(6435.9,0)"><use data-c="2223" xlink:href="#MJX-262-STX-N-2223"></use></g><g data-mml-node="msub" data-latex="d_0" transform="translate(6985.7,0)"><g data-mml-node="mi" data-latex="d"><use data-c="1D451" xlink:href="#MJX-262-STX-I-1D451"></use></g><g data-mml-node="mn" transform="translate(589,-150) scale(0.707)" data-latex="0"><use data-c="30" xlink:href="#MJX-262-STX-N-30"></use></g></g><g data-mml-node="mo" data-latex="=" transform="translate(8252.5,0)"><use data-c="3D" xlink:href="#MJX-262-STX-N-3D"></use></g><g data-mml-node="mn" data-latex="0" transform="translate(9250.3,0)"><use data-c="30" xlink:href="#MJX-262-STX-N-30"></use></g><g data-mml-node="mo" data-latex="," transform="translate(9745.3,0)"><use data-c="2C" xlink:href="#MJX-262-STX-N-2C"></use></g><g data-mml-node="mspace" data-latex="\," transform="translate(9990.3,0)"></g><g data-mml-node="msub" data-latex="d_0" transform="translate(10323.9,0)"><g data-mml-node="mi" data-latex="d"><use data-c="1D451" xlink:href="#MJX-262-STX-I-1D451"></use></g><g data-mml-node="mn" transform="translate(589,-150) scale(0.707)" data-latex="0"><use data-c="30" xlink:href="#MJX-262-STX-N-30"></use></g></g><g data-mml-node="mo" data-latex="<" transform="translate(11590.7,0)"><use data-c="3C" xlink:href="#MJX-262-STX-N-3C"></use></g><g data-mml-node="msub" data-latex="d_1" transform="translate(12588.5,0)"><g data-mml-node="mi" data-latex="d"><use data-c="1D451" xlink:href="#MJX-262-STX-I-1D451"></use></g><g data-mml-node="mn" transform="translate(589,-150) scale(0.707)" data-latex="1"><use data-c="31" xlink:href="#MJX-262-STX-N-31"></use></g></g><g data-mml-node="mo" data-latex="<" transform="translate(13855.3,0)"><use data-c="3C" xlink:href="#MJX-262-STX-N-3C"></use></g><g data-mml-node="mo" data-latex="." transform="translate(14575.3,0)"><use data-c="2E" xlink:href="#MJX-262-STX-N-2E"></use></g><g data-mml-node="mo" data-latex="." transform="translate(14987,0)"><use data-c="2E" xlink:href="#MJX-262-STX-N-2E"></use></g><g data-mml-node="mo" data-latex="." transform="translate(15398.7,0)"><use data-c="2E" xlink:href="#MJX-262-STX-N-2E"></use></g><g data-mml-node="mo" data-latex="<" transform="translate(15810.3,0)"><use data-c="3C" xlink:href="#MJX-262-STX-N-3C"></use></g><g data-mml-node="msub" data-latex="d_n" transform="translate(16808.1,0)"><g data-mml-node="mi" data-latex="d"><use data-c="1D451" xlink:href="#MJX-262-STX-I-1D451"></use></g><g data-mml-node="mi" transform="translate(589,-150) scale(0.707)" data-latex="n"><use data-c="1D45B" xlink:href="#MJX-262-STX-I-1D45B"></use></g></g><g data-mml-node="mo" data-latex="<" transform="translate(18124.4,0)"><use data-c="3C" xlink:href="#MJX-262-STX-N-3C"></use></g><g data-mml-node="msub" data-latex="d_t" transform="translate(19122.2,0)"><g data-mml-node="mi" data-latex="d"><use data-c="1D451" xlink:href="#MJX-262-STX-I-1D451"></use></g><g data-mml-node="mi" transform="translate(589,-150) scale(0.707)" data-latex="t"><use data-c="1D461" xlink:href="#MJX-262-STX-I-1D461"></use></g></g><g data-mml-node="mo" data-latex="," transform="translate(20000.2,0)"><use data-c="2C" xlink:href="#MJX-262-STX-N-2C"></use></g><g data-mml-node="mspace" data-latex="\," transform="translate(20245.2,0)"></g><g data-mml-node="mn" data-latex="0" transform="translate(20578.8,0)"><use data-c="30" xlink:href="#MJX-262-STX-N-30"></use></g><g data-mml-node="mo" data-latex="\le" transform="translate(21351.6,0)"><use data-c="2264" xlink:href="#MJX-262-STX-N-2264"></use></g><g data-mml-node="mi" data-latex="i" transform="translate(22349.4,0)"><use data-c="1D456" xlink:href="#MJX-262-STX-I-1D456"></use></g><g data-mml-node="mo" data-latex="<" transform="translate(22901.2,0)"><use data-c="3C" xlink:href="#MJX-262-STX-N-3C"></use></g><g data-mml-node="mi" data-latex="n" transform="translate(23898.9,0)"><use data-c="1D45B" xlink:href="#MJX-262-STX-I-1D45B"></use></g><g data-mml-node="mo" data-latex="\}" transform="translate(24463.9,0) translate(0 -19.5)"><use data-c="7D" xlink:href="#MJX-262-STX-N-7D"></use></g></g></g></svg></mjx-container></div><p>Chords are treated the same way, with a duration and pitch (class).
Ties and measures are not represented and are treated as a rendering concern.</p>
<p>Whether a note is a rest is represented by a boolean variable, which causes the pitch value to be ignored iff it is true.</p>
<div style="display: flex; align-items: center;"><mjx-container class="MathJax" jax="SVG" overflow="overflow" display="true"><svg style="vertical-align: -0.638ex;" xmlns="http://www.w3.org/2000/svg" width="20.524ex" height="2.134ex" role="img" focusable="false" viewBox="0 -716.5 9830.8 1022.1" xmlns:xlink="http://www.w3.org/1999/xlink"><defs><path id="MJX-263-STX-MI-72" d="M134 0L165 143C204 238 277 395 318 395C321 395 331 358 363 358C389 358 416 377 416 421C416 460 392 479 361 479C280 479 219 326 188 259L178 259L229 476L207 476L68 465L68 438C68 438 88 440 99 440C127 440 132 429 132 410C132 392 127 366 123 348L49 0Z"></path><path id="MJX-263-STX-MI-65" d="M179-12C243-12 312 17 372 107L354 122C315 74 269 57 219 57C152 57 116 88 116 189C116 193 116 198 116 202C233 211 401 264 401 389C401 467 337 479 294 479C132 479 32 307 32 163C32 75 69-12 179-12M120 232C135 327 198 448 273 448C303 448 315 429 315 393C315 298 231 239 120 232Z"></path><path id="MJX-263-STX-MI-73" d="M164-11C277-11 316 55 316 113C316 177 280 214 237 260C193 307 142 343 142 385C142 414 163 449 215 449C274 449 307 400 310 323L334 323L357 479L338 479L312 452L309 452C297 459 260 479 207 479C116 479 71 425 71 357C71 295 118 260 159 221C197 185 233 150 233 96C233 44 201 23 155 23C87 23 61 69 51 156L26 156L0-11L22-11L46 16L49 16C63 10 101-11 164-11Z"></path><path id="MJX-263-STX-MI-74" d="M115-9C194-9 236 65 265 104L245 119C210 74 189 59 160 59C146 59 143 69 143 80C143 97 150 130 150 130L211 428L310 428L318 467L219 467L245 593L215 593C165 506 140 482 76 449L72 428L129 428L61 101C59 91 54 61 54 44C54 13 73-9 115-9Z"></path><path id="MJX-263-STX-I-1D45D" d="M275-220L282-193C202-193 181-166 181-143C181-129 183-111 185-101L209 15C229 3 268-11 300-11C456-11 572 119 572 307C572 423 510 479 432 479C380 479 338 451 290 397L285 397L299 474L280 474L137 459L137 434C137 434 154 436 169 436C195 436 206 427 206 407C206 400 205 394 204 388L77-220M272 311C300 370 340 423 404 423C434 423 484 402 484 307C484 131 415 32 308 32C266 32 238 49 221 64Z"></path><path id="MJX-263-STX-N-2261" d="M658 28L658 96L62 96L62 28M658 225L658 293L62 293L62 225M658 422L658 489L62 489L62 422Z"></path><path id="MJX-263-STX-N-7B" d="M25 245C72 240 115 233 115 173C115 126 96 8 96-52C96-167 184-197 282-197L282-165C225-165 170-150 170-64C170-13 185 68 185 129C185 212 144 247 93 267L93 273C144 293 185 328 185 411C185 472 170 552 170 603C170 689 225 704 282 704L282 736C184 736 96 706 96 591C96 531 115 414 115 367C115 307 72 300 25 295Z"></path><path id="MJX-263-STX-I-1D45F" d="M161 259L212 476L190 476L51 465L51 438C51 438 71 440 82 440C110 440 115 429 115 410C115 392 110 366 106 348L32 0L117 0L147 140C163 180 253 395 301 395C304 395 314 358 346 358C372 358 399 377 399 421C399 460 375 479 343 479C263 479 203 326 171 259Z"></path><path id="MJX-263-STX-I-1D456" d="M219 476L197 476L57 465L57 438C57 438 74 440 91 440C118 440 123 424 123 411C123 394 120 380 120 380L69 142C56 83 52 61 52 44C52 9 75-9 115-9C181-9 220 47 255 96L235 111C219 93 191 59 157 59C145 59 139 65 139 78C139 92 144 120 144 120M243 610C243 643 224 665 191 665C158 665 136 644 136 610C136 575 158 556 188 556C218 556 243 576 243 610Z"></path><path id="MJX-263-STX-N-2223" d="M170-194L170 706L102 706L102-194Z"></path><path id="MJX-263-STX-N-30" d="M468 317C468 523 378 642 249 642C104 642 27 510 27 320C27 143 86-11 247-11C404-11 468 146 468 317M371 311C371 119 326 25 247 25C167 25 123 121 123 315C123 513 167 608 246 608C328 608 371 514 371 311Z"></path><path id="MJX-263-STX-N-2264" d="M650 52L650 116L207 337L650 557L650 623L71 342L71 332M650-106L650-38L71-38L71-106Z"></path><path id="MJX-263-STX-N-3C" d="M650-25L650 42L207 260L650 478L650 547L71 265L71 255Z"></path><path id="MJX-263-STX-I-1D45B" d="M521 112C506 93 481 60 447 60C433 60 428 68 428 79C428 91 430 103 430 103L487 334C490 348 496 382 496 408C496 444 481 479 430 479C312 479 227 334 185 259L177 259L227 476L205 476L66 465L66 438C66 438 86 440 99 440C122 440 131 430 131 413C131 398 128 380 128 380L47 0L129 0L165 158C197 227 307 407 380 407C403 407 410 390 410 367C410 347 403 319 403 319L344 88C343 83 339 65 339 49C339 19 354-10 404-10C476-10 516 60 542 97Z"></path><path id="MJX-263-STX-N-7D" d="M302 295C255 300 212 307 212 367C212 414 231 531 231 591C231 706 143 736 45 736L45 704C102 704 157 689 157 603C157 552 142 472 142 411C142 328 183 293 234 273L234 267C183 247 142 212 142 129C142 68 157-13 157-64C157-150 102-165 45-165L45-197C143-197 231-167 231-52C231 8 212 126 212 173C212 233 255 240 302 245Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math" data-latex="\mathit{rests}_p \equiv \{\, r_i \mid 0 \le i < n \}
"><g data-mml-node="msub" data-latex="\mathit{rests}_p"><g data-mml-node="TeXAtom" data-latex="\mathit{rests}" data-mjx-texclass="ORD"><g data-mml-node="mi" data-latex="rests"><use data-c="72" xlink:href="#MJX-263-STX-MI-72"></use><use data-c="65" xlink:href="#MJX-263-STX-MI-65" transform="translate(383,0)"></use><use data-c="73" xlink:href="#MJX-263-STX-MI-73" transform="translate(795,0)"></use><use data-c="74" xlink:href="#MJX-263-STX-MI-74" transform="translate(1162,0)"></use><use data-c="73" xlink:href="#MJX-263-STX-MI-73" transform="translate(1460,0)"></use></g></g><g data-mml-node="mi" transform="translate(1860,-150) scale(0.707)" data-latex="p"><use data-c="1D45D" xlink:href="#MJX-263-STX-I-1D45D"></use></g></g><g data-mml-node="mo" data-latex="\equiv" transform="translate(2610.6,0)"><use data-c="2261" xlink:href="#MJX-263-STX-N-2261"></use></g><g data-mml-node="mo" data-latex="\{" transform="translate(3608.4,0) translate(0 -19.5)"><use data-c="7B" xlink:href="#MJX-263-STX-N-7B"></use></g><g data-mml-node="mspace" data-latex="\," transform="translate(3935.4,0)"></g><g data-mml-node="msub" data-latex="r_i" transform="translate(4102.4,0)"><g data-mml-node="mi" data-latex="r"><use data-c="1D45F" xlink:href="#MJX-263-STX-I-1D45F"></use></g><g data-mml-node="mi" transform="translate(445,-150) scale(0.707)" data-latex="i"><use data-c="1D456" xlink:href="#MJX-263-STX-I-1D456"></use></g></g><g data-mml-node="mo" data-latex="\mid" transform="translate(5068.9,0)"><use data-c="2223" xlink:href="#MJX-263-STX-N-2223"></use></g><g data-mml-node="mn" data-latex="0" transform="translate(5618.7,0)"><use data-c="30" xlink:href="#MJX-263-STX-N-30"></use></g><g data-mml-node="mo" data-latex="\le" transform="translate(6391.5,0)"><use data-c="2264" xlink:href="#MJX-263-STX-N-2264"></use></g><g data-mml-node="mi" data-latex="i" transform="translate(7389.3,0)"><use data-c="1D456" xlink:href="#MJX-263-STX-I-1D456"></use></g><g data-mml-node="mo" data-latex="<" transform="translate(7941,0)"><use data-c="3C" xlink:href="#MJX-263-STX-N-3C"></use></g><g data-mml-node="mi" data-latex="n" transform="translate(8938.8,0)"><use data-c="1D45B" xlink:href="#MJX-263-STX-I-1D45B"></use></g><g data-mml-node="mo" data-latex="\}" transform="translate(9503.8,0) translate(0 -19.5)"><use data-c="7D" xlink:href="#MJX-263-STX-N-7D"></use></g></g></g></svg></mjx-container></div><p>Next, melody and harmony.</p>
<p>To apply melodic constraints, we must know if two notes are <em>consecutive</em>, and to apply harmonic constraints, we must know if a chord and note are <em>simultaneous</em>.
In a very general setting like ours,
this information may not yet be available, since it may be produced as a result of the search.</p>
<p>For example, we won’t know if a chord and note are simultaneous if we have not yet determined their rhythm, which may in turn be affected by harmonic constraints, as a certain rhythm may not be allowed if it results in a dissonant chord.
This is called the <em>inaccessible score context problem</em>, from Section 6.3 of the <a href="https://strasheela.sourceforge.net/documents/TorstenAnders-PhDThesis.pdf">Strasheela thesis</a>.</p>
<p>The solution we use is logical implication, which this representation makes easy.
A chord and note are simultaneous if their duration variables overlap, and harmony constraints are applied if the simultaneous note is not a rest.</p>
<div style="display: flex; align-items: center;"><mjx-container class="MathJax" jax="SVG" overflow="overflow" display="true"><svg style="vertical-align: -0.632ex;" xmlns="http://www.w3.org/2000/svg" width="42.62ex" height="2.127ex" role="img" focusable="false" viewBox="0 -716 20415 1018.7" xmlns:xlink="http://www.w3.org/1999/xlink"><defs><path id="MJX-264-STX-I-1D460" d="M378 479L359 479L333 452L330 452C318 459 281 479 228 479C137 479 92 425 92 357C92 295 139 260 180 221C218 185 254 150 254 96C254 44 222 23 176 23C108 23 82 69 72 156L47 156L21-11L43-11L67 16L70 16C84 10 122-11 185-11C298-11 337 55 337 113C337 177 301 214 258 260C214 307 163 343 163 385C163 414 184 449 236 449C295 449 328 400 331 323L355 323Z"></path><path id="MJX-264-STX-I-1D456" d="M219 476L197 476L57 465L57 438C57 438 74 440 91 440C118 440 123 424 123 411C123 394 120 380 120 380L69 142C56 83 52 61 52 44C52 9 75-9 115-9C181-9 220 47 255 96L235 111C219 93 191 59 157 59C145 59 139 65 139 78C139 92 144 120 144 120M243 610C243 643 224 665 191 665C158 665 136 644 136 610C136 575 158 556 188 556C218 556 243 576 243 610Z"></path><path id="MJX-264-STX-I-1D45A" d="M403 0L435 138C472 228 587 407 649 407C672 407 679 390 679 367C679 346 670 308 663 282L612 88C611 83 607 65 607 49C607 19 622-10 673-10C744-10 784 60 810 97L790 112C774 93 750 60 715 60C702 60 696 68 696 79C696 91 699 103 699 103L754 334C757 348 764 382 764 408C764 444 750 479 700 479C596 479 514 346 471 270L463 270L480 334C481 339 489 379 489 408C489 444 476 479 426 479C312 479 227 338 185 259L177 259L227 476L204 476L66 465L66 438C66 438 85 440 98 440C122 440 130 430 130 413C130 398 127 380 127 380L47 0L129 0L160 137C210 250 309 407 375 407C398 407 405 390 405 367C405 351 400 328 399 325C375 215 349 107 320 0Z"></path><path id="MJX-264-STX-I-1D462" d="M42 355C58 375 82 409 116 409C130 409 137 401 137 389C137 376 133 362 133 362L77 135C73 121 67 88 67 62C67 25 82-10 133-10C250-10 330 127 368 197L377 197C360 132 345 92 345 45C345 1 378-9 405-9C466-9 503 32 547 96L526 111C526 111 489 59 453 59C437 59 432 68 432 76C432 91 438 119 438 119L510 470L427 470L397 332C374 230 257 62 183 62C160 62 153 79 153 103C153 123 160 151 160 151L220 380C221 385 225 402 225 419C225 448 210 477 162 477C91 477 47 408 22 371Z"></path><path id="MJX-264-STX-I-1D459" d="M256 705L234 705L96 694L96 668C96 668 112 670 130 670C157 670 161 653 161 640C161 624 158 608 158 608L66 144C58 101 52 66 52 44C52 9 75-9 115-9C181-9 220 47 255 96L235 111C219 93 193 59 159 59C147 59 141 65 141 78C141 92 146 120 146 120Z"></path><path id="MJX-264-STX-I-1D461" d="M317 467L216 467L244 593L214 593C164 506 139 482 75 449L71 428L128 428L60 101C58 91 53 61 53 44C53 13 72-9 114-9C193-9 235 65 264 104L244 119C209 74 188 59 159 59C145 59 142 69 142 80C142 97 149 130 149 130L208 428L309 428Z"></path><path id="MJX-264-STX-I-1D44E" d="M502 472L449 472L413 426L409 426C388 456 358 479 305 479C174 479 49 341 49 159C49 43 100-12 172-12C229-12 288 22 339 85L346 85C343 67 339 53 339 38C339 5 359-10 395-10C455-10 497 33 539 97L519 112C506 95 477 60 445 60C429 60 425 68 425 81C425 96 430 118 430 118M389 344C389 313 378 240 358 181C329 96 285 54 218 54C168 54 138 77 138 169C138 303 202 441 302 441C358 441 389 397 389 344Z"></path><path id="MJX-264-STX-I-1D45B" d="M521 112C506 93 481 60 447 60C433 60 428 68 428 79C428 91 430 103 430 103L487 334C490 348 496 382 496 408C496 444 481 479 430 479C312 479 227 334 185 259L177 259L227 476L205 476L66 465L66 438C66 438 86 440 99 440C122 440 131 430 131 413C131 398 128 380 128 380L47 0L129 0L165 158C197 227 307 407 380 407C403 407 410 390 410 367C410 347 403 319 403 319L344 88C343 83 339 65 339 49C339 19 354-10 404-10C476-10 516 60 542 97Z"></path><path id="MJX-264-STX-I-1D452" d="M357 122C317 72 262 57 216 57C149 57 112 88 112 189L112 202C228 211 404 262 404 390C404 467 339 479 296 479C139 479 28 319 28 164C28 84 58-12 177-12C243-12 315 17 375 107M114 231C133 330 202 448 276 448C306 448 318 428 318 393C318 298 227 238 114 231Z"></path><path id="MJX-264-STX-I-1D45C" d="M460 297C460 416 378 479 293 479C136 479 26 330 26 175C26 77 73-10 189-10C348-10 460 129 460 297M369 307C369 133 299 25 200 25C134 25 117 93 117 166C117 345 199 445 285 445C345 445 369 381 369 307Z"></path><path id="MJX-264-STX-N-28" d="M45 270C45 47 150-112 311-196L327-170C181-71 127 66 127 270C127 474 181 611 327 710L311 736C150 652 45 493 45 270Z"></path><path id="MJX-264-STX-N-2C" d="M70-132C110-114 194-80 194 33C194 88 167 121 117 121C77 121 55 94 55 62C55 33 71 8 110 8C121 8 130 10 141 14C141-67 95-91 58-107Z"></path><path id="MJX-264-STX-I-1D450" d="M358 123C327 85 288 57 219 57C161 57 109 77 109 184C109 300 170 446 280 446C312 446 329 434 329 419C329 403 310 375 310 349C310 327 324 314 348 314C385 314 404 346 404 386C404 451 353 479 290 479C146 479 26 335 26 169C26 68 71-12 179-12C269-12 334 44 375 108Z"></path><path id="MJX-264-STX-N-29" d="M312 270C312 493 207 652 46 736L30 710C176 611 230 474 230 270C230 66 176-71 30-170L46-196C207-112 312 47 312 270Z"></path><path id="MJX-264-STX-N-2261" d="M658 28L658 96L62 96L62 28M658 225L658 293L62 293L62 225M658 422L658 489L62 489L62 422Z"></path><path id="MJX-264-STX-I-1D451" d="M529 705L507 705L371 694L371 668C371 668 390 670 402 670C432 670 437 656 437 639C437 625 434 607 434 607L401 439L398 439C374 464 341 479 296 479C157 479 37 340 37 162C37 45 89-12 163-12C222-12 279 24 329 85L337 85C335 73 332 54 332 42C332 11 353-10 393-10C462-10 499 53 530 97L510 112C496 93 469 60 437 60C424 60 418 65 418 79C418 92 423 121 423 121M346 177C319 101 274 54 206 54C157 54 126 78 126 169C126 299 190 441 291 441C349 441 377 394 377 351C377 333 372 252 346 177Z"></path><path id="MJX-264-STX-N-3C" d="M650-25L650 42L207 260L650 478L650 547L71 265L71 255Z"></path><path id="MJX-264-STX-MI-65" d="M179-12C243-12 312 17 372 107L354 122C315 74 269 57 219 57C152 57 116 88 116 189C116 193 116 198 116 202C233 211 401 264 401 389C401 467 337 479 294 479C132 479 32 307 32 163C32 75 69-12 179-12M120 232C135 327 198 448 273 448C303 448 315 429 315 393C315 298 231 239 120 232Z"></path><path id="MJX-264-STX-MI-6E" d="M400-10C471-10 511 60 537 97L516 112C501 93 477 60 442 60C429 60 423 68 423 79C423 91 426 103 426 103L482 334C485 348 491 375 491 408C491 444 476 479 427 479C312 479 228 334 187 259L179 259L229 476L207 476L68 465L68 438C68 438 88 440 101 440C124 440 134 430 134 413C134 398 130 380 130 380L49 0L131 0L167 158C199 227 306 407 377 407C399 407 406 390 406 367C406 347 399 319 399 319L340 88C338 83 334 65 334 49C334 19 350-10 400-10Z"></path><path id="MJX-264-STX-MI-64" d="M161-12C220-12 270 25 318 85L326 85C324 73 321 54 321 42C321 11 341-10 380-10C446-10 483 48 517 97L497 112C483 93 456 60 424 60C411 60 405 65 405 79C405 92 410 121 410 121L521 705L499 705L362 694L362 668C362 668 380 670 392 670C422 670 427 656 427 639C427 625 424 607 424 607L392 439L389 439C366 464 330 479 286 479C147 479 35 330 35 159C35 37 92-12 161-12M196 54C153 54 123 80 123 171C123 301 185 441 281 441C330 441 364 404 364 347C364 318 355 254 336 176C320 114 262 54 196 54Z"></path><path id="MJX-264-STX-N-2227" d="M604-30L322 549L312 549L32-30L105-30L317 412L531-30Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math" data-latex="simultaneous_{(n,c)} \equiv d_n < \mathit{end}(d_c) \wedge d_c < \mathit{end}(d_n)
"><g data-mml-node="mi" data-latex="s"><use data-c="1D460" xlink:href="#MJX-264-STX-I-1D460"></use></g><g data-mml-node="mi" data-latex="i" transform="translate(386,0)"><use data-c="1D456" xlink:href="#MJX-264-STX-I-1D456"></use></g><g data-mml-node="mi" data-latex="m" transform="translate(660,0)"><use data-c="1D45A" xlink:href="#MJX-264-STX-I-1D45A"></use></g><g data-mml-node="mi" data-latex="u" transform="translate(1490,0)"><use data-c="1D462" xlink:href="#MJX-264-STX-I-1D462"></use></g><g data-mml-node="mi" data-latex="l" transform="translate(2055,0)"><use data-c="1D459" xlink:href="#MJX-264-STX-I-1D459"></use></g><g data-mml-node="mi" data-latex="t" transform="translate(2333,0)"><use data-c="1D461" xlink:href="#MJX-264-STX-I-1D461"></use></g><g data-mml-node="mi" data-latex="a" transform="translate(2671,0)"><use data-c="1D44E" xlink:href="#MJX-264-STX-I-1D44E"></use></g><g data-mml-node="mi" data-latex="n" transform="translate(3226,0)"><use data-c="1D45B" xlink:href="#MJX-264-STX-I-1D45B"></use></g><g data-mml-node="mi" data-latex="e" transform="translate(3791,0)"><use data-c="1D452" xlink:href="#MJX-264-STX-I-1D452"></use></g><g data-mml-node="mi" data-latex="o" transform="translate(4215,0)"><use data-c="1D45C" xlink:href="#MJX-264-STX-I-1D45C"></use></g><g data-mml-node="mi" data-latex="u" transform="translate(4701,0)"><use data-c="1D462" xlink:href="#MJX-264-STX-I-1D462"></use></g><g data-mml-node="msub" data-latex="s_{(n,c)}" transform="translate(5266,0)"><g data-mml-node="mi" data-latex="s"><use data-c="1D460" xlink:href="#MJX-264-STX-I-1D460"></use></g><g data-mml-node="TeXAtom" transform="translate(419,-150) scale(0.707)" data-latex="{(n,c)}" data-mjx-texclass="ORD"><g data-mml-node="mo" data-latex="(" transform="translate(0 -20)"><use data-c="28" xlink:href="#MJX-264-STX-N-28"></use></g><g data-mml-node="mi" data-latex="n" transform="translate(357,0)"><use data-c="1D45B" xlink:href="#MJX-264-STX-I-1D45B"></use></g><g data-mml-node="mo" data-latex="," transform="translate(922,0)"><use data-c="2C" xlink:href="#MJX-264-STX-N-2C"></use></g><g data-mml-node="mi" data-latex="c" transform="translate(1167,0)"><use data-c="1D450" xlink:href="#MJX-264-STX-I-1D450"></use></g><g data-mml-node="mo" data-latex=")" transform="translate(1581,0) translate(0 -20)"><use data-c="29" xlink:href="#MJX-264-STX-N-29"></use></g></g></g><g data-mml-node="mo" data-latex="\equiv" transform="translate(7383.2,0)"><use data-c="2261" xlink:href="#MJX-264-STX-N-2261"></use></g><g data-mml-node="msub" data-latex="d_n" transform="translate(8380.9,0)"><g data-mml-node="mi" data-latex="d"><use data-c="1D451" xlink:href="#MJX-264-STX-I-1D451"></use></g><g data-mml-node="mi" transform="translate(589,-150) scale(0.707)" data-latex="n"><use data-c="1D45B" xlink:href="#MJX-264-STX-I-1D45B"></use></g></g><g data-mml-node="mo" data-latex="<" transform="translate(9697.2,0)"><use data-c="3C" xlink:href="#MJX-264-STX-N-3C"></use></g><g data-mml-node="TeXAtom" data-latex="\mathit{end}" data-mjx-texclass="ORD" transform="translate(10695,0)"><g data-mml-node="mi" data-latex="end"><use data-c="65" xlink:href="#MJX-264-STX-MI-65"></use><use data-c="6E" xlink:href="#MJX-264-STX-MI-6E" transform="translate(412,0)"></use><use data-c="64" xlink:href="#MJX-264-STX-MI-64" transform="translate(976,0)"></use></g></g><g data-mml-node="mo" data-latex="(" transform="translate(12212,0) translate(0 -20)"><use data-c="28" xlink:href="#MJX-264-STX-N-28"></use></g><g data-mml-node="msub" data-latex="d_c" transform="translate(12569,0)"><g data-mml-node="mi" data-latex="d"><use data-c="1D451" xlink:href="#MJX-264-STX-I-1D451"></use></g><g data-mml-node="mi" transform="translate(589,-150) scale(0.707)" data-latex="c"><use data-c="1D450" xlink:href="#MJX-264-STX-I-1D450"></use></g></g><g data-mml-node="mo" data-latex=")" transform="translate(13500.7,0) translate(0 -20)"><use data-c="29" xlink:href="#MJX-264-STX-N-29"></use></g><g data-mml-node="mo" data-latex="\wedge" transform="translate(14080,0)"><use data-c="2227" xlink:href="#MJX-264-STX-N-2227"></use></g><g data-mml-node="msub" data-latex="d_c" transform="translate(14938.2,0)"><g data-mml-node="mi" data-latex="d"><use data-c="1D451" xlink:href="#MJX-264-STX-I-1D451"></use></g><g data-mml-node="mi" transform="translate(589,-150) scale(0.707)" data-latex="c"><use data-c="1D450" xlink:href="#MJX-264-STX-I-1D450"></use></g></g><g data-mml-node="mo" data-latex="<" transform="translate(16147.7,0)"><use data-c="3C" xlink:href="#MJX-264-STX-N-3C"></use></g><g data-mml-node="TeXAtom" data-latex="\mathit{end}" data-mjx-texclass="ORD" transform="translate(17145.5,0)"><g data-mml-node="mi" data-latex="end"><use data-c="65" xlink:href="#MJX-264-STX-MI-65"></use><use data-c="6E" xlink:href="#MJX-264-STX-MI-6E" transform="translate(412,0)"></use><use data-c="64" xlink:href="#MJX-264-STX-MI-64" transform="translate(976,0)"></use></g></g><g data-mml-node="mo" data-latex="(" transform="translate(18662.5,0) translate(0 -20)"><use data-c="28" xlink:href="#MJX-264-STX-N-28"></use></g><g data-mml-node="msub" data-latex="d_n" transform="translate(19019.5,0)"><g data-mml-node="mi" data-latex="d"><use data-c="1D451" xlink:href="#MJX-264-STX-I-1D451"></use></g><g data-mml-node="mi" transform="translate(589,-150) scale(0.707)" data-latex="n"><use data-c="1D45B" xlink:href="#MJX-264-STX-I-1D45B"></use></g></g><g data-mml-node="mo" data-latex=")" transform="translate(20058,0) translate(0 -20)"><use data-c="29" xlink:href="#MJX-264-STX-N-29"></use></g></g></g></svg></mjx-container></div><div style="display: flex; align-items: center;"><mjx-container class="MathJax" jax="SVG" overflow="overflow" display="true"><svg style="vertical-align: -0.632ex;" xmlns="http://www.w3.org/2000/svg" width="47.78ex" height="2.127ex" role="img" focusable="false" viewBox="0 -716 22886.6 1018.7" xmlns:xlink="http://www.w3.org/1999/xlink"><defs><path id="MJX-265-STX-I-210E" d="M528 112C513 93 489 60 453 60C440 60 434 68 434 79C434 91 438 103 438 103L494 334C497 348 503 382 503 408C503 444 488 479 437 479C319 479 227 334 185 259L177 259L278 706L255 706L117 695L117 668C117 668 137 670 150 670C173 670 182 660 182 644C182 629 179 610 179 610L47 0L129 0L165 158C197 227 313 407 387 407C410 407 417 390 417 367C417 347 410 319 410 319L351 88C349 83 346 65 346 49C346 19 361-10 411-10C483-10 523 60 549 97Z"></path><path id="MJX-265-STX-I-1D44E" d="M502 472L449 472L413 426L409 426C388 456 358 479 305 479C174 479 49 341 49 159C49 43 100-12 172-12C229-12 288 22 339 85L346 85C343 67 339 53 339 38C339 5 359-10 395-10C455-10 497 33 539 97L519 112C506 95 477 60 445 60C429 60 425 68 425 81C425 96 430 118 430 118M389 344C389 313 378 240 358 181C329 96 285 54 218 54C168 54 138 77 138 169C138 303 202 441 302 441C358 441 389 397 389 344Z"></path><path id="MJX-265-STX-I-1D45F" d="M161 259L212 476L190 476L51 465L51 438C51 438 71 440 82 440C110 440 115 429 115 410C115 392 110 366 106 348L32 0L117 0L147 140C163 180 253 395 301 395C304 395 314 358 346 358C372 358 399 377 399 421C399 460 375 479 343 479C263 479 203 326 171 259Z"></path><path id="MJX-265-STX-I-1D45A" d="M403 0L435 138C472 228 587 407 649 407C672 407 679 390 679 367C679 346 670 308 663 282L612 88C611 83 607 65 607 49C607 19 622-10 673-10C744-10 784 60 810 97L790 112C774 93 750 60 715 60C702 60 696 68 696 79C696 91 699 103 699 103L754 334C757 348 764 382 764 408C764 444 750 479 700 479C596 479 514 346 471 270L463 270L480 334C481 339 489 379 489 408C489 444 476 479 426 479C312 479 227 338 185 259L177 259L227 476L204 476L66 465L66 438C66 438 85 440 98 440C122 440 130 430 130 413C130 398 127 380 127 380L47 0L129 0L160 137C210 250 309 407 375 407C398 407 405 390 405 367C405 351 400 328 399 325C375 215 349 107 320 0Z"></path><path id="MJX-265-STX-I-1D45C" d="M460 297C460 416 378 479 293 479C136 479 26 330 26 175C26 77 73-10 189-10C348-10 460 129 460 297M369 307C369 133 299 25 200 25C134 25 117 93 117 166C117 345 199 445 285 445C345 445 369 381 369 307Z"></path><path id="MJX-265-STX-I-1D45B" d="M521 112C506 93 481 60 447 60C433 60 428 68 428 79C428 91 430 103 430 103L487 334C490 348 496 382 496 408C496 444 481 479 430 479C312 479 227 334 185 259L177 259L227 476L205 476L66 465L66 438C66 438 86 440 99 440C122 440 131 430 131 413C131 398 128 380 128 380L47 0L129 0L165 158C197 227 307 407 380 407C403 407 410 390 410 367C410 347 403 319 403 319L344 88C343 83 339 65 339 49C339 19 354-10 404-10C476-10 516 60 542 97Z"></path><path id="MJX-265-STX-I-1D466" d="M251 325C239 405 232 437 210 475L195 475L53 464L53 435C53 435 74 437 88 437C149 437 154 388 161 343L220-9C192-52 112-165 93-165C71-165 60-112 22-112C-1-112-17-125-17-155C-17-192 18-220 60-220C136-220 197-112 289 15C341 87 398 173 452 268C484 322 496 367 496 406C496 449 470 482 433 482C404 482 389 464 389 443C389 405 438 377 438 351C438 327 429 303 405 264L290 79L284 79L275 179Z"></path><path id="MJX-265-STX-N-28" d="M45 270C45 47 150-112 311-196L327-170C181-71 127 66 127 270C127 474 181 611 327 710L311 736C150 652 45 493 45 270Z"></path><path id="MJX-265-STX-N-2C" d="M70-132C110-114 194-80 194 33C194 88 167 121 117 121C77 121 55 94 55 62C55 33 71 8 110 8C121 8 130 10 141 14C141-67 95-91 58-107Z"></path><path id="MJX-265-STX-I-1D450" d="M358 123C327 85 288 57 219 57C161 57 109 77 109 184C109 300 170 446 280 446C312 446 329 434 329 419C329 403 310 375 310 349C310 327 324 314 348 314C385 314 404 346 404 386C404 451 353 479 290 479C146 479 26 335 26 169C26 68 71-12 179-12C269-12 334 44 375 108Z"></path><path id="MJX-265-STX-N-29" d="M312 270C312 493 207 652 46 736L30 710C176 611 230 474 230 270C230 66 176-71 30-170L46-196C207-112 312 47 312 270Z"></path><path id="MJX-265-STX-N-2261" d="M658 28L658 96L62 96L62 28M658 225L658 293L62 293L62 225M658 422L658 489L62 489L62 422Z"></path><path id="MJX-265-STX-N-AC" d="M638 83L638 416L62 416L62 348L566 348L566 83Z"></path><path id="MJX-265-STX-N-2227" d="M604-30L322 549L312 549L32-30L105-30L317 412L531-30Z"></path><path id="MJX-265-STX-I-1D460" d="M378 479L359 479L333 452L330 452C318 459 281 479 228 479C137 479 92 425 92 357C92 295 139 260 180 221C218 185 254 150 254 96C254 44 222 23 176 23C108 23 82 69 72 156L47 156L21-11L43-11L67 16L70 16C84 10 122-11 185-11C298-11 337 55 337 113C337 177 301 214 258 260C214 307 163 343 163 385C163 414 184 449 236 449C295 449 328 400 331 323L355 323Z"></path><path id="MJX-265-STX-I-1D456" d="M219 476L197 476L57 465L57 438C57 438 74 440 91 440C118 440 123 424 123 411C123 394 120 380 120 380L69 142C56 83 52 61 52 44C52 9 75-9 115-9C181-9 220 47 255 96L235 111C219 93 191 59 157 59C145 59 139 65 139 78C139 92 144 120 144 120M243 610C243 643 224 665 191 665C158 665 136 644 136 610C136 575 158 556 188 556C218 556 243 576 243 610Z"></path><path id="MJX-265-STX-I-1D462" d="M42 355C58 375 82 409 116 409C130 409 137 401 137 389C137 376 133 362 133 362L77 135C73 121 67 88 67 62C67 25 82-10 133-10C250-10 330 127 368 197L377 197C360 132 345 92 345 45C345 1 378-9 405-9C466-9 503 32 547 96L526 111C526 111 489 59 453 59C437 59 432 68 432 76C432 91 438 119 438 119L510 470L427 470L397 332C374 230 257 62 183 62C160 62 153 79 153 103C153 123 160 151 160 151L220 380C221 385 225 402 225 419C225 448 210 477 162 477C91 477 47 408 22 371Z"></path><path id="MJX-265-STX-I-1D459" d="M256 705L234 705L96 694L96 668C96 668 112 670 130 670C157 670 161 653 161 640C161 624 158 608 158 608L66 144C58 101 52 66 52 44C52 9 75-9 115-9C181-9 220 47 255 96L235 111C219 93 193 59 159 59C147 59 141 65 141 78C141 92 146 120 146 120Z"></path><path id="MJX-265-STX-I-1D461" d="M317 467L216 467L244 593L214 593C164 506 139 482 75 449L71 428L128 428L60 101C58 91 53 61 53 44C53 13 72-9 114-9C193-9 235 65 264 104L244 119C209 74 188 59 159 59C145 59 142 69 142 80C142 97 149 130 149 130L208 428L309 428Z"></path><path id="MJX-265-STX-I-1D452" d="M357 122C317 72 262 57 216 57C149 57 112 88 112 189L112 202C228 211 404 262 404 390C404 467 339 479 296 479C139 479 28 319 28 164C28 84 58-12 177-12C243-12 315 17 375 107M114 231C133 330 202 448 276 448C306 448 318 428 318 393C318 298 227 238 114 231Z"></path><path id="MJX-265-STX-N-21D2" d="M826 264C702 358 571 445 451 564L429 543C454 515 480 486 506 460C520 444 529 438 529 418C529 409 520 395 502 395L0 395L0 327L649 327C683 308 710 283 710 259C710 234 683 213 650 190L0 190L0 123L502 123C520 123 529 108 529 100C529 84 522 75 505 57C494 46 454 3 429-26L451-46C571 72 700 159 826 254Z"></path><path id="MJX-265-STX-N-2208" d="M646 293L155 293C165 390 223 476 352 476L646 476L646 543L347 543C183 543 75 411 75 260C75 108 181-26 344-26L646-26L646 42L353 42C224 42 166 128 155 225L646 225Z"></path><path id="MJX-265-STX-MI-6E" d="M400-10C471-10 511 60 537 97L516 112C501 93 477 60 442 60C429 60 423 68 423 79C423 91 426 103 426 103L482 334C485 348 491 375 491 408C491 444 476 479 427 479C312 479 228 334 187 259L179 259L229 476L207 476L68 465L68 438C68 438 88 440 101 440C124 440 134 430 134 413C134 398 130 380 130 380L49 0L131 0L167 158C199 227 306 407 377 407C399 407 406 390 406 367C406 347 399 319 399 319L340 88C338 83 334 65 334 49C334 19 350-10 400-10Z"></path><path id="MJX-265-STX-MI-6F" d="M206-10C345-10 453 125 453 284C453 389 400 479 281 479C139 479 35 340 35 180C35 66 95-10 206-10M216 25C141 25 123 94 123 169C123 292 170 445 274 445C345 445 363 378 363 297C363 178 312 25 216 25Z"></path><path id="MJX-265-STX-MI-74" d="M115-9C194-9 236 65 265 104L245 119C210 74 189 59 160 59C146 59 143 69 143 80C143 97 150 130 150 130L211 428L310 428L318 467L219 467L245 593L215 593C165 506 140 482 76 449L72 428L129 428L61 101C59 91 54 61 54 44C54 13 73-9 115-9Z"></path><path id="MJX-265-STX-MI-65" d="M179-12C243-12 312 17 372 107L354 122C315 74 269 57 219 57C152 57 116 88 116 189C116 193 116 198 116 202C233 211 401 264 401 389C401 467 337 479 294 479C132 479 32 307 32 163C32 75 69-12 179-12M120 232C135 327 198 448 273 448C303 448 315 429 315 393C315 298 231 239 120 232Z"></path><path id="MJX-265-STX-MI-73" d="M164-11C277-11 316 55 316 113C316 177 280 214 237 260C193 307 142 343 142 385C142 414 163 449 215 449C274 449 307 400 310 323L334 323L357 479L338 479L312 452L309 452C297 459 260 479 207 479C116 479 71 425 71 357C71 295 118 260 159 221C197 185 233 150 233 96C233 44 201 23 155 23C87 23 61 69 51 156L26 156L0-11L22-11L46 16L49 16C63 10 101-11 164-11Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math" data-latex="harmony_{(n, c)} \equiv \neg r_c \wedge simultaneous_{(n,c)} \implies n \in \mathit{notes}(c)
"><g data-mml-node="mi" data-latex="h"><use data-c="210E" xlink:href="#MJX-265-STX-I-210E"></use></g><g data-mml-node="mi" data-latex="a" transform="translate(569,0)"><use data-c="1D44E" xlink:href="#MJX-265-STX-I-1D44E"></use></g><g data-mml-node="mi" data-latex="r" transform="translate(1124,0)"><use data-c="1D45F" xlink:href="#MJX-265-STX-I-1D45F"></use></g><g data-mml-node="mi" data-latex="m" transform="translate(1536,0)"><use data-c="1D45A" xlink:href="#MJX-265-STX-I-1D45A"></use></g><g data-mml-node="mi" data-latex="o" transform="translate(2366,0)"><use data-c="1D45C" xlink:href="#MJX-265-STX-I-1D45C"></use></g><g data-mml-node="mi" data-latex="n" transform="translate(2852,0)"><use data-c="1D45B" xlink:href="#MJX-265-STX-I-1D45B"></use></g><g data-mml-node="msub" data-latex="y_{(n,c)}" transform="translate(3417,0)"><g data-mml-node="mi" data-latex="y"><use data-c="1D466" xlink:href="#MJX-265-STX-I-1D466"></use></g><g data-mml-node="TeXAtom" transform="translate(543,-150) scale(0.707)" data-latex="{(n,c)}" data-mjx-texclass="ORD"><g data-mml-node="mo" data-latex="(" transform="translate(0 -20)"><use data-c="28" xlink:href="#MJX-265-STX-N-28"></use></g><g data-mml-node="mi" data-latex="n" transform="translate(357,0)"><use data-c="1D45B" xlink:href="#MJX-265-STX-I-1D45B"></use></g><g data-mml-node="mo" data-latex="," transform="translate(922,0)"><use data-c="2C" xlink:href="#MJX-265-STX-N-2C"></use></g><g data-mml-node="mi" data-latex="c" transform="translate(1167,0)"><use data-c="1D450" xlink:href="#MJX-265-STX-I-1D450"></use></g><g data-mml-node="mo" data-latex=")" transform="translate(1581,0) translate(0 -20)"><use data-c="29" xlink:href="#MJX-265-STX-N-29"></use></g></g></g><g data-mml-node="mo" data-latex="\equiv" transform="translate(5658.2,0)"><use data-c="2261" xlink:href="#MJX-265-STX-N-2261"></use></g><g data-mml-node="mi" data-latex="\neg" transform="translate(6655.9,0)"><use data-c="AC" xlink:href="#MJX-265-STX-N-AC"></use></g><g data-mml-node="msub" data-latex="r_c" transform="translate(7375.9,0)"><g data-mml-node="mi" data-latex="r"><use data-c="1D45F" xlink:href="#MJX-265-STX-I-1D45F"></use></g><g data-mml-node="mi" transform="translate(445,-150) scale(0.707)" data-latex="c"><use data-c="1D450" xlink:href="#MJX-265-STX-I-1D450"></use></g></g><g data-mml-node="mo" data-latex="\wedge" transform="translate(8385.9,0)"><use data-c="2227" xlink:href="#MJX-265-STX-N-2227"></use></g><g data-mml-node="mi" data-latex="s" transform="translate(9244.1,0)"><use data-c="1D460" xlink:href="#MJX-265-STX-I-1D460"></use></g><g data-mml-node="mi" data-latex="i" transform="translate(9630.1,0)"><use data-c="1D456" xlink:href="#MJX-265-STX-I-1D456"></use></g><g data-mml-node="mi" data-latex="m" transform="translate(9904.1,0)"><use data-c="1D45A" xlink:href="#MJX-265-STX-I-1D45A"></use></g><g data-mml-node="mi" data-latex="u" transform="translate(10734.1,0)"><use data-c="1D462" xlink:href="#MJX-265-STX-I-1D462"></use></g><g data-mml-node="mi" data-latex="l" transform="translate(11299.1,0)"><use data-c="1D459" xlink:href="#MJX-265-STX-I-1D459"></use></g><g data-mml-node="mi" data-latex="t" transform="translate(11577.1,0)"><use data-c="1D461" xlink:href="#MJX-265-STX-I-1D461"></use></g><g data-mml-node="mi" data-latex="a" transform="translate(11915.1,0)"><use data-c="1D44E" xlink:href="#MJX-265-STX-I-1D44E"></use></g><g data-mml-node="mi" data-latex="n" transform="translate(12470.1,0)"><use data-c="1D45B" xlink:href="#MJX-265-STX-I-1D45B"></use></g><g data-mml-node="mi" data-latex="e" transform="translate(13035.1,0)"><use data-c="1D452" xlink:href="#MJX-265-STX-I-1D452"></use></g><g data-mml-node="mi" data-latex="o" transform="translate(13459.1,0)"><use data-c="1D45C" xlink:href="#MJX-265-STX-I-1D45C"></use></g><g data-mml-node="mi" data-latex="u" transform="translate(13945.1,0)"><use data-c="1D462" xlink:href="#MJX-265-STX-I-1D462"></use></g><g data-mml-node="msub" data-latex="s_{(n,c)}" transform="translate(14510.1,0)"><g data-mml-node="mi" data-latex="s"><use data-c="1D460" xlink:href="#MJX-265-STX-I-1D460"></use></g><g data-mml-node="TeXAtom" transform="translate(419,-150) scale(0.707)" data-latex="{(n,c)}" data-mjx-texclass="ORD"><g data-mml-node="mo" data-latex="(" transform="translate(0 -20)"><use data-c="28" xlink:href="#MJX-265-STX-N-28"></use></g><g data-mml-node="mi" data-latex="n" transform="translate(357,0)"><use data-c="1D45B" xlink:href="#MJX-265-STX-I-1D45B"></use></g><g data-mml-node="mo" data-latex="," transform="translate(922,0)"><use data-c="2C" xlink:href="#MJX-265-STX-N-2C"></use></g><g data-mml-node="mi" data-latex="c" transform="translate(1167,0)"><use data-c="1D450" xlink:href="#MJX-265-STX-I-1D450"></use></g><g data-mml-node="mo" data-latex=")" transform="translate(1581,0) translate(0 -20)"><use data-c="29" xlink:href="#MJX-265-STX-N-29"></use></g></g></g><g data-mml-node="mo" data-latex="\Rightarrow" transform="translate(16627.3,0)"><use data-c="21D2" xlink:href="#MJX-265-STX-N-21D2"></use></g><g data-mml-node="mi" data-latex="n" transform="translate(17792,0)"><use data-c="1D45B" xlink:href="#MJX-265-STX-I-1D45B"></use></g><g data-mml-node="mo" data-latex="\in" transform="translate(18634.8,0)"><use data-c="2208" xlink:href="#MJX-265-STX-N-2208"></use></g><g data-mml-node="TeXAtom" data-latex="\mathit{notes}" data-mjx-texclass="ORD" transform="translate(19632.6,0)"><g data-mml-node="mi" data-latex="notes"><use data-c="6E" xlink:href="#MJX-265-STX-MI-6E"></use><use data-c="6F" xlink:href="#MJX-265-STX-MI-6F" transform="translate(564,0)"></use><use data-c="74" xlink:href="#MJX-265-STX-MI-74" transform="translate(1049,0)"></use><use data-c="65" xlink:href="#MJX-265-STX-MI-65" transform="translate(1347,0)"></use><use data-c="73" xlink:href="#MJX-265-STX-MI-73" transform="translate(1759,0)"></use></g></g><g data-mml-node="mo" data-latex="(" transform="translate(21758.6,0) translate(0 -20)"><use data-c="28" xlink:href="#MJX-265-STX-N-28"></use></g><g data-mml-node="mi" data-latex="c" transform="translate(22115.6,0)"><use data-c="1D450" xlink:href="#MJX-265-STX-I-1D450"></use></g><g data-mml-node="mo" data-latex=")" transform="translate(22529.6,0) translate(0 -20)"><use data-c="29" xlink:href="#MJX-265-STX-N-29"></use></g></g></g></svg></mjx-container></div><p>Two adjacent notes are consecutive if they are both not rests, and melody constraints are applied if notes are consecutive.</p>
<div style="display: flex; align-items: center;"><mjx-container class="MathJax" jax="SVG" overflow="overflow" display="true"><svg style="vertical-align: -0.769ex;" xmlns="http://www.w3.org/2000/svg" width="25.279ex" height="2.158ex" role="img" focusable="false" viewBox="0 -665 12108.5 1033.6" xmlns:xlink="http://www.w3.org/1999/xlink"><defs><path id="MJX-266-STX-I-1D450" d="M358 123C327 85 288 57 219 57C161 57 109 77 109 184C109 300 170 446 280 446C312 446 329 434 329 419C329 403 310 375 310 349C310 327 324 314 348 314C385 314 404 346 404 386C404 451 353 479 290 479C146 479 26 335 26 169C26 68 71-12 179-12C269-12 334 44 375 108Z"></path><path id="MJX-266-STX-I-1D45C" d="M460 297C460 416 378 479 293 479C136 479 26 330 26 175C26 77 73-10 189-10C348-10 460 129 460 297M369 307C369 133 299 25 200 25C134 25 117 93 117 166C117 345 199 445 285 445C345 445 369 381 369 307Z"></path><path id="MJX-266-STX-I-1D45B" d="M521 112C506 93 481 60 447 60C433 60 428 68 428 79C428 91 430 103 430 103L487 334C490 348 496 382 496 408C496 444 481 479 430 479C312 479 227 334 185 259L177 259L227 476L205 476L66 465L66 438C66 438 86 440 99 440C122 440 131 430 131 413C131 398 128 380 128 380L47 0L129 0L165 158C197 227 307 407 380 407C403 407 410 390 410 367C410 347 403 319 403 319L344 88C343 83 339 65 339 49C339 19 354-10 404-10C476-10 516 60 542 97Z"></path><path id="MJX-266-STX-I-1D460" d="M378 479L359 479L333 452L330 452C318 459 281 479 228 479C137 479 92 425 92 357C92 295 139 260 180 221C218 185 254 150 254 96C254 44 222 23 176 23C108 23 82 69 72 156L47 156L21-11L43-11L67 16L70 16C84 10 122-11 185-11C298-11 337 55 337 113C337 177 301 214 258 260C214 307 163 343 163 385C163 414 184 449 236 449C295 449 328 400 331 323L355 323Z"></path><path id="MJX-266-STX-I-1D452" d="M357 122C317 72 262 57 216 57C149 57 112 88 112 189L112 202C228 211 404 262 404 390C404 467 339 479 296 479C139 479 28 319 28 164C28 84 58-12 177-12C243-12 315 17 375 107M114 231C133 330 202 448 276 448C306 448 318 428 318 393C318 298 227 238 114 231Z"></path><path id="MJX-266-STX-I-1D462" d="M42 355C58 375 82 409 116 409C130 409 137 401 137 389C137 376 133 362 133 362L77 135C73 121 67 88 67 62C67 25 82-10 133-10C250-10 330 127 368 197L377 197C360 132 345 92 345 45C345 1 378-9 405-9C466-9 503 32 547 96L526 111C526 111 489 59 453 59C437 59 432 68 432 76C432 91 438 119 438 119L510 470L427 470L397 332C374 230 257 62 183 62C160 62 153 79 153 103C153 123 160 151 160 151L220 380C221 385 225 402 225 419C225 448 210 477 162 477C91 477 47 408 22 371Z"></path><path id="MJX-266-STX-I-1D461" d="M317 467L216 467L244 593L214 593C164 506 139 482 75 449L71 428L128 428L60 101C58 91 53 61 53 44C53 13 72-9 114-9C193-9 235 65 264 104L244 119C209 74 188 59 159 59C145 59 142 69 142 80C142 97 149 130 149 130L208 428L309 428Z"></path><path id="MJX-266-STX-I-1D456" d="M219 476L197 476L57 465L57 438C57 438 74 440 91 440C118 440 123 424 123 411C123 394 120 380 120 380L69 142C56 83 52 61 52 44C52 9 75-9 115-9C181-9 220 47 255 96L235 111C219 93 191 59 157 59C145 59 139 65 139 78C139 92 144 120 144 120M243 610C243 643 224 665 191 665C158 665 136 644 136 610C136 575 158 556 188 556C218 556 243 576 243 610Z"></path><path id="MJX-266-STX-I-1D463" d="M200 476L53 465L53 437C53 437 83 440 99 440C117 440 123 426 123 409C123 389 116 365 113 354L93 278C82 236 71 183 71 135C71 58 100-9 200-9C380-9 479 206 479 358C479 429 448 479 403 479C382 479 365 464 365 437C365 393 426 369 426 299C426 206 368 55 231 55C170 55 153 99 153 151C153 196 166 249 175 284L222 476Z"></path><path id="MJX-266-STX-N-28" d="M45 270C45 47 150-112 311-196L327-170C181-71 127 66 127 270C127 474 181 611 327 710L311 736C150 652 45 493 45 270Z"></path><path id="MJX-266-STX-N-2C" d="M70-132C110-114 194-80 194 33C194 88 167 121 117 121C77 121 55 94 55 62C55 33 71 8 110 8C121 8 130 10 141 14C141-67 95-91 58-107Z"></path><path id="MJX-266-STX-I-1D457" d="M214 49C203-11 167-192 116-192C77-192 105-104 49-104C21-104 9-129 9-150C9-188 35-225 99-225C236-225 287-8 304 88L374 476L352 476L212 465L212 438C212 438 229 440 246 440C273 440 278 424 278 411C278 394 275 380 275 380M400 610C400 642 379 665 346 665C313 665 292 644 292 610C292 575 313 557 346 557C379 557 400 576 400 610Z"></path><path id="MJX-266-STX-N-29" d="M312 270C312 493 207 652 46 736L30 710C176 611 230 474 230 270C230 66 176-71 30-170L46-196C207-112 312 47 312 270Z"></path><path id="MJX-266-STX-N-2261" d="M658 28L658 96L62 96L62 28M658 225L658 293L62 293L62 225M658 422L658 489L62 489L62 422Z"></path><path id="MJX-266-STX-N-AC" d="M638 83L638 416L62 416L62 348L566 348L566 83Z"></path><path id="MJX-266-STX-I-1D45F" d="M161 259L212 476L190 476L51 465L51 438C51 438 71 440 82 440C110 440 115 429 115 410C115 392 110 366 106 348L32 0L117 0L147 140C163 180 253 395 301 395C304 395 314 358 346 358C372 358 399 377 399 421C399 460 375 479 343 479C263 479 203 326 171 259Z"></path><path id="MJX-266-STX-N-2227" d="M604-30L322 549L312 549L32-30L105-30L317 412L531-30Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math" data-latex="consecutive_{(n_i,n_j)} \equiv \neg r_i \wedge \neg r_j
"><g data-mml-node="mi" data-latex="c"><use data-c="1D450" xlink:href="#MJX-266-STX-I-1D450"></use></g><g data-mml-node="mi" data-latex="o" transform="translate(414,0)"><use data-c="1D45C" xlink:href="#MJX-266-STX-I-1D45C"></use></g><g data-mml-node="mi" data-latex="n" transform="translate(900,0)"><use data-c="1D45B" xlink:href="#MJX-266-STX-I-1D45B"></use></g><g data-mml-node="mi" data-latex="s" transform="translate(1465,0)"><use data-c="1D460" xlink:href="#MJX-266-STX-I-1D460"></use></g><g data-mml-node="mi" data-latex="e" transform="translate(1851,0)"><use data-c="1D452" xlink:href="#MJX-266-STX-I-1D452"></use></g><g data-mml-node="mi" data-latex="c" transform="translate(2275,0)"><use data-c="1D450" xlink:href="#MJX-266-STX-I-1D450"></use></g><g data-mml-node="mi" data-latex="u" transform="translate(2689,0)"><use data-c="1D462" xlink:href="#MJX-266-STX-I-1D462"></use></g><g data-mml-node="mi" data-latex="t" transform="translate(3254,0)"><use data-c="1D461" xlink:href="#MJX-266-STX-I-1D461"></use></g><g data-mml-node="mi" data-latex="i" transform="translate(3592,0)"><use data-c="1D456" xlink:href="#MJX-266-STX-I-1D456"></use></g><g data-mml-node="mi" data-latex="v" transform="translate(3866,0)"><use data-c="1D463" xlink:href="#MJX-266-STX-I-1D463"></use></g><g data-mml-node="msub" data-latex="e_{(n_i,n_j)}" transform="translate(4370,0)"><g data-mml-node="mi" data-latex="e"><use data-c="1D452" xlink:href="#MJX-266-STX-I-1D452"></use></g><g data-mml-node="TeXAtom" transform="translate(457,-150) scale(0.707)" data-latex="{(n_i,n_j)}" data-mjx-texclass="ORD"><g data-mml-node="mo" data-latex="(" transform="translate(0 -20)"><use data-c="28" xlink:href="#MJX-266-STX-N-28"></use></g><g data-mml-node="msub" data-latex="n_i" transform="translate(357,0)"><g data-mml-node="mi" data-latex="n"><use data-c="1D45B" xlink:href="#MJX-266-STX-I-1D45B"></use></g><g data-mml-node="mi" transform="translate(598,-150) scale(0.707)" data-latex="i"><use data-c="1D456" xlink:href="#MJX-266-STX-I-1D456"></use></g></g><g data-mml-node="mo" data-latex="," transform="translate(1198.7,0)"><use data-c="2C" xlink:href="#MJX-266-STX-N-2C"></use></g><g data-mml-node="msub" data-latex="n_j" transform="translate(1443.7,0)"><g data-mml-node="mi" data-latex="n"><use data-c="1D45B" xlink:href="#MJX-266-STX-I-1D45B"></use></g><g data-mml-node="mi" transform="translate(598,-150) scale(0.707)" data-latex="j"><use data-c="1D457" xlink:href="#MJX-266-STX-I-1D457"></use></g></g><g data-mml-node="mo" data-latex=")" transform="translate(2396.5,0) translate(0 -20)"><use data-c="29" xlink:href="#MJX-266-STX-N-29"></use></g></g></g><g data-mml-node="mo" data-latex="\equiv" transform="translate(7101.8,0)"><use data-c="2261" xlink:href="#MJX-266-STX-N-2261"></use></g><g data-mml-node="mi" data-latex="\neg" transform="translate(8099.6,0)"><use data-c="AC" xlink:href="#MJX-266-STX-N-AC"></use></g><g data-mml-node="msub" data-latex="r_i" transform="translate(8819.6,0)"><g data-mml-node="mi" data-latex="r"><use data-c="1D45F" xlink:href="#MJX-266-STX-I-1D45F"></use></g><g data-mml-node="mi" transform="translate(445,-150) scale(0.707)" data-latex="i"><use data-c="1D456" xlink:href="#MJX-266-STX-I-1D456"></use></g></g><g data-mml-node="mo" data-latex="\wedge" transform="translate(9730.6,0)"><use data-c="2227" xlink:href="#MJX-266-STX-N-2227"></use></g><g data-mml-node="mi" data-latex="\neg" transform="translate(10588.8,0)"><use data-c="AC" xlink:href="#MJX-266-STX-N-AC"></use></g><g data-mml-node="msub" data-latex="r_j" transform="translate(11308.8,0)"><g data-mml-node="mi" data-latex="r"><use data-c="1D45F" xlink:href="#MJX-266-STX-I-1D45F"></use></g><g data-mml-node="mi" transform="translate(445,-150) scale(0.707)" data-latex="j"><use data-c="1D457" xlink:href="#MJX-266-STX-I-1D457"></use></g></g></g></g></svg></mjx-container></div><div style="display: flex; align-items: center;"><mjx-container class="MathJax" jax="SVG" overflow="overflow" display="true"><svg style="vertical-align: -0.769ex;" xmlns="http://www.w3.org/2000/svg" width="52.931ex" height="2.264ex" role="img" focusable="false" viewBox="0 -716 25353.8 1084.6" xmlns:xlink="http://www.w3.org/1999/xlink"><defs><path id="MJX-267-STX-I-1D45A" d="M403 0L435 138C472 228 587 407 649 407C672 407 679 390 679 367C679 346 670 308 663 282L612 88C611 83 607 65 607 49C607 19 622-10 673-10C744-10 784 60 810 97L790 112C774 93 750 60 715 60C702 60 696 68 696 79C696 91 699 103 699 103L754 334C757 348 764 382 764 408C764 444 750 479 700 479C596 479 514 346 471 270L463 270L480 334C481 339 489 379 489 408C489 444 476 479 426 479C312 479 227 338 185 259L177 259L227 476L204 476L66 465L66 438C66 438 85 440 98 440C122 440 130 430 130 413C130 398 127 380 127 380L47 0L129 0L160 137C210 250 309 407 375 407C398 407 405 390 405 367C405 351 400 328 399 325C375 215 349 107 320 0Z"></path><path id="MJX-267-STX-I-1D452" d="M357 122C317 72 262 57 216 57C149 57 112 88 112 189L112 202C228 211 404 262 404 390C404 467 339 479 296 479C139 479 28 319 28 164C28 84 58-12 177-12C243-12 315 17 375 107M114 231C133 330 202 448 276 448C306 448 318 428 318 393C318 298 227 238 114 231Z"></path><path id="MJX-267-STX-I-1D459" d="M256 705L234 705L96 694L96 668C96 668 112 670 130 670C157 670 161 653 161 640C161 624 158 608 158 608L66 144C58 101 52 66 52 44C52 9 75-9 115-9C181-9 220 47 255 96L235 111C219 93 193 59 159 59C147 59 141 65 141 78C141 92 146 120 146 120Z"></path><path id="MJX-267-STX-I-1D45C" d="M460 297C460 416 378 479 293 479C136 479 26 330 26 175C26 77 73-10 189-10C348-10 460 129 460 297M369 307C369 133 299 25 200 25C134 25 117 93 117 166C117 345 199 445 285 445C345 445 369 381 369 307Z"></path><path id="MJX-267-STX-I-1D451" d="M529 705L507 705L371 694L371 668C371 668 390 670 402 670C432 670 437 656 437 639C437 625 434 607 434 607L401 439L398 439C374 464 341 479 296 479C157 479 37 340 37 162C37 45 89-12 163-12C222-12 279 24 329 85L337 85C335 73 332 54 332 42C332 11 353-10 393-10C462-10 499 53 530 97L510 112C496 93 469 60 437 60C424 60 418 65 418 79C418 92 423 121 423 121M346 177C319 101 274 54 206 54C157 54 126 78 126 169C126 299 190 441 291 441C349 441 377 394 377 351C377 333 372 252 346 177Z"></path><path id="MJX-267-STX-I-1D466" d="M251 325C239 405 232 437 210 475L195 475L53 464L53 435C53 435 74 437 88 437C149 437 154 388 161 343L220-9C192-52 112-165 93-165C71-165 60-112 22-112C-1-112-17-125-17-155C-17-192 18-220 60-220C136-220 197-112 289 15C341 87 398 173 452 268C484 322 496 367 496 406C496 449 470 482 433 482C404 482 389 464 389 443C389 405 438 377 438 351C438 327 429 303 405 264L290 79L284 79L275 179Z"></path><path id="MJX-267-STX-N-28" d="M45 270C45 47 150-112 311-196L327-170C181-71 127 66 127 270C127 474 181 611 327 710L311 736C150 652 45 493 45 270Z"></path><path id="MJX-267-STX-I-1D45B" d="M521 112C506 93 481 60 447 60C433 60 428 68 428 79C428 91 430 103 430 103L487 334C490 348 496 382 496 408C496 444 481 479 430 479C312 479 227 334 185 259L177 259L227 476L205 476L66 465L66 438C66 438 86 440 99 440C122 440 131 430 131 413C131 398 128 380 128 380L47 0L129 0L165 158C197 227 307 407 380 407C403 407 410 390 410 367C410 347 403 319 403 319L344 88C343 83 339 65 339 49C339 19 354-10 404-10C476-10 516 60 542 97Z"></path><path id="MJX-267-STX-I-1D456" d="M219 476L197 476L57 465L57 438C57 438 74 440 91 440C118 440 123 424 123 411C123 394 120 380 120 380L69 142C56 83 52 61 52 44C52 9 75-9 115-9C181-9 220 47 255 96L235 111C219 93 191 59 157 59C145 59 139 65 139 78C139 92 144 120 144 120M243 610C243 643 224 665 191 665C158 665 136 644 136 610C136 575 158 556 188 556C218 556 243 576 243 610Z"></path><path id="MJX-267-STX-N-2C" d="M70-132C110-114 194-80 194 33C194 88 167 121 117 121C77 121 55 94 55 62C55 33 71 8 110 8C121 8 130 10 141 14C141-67 95-91 58-107Z"></path><path id="MJX-267-STX-I-1D457" d="M214 49C203-11 167-192 116-192C77-192 105-104 49-104C21-104 9-129 9-150C9-188 35-225 99-225C236-225 287-8 304 88L374 476L352 476L212 465L212 438C212 438 229 440 246 440C273 440 278 424 278 411C278 394 275 380 275 380M400 610C400 642 379 665 346 665C313 665 292 644 292 610C292 575 313 557 346 557C379 557 400 576 400 610Z"></path><path id="MJX-267-STX-N-29" d="M312 270C312 493 207 652 46 736L30 710C176 611 230 474 230 270C230 66 176-71 30-170L46-196C207-112 312 47 312 270Z"></path><path id="MJX-267-STX-N-2261" d="M658 28L658 96L62 96L62 28M658 225L658 293L62 293L62 225M658 422L658 489L62 489L62 422Z"></path><path id="MJX-267-STX-I-1D450" d="M358 123C327 85 288 57 219 57C161 57 109 77 109 184C109 300 170 446 280 446C312 446 329 434 329 419C329 403 310 375 310 349C310 327 324 314 348 314C385 314 404 346 404 386C404 451 353 479 290 479C146 479 26 335 26 169C26 68 71-12 179-12C269-12 334 44 375 108Z"></path><path id="MJX-267-STX-I-1D460" d="M378 479L359 479L333 452L330 452C318 459 281 479 228 479C137 479 92 425 92 357C92 295 139 260 180 221C218 185 254 150 254 96C254 44 222 23 176 23C108 23 82 69 72 156L47 156L21-11L43-11L67 16L70 16C84 10 122-11 185-11C298-11 337 55 337 113C337 177 301 214 258 260C214 307 163 343 163 385C163 414 184 449 236 449C295 449 328 400 331 323L355 323Z"></path><path id="MJX-267-STX-I-1D462" d="M42 355C58 375 82 409 116 409C130 409 137 401 137 389C137 376 133 362 133 362L77 135C73 121 67 88 67 62C67 25 82-10 133-10C250-10 330 127 368 197L377 197C360 132 345 92 345 45C345 1 378-9 405-9C466-9 503 32 547 96L526 111C526 111 489 59 453 59C437 59 432 68 432 76C432 91 438 119 438 119L510 470L427 470L397 332C374 230 257 62 183 62C160 62 153 79 153 103C153 123 160 151 160 151L220 380C221 385 225 402 225 419C225 448 210 477 162 477C91 477 47 408 22 371Z"></path><path id="MJX-267-STX-I-1D461" d="M317 467L216 467L244 593L214 593C164 506 139 482 75 449L71 428L128 428L60 101C58 91 53 61 53 44C53 13 72-9 114-9C193-9 235 65 264 104L244 119C209 74 188 59 159 59C145 59 142 69 142 80C142 97 149 130 149 130L208 428L309 428Z"></path><path id="MJX-267-STX-I-1D463" d="M200 476L53 465L53 437C53 437 83 440 99 440C117 440 123 426 123 409C123 389 116 365 113 354L93 278C82 236 71 183 71 135C71 58 100-9 200-9C380-9 479 206 479 358C479 429 448 479 403 479C382 479 365 464 365 437C365 393 426 369 426 299C426 206 368 55 231 55C170 55 153 99 153 151C153 196 166 249 175 284L222 476Z"></path><path id="MJX-267-STX-N-21D2" d="M826 264C702 358 571 445 451 564L429 543C454 515 480 486 506 460C520 444 529 438 529 418C529 409 520 395 502 395L0 395L0 327L649 327C683 308 710 283 710 259C710 234 683 213 650 190L0 190L0 123L502 123C520 123 529 108 529 100C529 84 522 75 505 57C494 46 454 3 429-26L451-46C571 72 700 159 826 254Z"></path><path id="MJX-267-STX-MI-61" d="M153-12C208-12 259 21 309 85L315 85C313 69 309 52 309 37C309 5 328-10 363-10C425-10 466 38 505 97L485 112C472 95 444 60 412 60C397 60 393 68 393 81C393 96 398 118 398 118L472 472L421 472L386 426L382 426C361 456 333 479 282 479C154 479 31 334 31 156C31 38 85-12 153-12M189 54C147 54 119 80 119 169C119 304 184 441 276 441C330 441 359 394 359 349C359 311 338 220 328 180C310 108 250 54 189 54Z"></path><path id="MJX-267-STX-MI-62" d="M194-12C366-12 463 140 463 304C463 424 403 479 327 479C276 479 234 450 193 402L188 402L252 705L230 705L92 694L92 668C92 668 111 670 122 670C142 670 158 663 158 641C158 629 155 610 154 606L36 25C85 0 136-12 194-12M207 30C167 30 138 54 125 66L174 316C194 363 236 423 297 423C340 423 375 390 375 300C375 148 321 30 207 30Z"></path><path id="MJX-267-STX-MI-73" d="M164-11C277-11 316 55 316 113C316 177 280 214 237 260C193 307 142 343 142 385C142 414 163 449 215 449C274 449 307 400 310 323L334 323L357 479L338 479L312 452L309 452C297 459 260 479 207 479C116 479 71 425 71 357C71 295 118 260 159 221C197 185 233 150 233 96C233 44 201 23 155 23C87 23 61 69 51 156L26 156L0-11L22-11L46 16L49 16C63 10 101-11 164-11Z"></path><path id="MJX-267-STX-I-1D45D" d="M275-220L282-193C202-193 181-166 181-143C181-129 183-111 185-101L209 15C229 3 268-11 300-11C456-11 572 119 572 307C572 423 510 479 432 479C380 479 338 451 290 397L285 397L299 474L280 474L137 459L137 434C137 434 154 436 169 436C195 436 206 427 206 407C206 400 205 394 204 388L77-220M272 311C300 370 340 423 404 423C434 423 484 402 484 307C484 131 415 32 308 32C266 32 238 49 221 64Z"></path><path id="MJX-267-STX-N-2212" d="M658 225L658 293L62 293L62 225Z"></path><path id="MJX-267-STX-N-2B" d="M658 225L658 293L396 293L396 558L324 558L324 293L62 293L62 225L324 225L324-40L396-40L396 225Z"></path><path id="MJX-267-STX-N-31" d="M426 0L426 28C334 28 297 46 297 95L297 639L268 639L74 584L74 551C105 561 156 567 176 567C201 567 209 553 209 518L209 95C209 45 174 28 80 28L80 0Z"></path><path id="MJX-267-STX-N-2208" d="M646 293L155 293C165 390 223 476 352 476L646 476L646 543L347 543C183 543 75 411 75 260C75 108 181-26 344-26L646-26L646 42L353 42C224 42 166 128 155 225L646 225Z"></path><path id="MJX-267-STX-MI-69" d="M115-9C181-9 220 47 255 96L235 111C219 93 191 59 157 59C145 59 139 65 139 78C139 92 144 120 144 120L219 476L197 476L57 465L57 438C57 438 74 440 91 440C118 440 123 424 123 411C123 394 120 380 120 380L69 142C56 83 52 61 52 44C52 9 75-9 115-9M188 556C218 556 243 576 243 610C243 643 224 665 191 665C158 665 136 644 136 610C136 575 158 556 188 556Z"></path><path id="MJX-267-STX-MI-6E" d="M400-10C471-10 511 60 537 97L516 112C501 93 477 60 442 60C429 60 423 68 423 79C423 91 426 103 426 103L482 334C485 348 491 375 491 408C491 444 476 479 427 479C312 479 228 334 187 259L179 259L229 476L207 476L68 465L68 438C68 438 88 440 101 440C124 440 134 430 134 413C134 398 130 380 130 380L49 0L131 0L167 158C199 227 306 407 377 407C399 407 406 390 406 367C406 347 399 319 399 319L340 88C338 83 334 65 334 49C334 19 350-10 400-10Z"></path><path id="MJX-267-STX-MI-74" d="M115-9C194-9 236 65 265 104L245 119C210 74 189 59 160 59C146 59 143 69 143 80C143 97 150 130 150 130L211 428L310 428L318 467L219 467L245 593L215 593C165 506 140 482 76 449L72 428L129 428L61 101C59 91 54 61 54 44C54 13 73-9 115-9Z"></path><path id="MJX-267-STX-MI-65" d="M179-12C243-12 312 17 372 107L354 122C315 74 269 57 219 57C152 57 116 88 116 189C116 193 116 198 116 202C233 211 401 264 401 389C401 467 337 479 294 479C132 479 32 307 32 163C32 75 69-12 179-12M120 232C135 327 198 448 273 448C303 448 315 429 315 393C315 298 231 239 120 232Z"></path><path id="MJX-267-STX-MI-72" d="M134 0L165 143C204 238 277 395 318 395C321 395 331 358 363 358C389 358 416 377 416 421C416 460 392 479 361 479C280 479 219 326 188 259L178 259L229 476L207 476L68 465L68 438C68 438 88 440 99 440C127 440 132 429 132 410C132 392 127 366 123 348L49 0Z"></path><path id="MJX-267-STX-MI-76" d="M160-8C295 76 417 218 417 385C417 424 403 479 353 479C329 479 308 465 308 435C308 388 358 385 358 324C358 232 279 126 185 50L183 50L185 85C181 210 171 349 156 477L132 477L1 461L1 430C14 432 23 433 33 433C66 433 74 421 79 374C96 244 105 143 111-8Z"></path><path id="MJX-267-STX-MI-6C" d="M109-9C175-9 214 47 249 96L229 111C213 93 187 59 153 59C141 59 134 65 134 78C134 85 136 104 139 120L255 705L233 705L95 694L95 668C95 668 111 670 129 670C156 670 160 653 160 640C160 624 157 608 157 608L60 144C55 118 46 70 46 44C46 9 69-9 109-9Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math" data-latex="melody_{(n_i,n_j)} \equiv consecutive_{(n_i,n_j)} \implies \mathit{abs}(p_i - p_{i+1}) \in \mathit{intervals}
"><g data-mml-node="mi" data-latex="m"><use data-c="1D45A" xlink:href="#MJX-267-STX-I-1D45A"></use></g><g data-mml-node="mi" data-latex="e" transform="translate(830,0)"><use data-c="1D452" xlink:href="#MJX-267-STX-I-1D452"></use></g><g data-mml-node="mi" data-latex="l" transform="translate(1254,0)"><use data-c="1D459" xlink:href="#MJX-267-STX-I-1D459"></use></g><g data-mml-node="mi" data-latex="o" transform="translate(1532,0)"><use data-c="1D45C" xlink:href="#MJX-267-STX-I-1D45C"></use></g><g data-mml-node="mi" data-latex="d" transform="translate(2018,0)"><use data-c="1D451" xlink:href="#MJX-267-STX-I-1D451"></use></g><g data-mml-node="msub" data-latex="y_{(n_i,n_j)}" transform="translate(2574,0)"><g data-mml-node="mi" data-latex="y"><use data-c="1D466" xlink:href="#MJX-267-STX-I-1D466"></use></g><g data-mml-node="TeXAtom" transform="translate(543,-150) scale(0.707)" data-latex="{(n_i,n_j)}" data-mjx-texclass="ORD"><g data-mml-node="mo" data-latex="(" transform="translate(0 -20)"><use data-c="28" xlink:href="#MJX-267-STX-N-28"></use></g><g data-mml-node="msub" data-latex="n_i" transform="translate(357,0)"><g data-mml-node="mi" data-latex="n"><use data-c="1D45B" xlink:href="#MJX-267-STX-I-1D45B"></use></g><g data-mml-node="mi" transform="translate(598,-150) scale(0.707)" data-latex="i"><use data-c="1D456" xlink:href="#MJX-267-STX-I-1D456"></use></g></g><g data-mml-node="mo" data-latex="," transform="translate(1198.7,0)"><use data-c="2C" xlink:href="#MJX-267-STX-N-2C"></use></g><g data-mml-node="msub" data-latex="n_j" transform="translate(1443.7,0)"><g data-mml-node="mi" data-latex="n"><use data-c="1D45B" xlink:href="#MJX-267-STX-I-1D45B"></use></g><g data-mml-node="mi" transform="translate(598,-150) scale(0.707)" data-latex="j"><use data-c="1D457" xlink:href="#MJX-267-STX-I-1D457"></use></g></g><g data-mml-node="mo" data-latex=")" transform="translate(2396.5,0) translate(0 -20)"><use data-c="29" xlink:href="#MJX-267-STX-N-29"></use></g></g></g><g data-mml-node="mo" data-latex="\equiv" transform="translate(5391.8,0)"><use data-c="2261" xlink:href="#MJX-267-STX-N-2261"></use></g><g data-mml-node="mi" data-latex="c" transform="translate(6389.6,0)"><use data-c="1D450" xlink:href="#MJX-267-STX-I-1D450"></use></g><g data-mml-node="mi" data-latex="o" transform="translate(6803.6,0)"><use data-c="1D45C" xlink:href="#MJX-267-STX-I-1D45C"></use></g><g data-mml-node="mi" data-latex="n" transform="translate(7289.6,0)"><use data-c="1D45B" xlink:href="#MJX-267-STX-I-1D45B"></use></g><g data-mml-node="mi" data-latex="s" transform="translate(7854.6,0)"><use data-c="1D460" xlink:href="#MJX-267-STX-I-1D460"></use></g><g data-mml-node="mi" data-latex="e" transform="translate(8240.6,0)"><use data-c="1D452" xlink:href="#MJX-267-STX-I-1D452"></use></g><g data-mml-node="mi" data-latex="c" transform="translate(8664.6,0)"><use data-c="1D450" xlink:href="#MJX-267-STX-I-1D450"></use></g><g data-mml-node="mi" data-latex="u" transform="translate(9078.6,0)"><use data-c="1D462" xlink:href="#MJX-267-STX-I-1D462"></use></g><g data-mml-node="mi" data-latex="t" transform="translate(9643.6,0)"><use data-c="1D461" xlink:href="#MJX-267-STX-I-1D461"></use></g><g data-mml-node="mi" data-latex="i" transform="translate(9981.6,0)"><use data-c="1D456" xlink:href="#MJX-267-STX-I-1D456"></use></g><g data-mml-node="mi" data-latex="v" transform="translate(10255.6,0)"><use data-c="1D463" xlink:href="#MJX-267-STX-I-1D463"></use></g><g data-mml-node="msub" data-latex="e_{(n_i,n_j)}" transform="translate(10759.6,0)"><g data-mml-node="mi" data-latex="e"><use data-c="1D452" xlink:href="#MJX-267-STX-I-1D452"></use></g><g data-mml-node="TeXAtom" transform="translate(457,-150) scale(0.707)" data-latex="{(n_i,n_j)}" data-mjx-texclass="ORD"><g data-mml-node="mo" data-latex="(" transform="translate(0 -20)"><use data-c="28" xlink:href="#MJX-267-STX-N-28"></use></g><g data-mml-node="msub" data-latex="n_i" transform="translate(357,0)"><g data-mml-node="mi" data-latex="n"><use data-c="1D45B" xlink:href="#MJX-267-STX-I-1D45B"></use></g><g data-mml-node="mi" transform="translate(598,-150) scale(0.707)" data-latex="i"><use data-c="1D456" xlink:href="#MJX-267-STX-I-1D456"></use></g></g><g data-mml-node="mo" data-latex="," transform="translate(1198.7,0)"><use data-c="2C" xlink:href="#MJX-267-STX-N-2C"></use></g><g data-mml-node="msub" data-latex="n_j" transform="translate(1443.7,0)"><g data-mml-node="mi" data-latex="n"><use data-c="1D45B" xlink:href="#MJX-267-STX-I-1D45B"></use></g><g data-mml-node="mi" transform="translate(598,-150) scale(0.707)" data-latex="j"><use data-c="1D457" xlink:href="#MJX-267-STX-I-1D457"></use></g></g><g data-mml-node="mo" data-latex=")" transform="translate(2396.5,0) translate(0 -20)"><use data-c="29" xlink:href="#MJX-267-STX-N-29"></use></g></g></g><g data-mml-node="mo" data-latex="\Rightarrow" transform="translate(13491.4,0)"><use data-c="21D2" xlink:href="#MJX-267-STX-N-21D2"></use></g><g data-mml-node="TeXAtom" data-latex="\mathit{abs}" data-mjx-texclass="ORD" transform="translate(14656.2,0)"><g data-mml-node="mi" data-latex="abs"><use data-c="61" xlink:href="#MJX-267-STX-MI-61"></use><use data-c="62" xlink:href="#MJX-267-STX-MI-62" transform="translate(534,0)"></use><use data-c="73" xlink:href="#MJX-267-STX-MI-73" transform="translate(1029,0)"></use></g></g><g data-mml-node="mo" data-latex="(" transform="translate(16052.2,0) translate(0 -20)"><use data-c="28" xlink:href="#MJX-267-STX-N-28"></use></g><g data-mml-node="msub" data-latex="p_i" transform="translate(16409.2,0)"><g data-mml-node="mi" data-latex="p"><use data-c="1D45D" xlink:href="#MJX-267-STX-I-1D45D"></use></g><g data-mml-node="mi" transform="translate(631,-150) scale(0.707)" data-latex="i"><use data-c="1D456" xlink:href="#MJX-267-STX-I-1D456"></use></g></g><g data-mml-node="mo" data-latex="-" transform="translate(17506.1,0)"><use data-c="2212" xlink:href="#MJX-267-STX-N-2212"></use></g><g data-mml-node="msub" data-latex="p_{i+1}" transform="translate(18448.4,0)"><g data-mml-node="mi" data-latex="p"><use data-c="1D45D" xlink:href="#MJX-267-STX-I-1D45D"></use></g><g data-mml-node="TeXAtom" transform="translate(631,-150) scale(0.707)" data-latex="{i+1}" data-mjx-texclass="ORD"><g data-mml-node="mi" data-latex="i"><use data-c="1D456" xlink:href="#MJX-267-STX-I-1D456"></use></g><g data-mml-node="mo" data-latex="+" transform="translate(274,0)"><use data-c="2B" xlink:href="#MJX-267-STX-N-2B"></use></g><g data-mml-node="mn" data-latex="1" transform="translate(994,0)"><use data-c="31" xlink:href="#MJX-267-STX-N-31"></use></g></g></g><g data-mml-node="mo" data-latex=")" transform="translate(20182.2,0) translate(0 -20)"><use data-c="29" xlink:href="#MJX-267-STX-N-29"></use></g><g data-mml-node="mo" data-latex="\in" transform="translate(20817,0)"><use data-c="2208" xlink:href="#MJX-267-STX-N-2208"></use></g><g data-mml-node="TeXAtom" data-latex="\mathit{intervals}" data-mjx-texclass="ORD" transform="translate(21814.8,0)"><g data-mml-node="mi" data-latex="intervals"><use data-c="69" xlink:href="#MJX-267-STX-MI-69"></use><use data-c="6E" xlink:href="#MJX-267-STX-MI-6E" transform="translate(279,0)"></use><use data-c="74" xlink:href="#MJX-267-STX-MI-74" transform="translate(843,0)"></use><use data-c="65" xlink:href="#MJX-267-STX-MI-65" transform="translate(1141,0)"></use><use data-c="72" xlink:href="#MJX-267-STX-MI-72" transform="translate(1553,0)"></use><use data-c="76" xlink:href="#MJX-267-STX-MI-76" transform="translate(1936,0)"></use><use data-c="61" xlink:href="#MJX-267-STX-MI-61" transform="translate(2365,0)"></use><use data-c="6C" xlink:href="#MJX-267-STX-MI-6C" transform="translate(2899,0)"></use><use data-c="73" xlink:href="#MJX-267-STX-MI-73" transform="translate(3172,0)"></use></g></g></g></g></svg></mjx-container></div><p>To enforce harmony constraints, we need a list of allowed pitches given a chord; a <em>relation</em> or <em>table constraint</em> in constraint programming terms.
In typical SMT fashion, we unroll everything into a big disjunction instead.</p>
<h1 id="false-starts">False starts</h1>
<p>I tried several other approaches before settling on SMT.
My initial naive encodings with Z3 had disappointing performance.
I then tried extending <a href="http://facile.recherche.enac.fr/">FaCiLe</a> with table constraints, but implementing propagators correctly is notoriously difficult and I experienced that firsthand.
Then I tried or-tools, which worked well until I encountered a <a href="https://github.com/google/or-tools/discussions/3373">limitation</a> with reified constraints.
At this point I went back to Z3 and committed to finding an efficient encoding.</p>
<p>The takeaway: start with SMT. There probably is an efficient SMT encoding. If there isn’t (and you have confirmed this!), you will likely have to look into a custom theory solver for your domain.</p>
<p>A few examples of subpar encodings:</p>
<ul>
<li>Use of modulo to handle octaves - unrolling is faster</li>
<li>Use of a tuple of a pitch class and octave to model notes - bounded integers are faster</li>
<li>Use of enumerations to model pitch - bounded integers are more flexible</li>
<li>Unnecessary uses of if-then-else - just use disjunction</li>
</ul>
<!-- - Unnecessary uses of abs - just use disjunction! -->
<p>Even with SMT, straying from the golden path and using newer SMTLIB features tends to lead to frustration, e.g. bugs and lacking support in solver APIs.</p>
<h1 id="rust-will-find-a-way">Rust will find a way</h1>
<!-- # Implementation -->
<p>My original Python implementation got unreasonably slow past a certain point.</p>
<pre><code>$ ./run.sh examples/ode.py
music4.so not built, using Python implementation
Constraint (melody)             0.01s
Constraint (basics)             0.03s
Constraint (rhythm)             0.00s
Constraint (same ending rhythm) 0.00s
Constraint (no breathing)       0.00s
Constraint (no breathing)       0.00s
Constraint (no breathing)       0.00s
Constraint (simultaneity)       1.51s
Constraint (consonance)         23.50s
Constraint (melody intervals)   0.10s
Constraint (note durations)     0.04s
Constraint (chord durations)    0.02s
Solving                         59.69s
sat
Ode to Joy.musicxml
Ode to Joy.abc
</code></pre>
<p>It turns out that Z3’s Python API <a href="https://stackoverflow.com/a/26385910">has significant overhead</a>.
I found other examples where just adding the constraints took 5s, but solving them was instant, evidenced by running Z3 on the generated SMTLIB file.</p>
<p>The usual move from here is to rewrite in Rust, so that’s what I did. This significantly improved solving time…</p>
<pre><code>$ ./run.sh examples/ode.py
Using music4.so
Constraints     446.5ms
Solving         15.1s
Sat
Ode to Joy.musicxml
Ode to Joy.abc
</code></pre>
<p>… at the cost of having to maintain a second, slightly-different implementation. I would have liked to retire the Python version, but there are reasons to keep it:</p>
<ul>
<li>It’s significantly more accessible (i.e. why the Z3 Python API is so popular). Having to install a Rust toolchain and wait for Z3 to compile is not great for just trying out someone’s code.</li>
<li>It serves as a reference implementation for the much more verbose Rust version.</li>
</ul>
<p>Maybe it could be used for differential testing someday…</p>
<!--
For all of Rust's virtues, APIs in it aren't pretty. Rust is great for writing fast production code, but the compile time and annotation overhead may not be worth it for a small research project.

Rust does however have very nice Python interoperability with PyO3. At least if all you need is a Python interface to a compute-heavy Rust function which returns a big struct.
-->
<h1 id="examples">Examples</h1>
<p>Now for some examples of generated pieces.
The constraints used for these may be found <a href="https://github.com/dariusf/allez">here</a>.
Feel free to tweak them and generate of your own pieces.</p>
<h2 id="tabula-rasa">Tabula rasa</h2>
<p>In the absence of other constraints, all we have here is that intervals in consecutive notes have pleasing, familiar intervals.</p>
<h2 id="countermelody">Countermelody</h2>
<h2 id="harmonization">Harmonization</h2>
<span id="ode">
X: 1
T: Ode to Joy
L: 1/16
K: C
M: 4/4
Q: 1/4=110
V: sop name="S"
V: alto name="A"
V: tenor name="T" clef=treble-8
V: bass name="B" clef=bass middle=d transpose=-24
%
V: sop
E4 E4 F4 G4 G4 F4 E4 D4 C4 C4 D4 E4 E6 D2 D8 E4 E4 F4 G4 G4 F4 E4 D4 C4 C4 D4 E4 D6 C2 C8
V: alto
B8 A4 G8 D4 A,8 A,8 G,6 B,6 E2 B2 B2 A2 G2 A8 E2 F2 F2 G4 G2 G2 A8 D2 D2 C6 E2 B4 E4 A6 E2 C8
V: tenor
G8 d2 d2 g8 d4 A4 D2 A2 E2 A6 d2 G2 C2 G8 d4 a2 b2 a2 a8 d4 G8 A2 F2 C4 G4 c8 B8 A6 e2 e8
V: bass
"iii" G8 "ii" d8 "V" d8 "ii" A8 "vi" A8 "ii" B4 "vi" c2 "V" g8 "I" d4 "iii" a2 "V" d'4 "ii" c'8 "V" f4 "ii" g4 "vi" d4 "vi" A4 "ii" A2 "V" A2 "iii" d4 "V" c6 "ii" c2 "vi" G2 "V" d2 "vi" g2 "V" g2 "iii" d'2 "iii" d'2 "ii" d'2 "vi" c'2 "I" c'8
</span>
<script>renderMusicIn('ode')</script>
<h1 id="related-work">Related work</h1>
<!-- I've not done much related work beyond the immediate questions I needed to get answered. This is my hobby project. Cannot delve into it with the same level of commitment. -->
<p>The most closely related works are the constraint programming libraries <a href="https://github.com/tanders/strasheela">Strasheela (Oz)</a> (which I took a lot of inspiration from) and <a href="https://github.com/tanders/cluster-engine">cluster-engine (Common Lisp)</a>. Others are <a href="https://github.com/slemouton/gecodeMCP">gecodeMCP (C++)</a> and <a href="https://github.com/openmusic-project/Clouds">OMClouds (Common Lisp)</a>.</p>
<p>I have not yet tried most of them, but given their maturity I’m assuming they can handle all these benchmarks.
One salient difference is the language the user must write constraints in (annotated above).</p>
<p>Another is that the use of SMT allows <em>arbitrary</em> constraints in standard theories (e.g. LIA) to be expressed.
With constraint solvers, the set of usable constraints is typically <a href="https://sofdem.github.io/gccat/">large but limited</a> (no arbitrary disjunction!) and non-uniform across solvers, but solvable with more efficient specialized algorithms.
They may be more appropriate if the set of constraints required is well-understood (not the case yet, in this work).</p>
<p>Many of these libraries have been integrated into composition IDEs, such as
<a href="https://opusmodus.com/">Opusmodus</a>, <a href="https://openmusic-project.github.io/">OpenMusic</a>, and <a href="https://en.wikiversity.org/wiki/Music/Software/PWGL">PWGL (seemingly defunct, links no longer work)</a>. <a href="https://github.com/blapiere/Rhythm-Box">Rhythm-Box</a> and <a href="https://www.info.ucl.ac.be/~pvr/SPROCKEELS_68641400_2022.pdf">Melodizer</a> (mentioned earlier) are components of OpenMusic.</p>
<p>Other systems this work was inspired by are <a href="https://arxiv.org/abs/1006.4948">ANTON</a>, which uses ASP for harmonization, <a href="https://github.com/halfaya/MusicTools/blob/master/doc/farm22/abstract.pdf">MusicTools</a>, an Agda library which also discharges musical synthesis via SMT, and <a href="https://drive.google.com/file/d/18xE9Jmh2gq-KrIGmbKObxiFSWuoFqsi1/view">Type-Guided Music Composition</a>, an approach which uses weighted refinement types to validate and synthesize music.</p>
<h1 id="conclusion">Conclusion</h1>
<p>This is very much early work.
Nevertheless, I’m publishing it to document my progress, get feedback, and allow others to play with the code.
I’ve spent way too long working on this in isolation.</p>
<p>Here are a few ideas for how this work could be brought forward.</p>
<p>The prototype is currently limited to a single key (C maj) and 6 diatonic chords.
Lifting these restrictions or improving the background theory (e.g. richer melody constraints, rhythmic constraints, more contrapunctal rules) would be great.
The potential of SMT solvers (optimization, soft constraints, unsat cores, alternative solvers) could be further exploited.
The system could be applied to more interesting musical puzzles, e.g. fugues, which would likely require new kinds of global constraints.</p>
<p>While it would be nice to integrate this into a composition IDE or build a new one for casual creators, I have no immediate plans to do so.
There are many <a href="http://erichorvitz.com/chi99horvitz.pdf">UX problems</a> to be solved for a good UI design.
In particular, the UI should be cognizant of the limitations and potential of the use of SMT, and should provide the right affordances for creating music without requiring users to dive into the underlying theory.
The NP-hardness of SMT suggests that the UI should provide a means to localize solving.</p>
<p>The stability of produced outputs is another consideration: it is possible that the unconstrained parts of the piece could be entirely different between two solver calls. This would be a problem if users are working with the system in true mixed-initiative fashion, using its feedback to refine a synthesized piece.
<a href="https://github.com/srcclr/sapling">My previous work</a> suffers from the same problem and utilized manual pinning of parts of the solution to mitigate this, but I’m sure there is a better way.</p>
<p>Code <a href="https://github.com/dariusf/allez">here</a>.</p>

</div>

		</main>

		<footer>
			
		</footer>

		<!-- This page `/drafts/satisfying-music-theory/` was built on 2025-12-06T09:27:00.079Z -->
		
	</body>
</html>
