<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, shrink-to-fit=no">

		<meta property="og:title" content="Darius Foo">
		<meta property="og:type" content="article">
		<meta property="og:url" content="https://dariusf.github.io">
		<meta property="og:image" content="https://dariusf.github.io/avatar.png">

		<title>Visualizing Z3&#39;s proofs</title>
		<meta name="description" content="PhD student, programming languages and formal verification">
		<link rel="alternate" href="/feed/feed.xml" type="application/atom+xml" title="Darius Foo">


		

		

		

		

		
		
		<style>@media (prefers-color-scheme: light) { /**
 * prism.js default theme for JavaScript, CSS and HTML
 * Based on dabblet (http://dabblet.com)
 * @author Lea Verou
 */

code[class*="language-"],
pre[class*="language-"] {
	color: black;
	background: none;
	text-shadow: 0 1px white;
	font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
	font-size: 1em;
	text-align: left;
	white-space: pre;
	word-spacing: normal;
	word-break: normal;
	word-wrap: normal;
	line-height: 1.5;

	-moz-tab-size: 4;
	-o-tab-size: 4;
	tab-size: 4;

	-webkit-hyphens: none;
	-moz-hyphens: none;
	-ms-hyphens: none;
	hyphens: none;
}

pre[class*="language-"]::-moz-selection, pre[class*="language-"] ::-moz-selection,
code[class*="language-"]::-moz-selection, code[class*="language-"] ::-moz-selection {
	text-shadow: none;
	background: #b3d4fc;
}

pre[class*="language-"]::selection, pre[class*="language-"] ::selection,
code[class*="language-"]::selection, code[class*="language-"] ::selection {
	text-shadow: none;
	background: #b3d4fc;
}

@media print {
	code[class*="language-"],
	pre[class*="language-"] {
		text-shadow: none;
	}
}

/* Code blocks */
pre[class*="language-"] {
	padding: 1em;
	margin: .5em 0;
	overflow: auto;
}

:not(pre) > code[class*="language-"],
pre[class*="language-"] {
	background: #f5f2f0;
}

/* Inline code */
:not(pre) > code[class*="language-"] {
	padding: .1em;
	border-radius: .3em;
	white-space: normal;
}

.token.comment,
.token.prolog,
.token.doctype,
.token.cdata {
	color: slategray;
}

.token.punctuation {
	color: #999;
}

.token.namespace {
	opacity: .7;
}

.token.property,
.token.tag,
.token.boolean,
.token.number,
.token.constant,
.token.symbol,
.token.deleted {
	color: #905;
}

.token.selector,
.token.attr-name,
.token.string,
.token.char,
.token.builtin,
.token.inserted {
	color: #690;
}

.token.operator,
.token.entity,
.token.url,
.language-css .token.string,
.style .token.string {
	color: #9a6e3a;
	/* This background color was intended by the author of this theme. */
	background: hsla(0, 0%, 100%, .5);
}

.token.atrule,
.token.attr-value,
.token.keyword {
	color: #07a;
}

.token.function,
.token.class-name {
	color: #DD4A68;
}

.token.regex,
.token.important,
.token.variable {
	color: #e90;
}

.token.important,
.token.bold {
	font-weight: bold;
}
.token.italic {
	font-style: italic;
}

.token.entity {
	cursor: help;
}
 }
@media (prefers-color-scheme: dark) { /**
 * prism.js tomorrow night eighties for JavaScript, CoffeeScript, CSS and HTML
 * Based on https://github.com/chriskempson/tomorrow-theme
 * @author Rose Pritchard
 */

code[class*="language-"],
pre[class*="language-"] {
	color: #ccc;
	background: none;
	font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
	font-size: 1em;
	text-align: left;
	white-space: pre;
	word-spacing: normal;
	word-break: normal;
	word-wrap: normal;
	line-height: 1.5;

	-moz-tab-size: 4;
	-o-tab-size: 4;
	tab-size: 4;

	-webkit-hyphens: none;
	-moz-hyphens: none;
	-ms-hyphens: none;
	hyphens: none;

}

/* Code blocks */
pre[class*="language-"] {
	padding: 1em;
	margin: .5em 0;
	overflow: auto;
}

:not(pre) > code[class*="language-"],
pre[class*="language-"] {
	background: #2d2d2d;
}

/* Inline code */
:not(pre) > code[class*="language-"] {
	padding: .1em;
	border-radius: .3em;
	white-space: normal;
}

.token.comment,
.token.block-comment,
.token.prolog,
.token.doctype,
.token.cdata {
	color: #999;
}

.token.punctuation {
	color: #ccc;
}

.token.tag,
.token.attr-name,
.token.namespace,
.token.deleted {
	color: #e2777a;
}

.token.function-name {
	color: #6196cc;
}

.token.boolean,
.token.number,
.token.function {
	color: #f08d49;
}

.token.property,
.token.class-name,
.token.constant,
.token.symbol {
	color: #f8c555;
}

.token.selector,
.token.important,
.token.atrule,
.token.keyword,
.token.builtin {
	color: #cc99cd;
}

.token.string,
.token.char,
.token.attr-value,
.token.regex,
.token.variable {
	color: #7ec699;
}

.token.operator,
.token.entity,
.token.url {
	color: #67cdcc;
}

.token.important,
.token.bold {
	font-weight: bold;
}
.token.italic {
	font-style: italic;
}

.token.entity {
	cursor: help;
}

.token.inserted {
	color: green;
}
 }
/* This is an arbitrary CSS string added to the bundle */
:root {
	/* --font-family: -apple-system, system-ui, sans-serif; */
	/* --font-family-monospace: Consolas, Menlo, Monaco, Andale Mono WT, Andale Mono, Lucida Console, Lucida Sans Typewriter, DejaVu Sans Mono, Bitstream Vera Sans Mono, Liberation Mono, Nimbus Mono L, Courier New, Courier, monospace;
	*/

    --font-family-monospace: Fira Code, Menlo, Consolas, Monaco, Liberation Mono, Lucida Console, monospace;


  /*    --text-font: Crimson Text, serif;*/
  /*    --text-font: Poppins, Verdana, sans-serif;*/
  /*    --heading-font: Quicksand, sans-serif;*/
  /*    --text-font: Open Sans, sans-serif;*/
  /*    --text-font-size: 16px;*/
  /*    --heading-font: Open Sans, sans-serif;*/
  /*    --text-font: Cabin, sans-serif;*/
  /*    --text-font-size: 16px;*/
  /*    --text-font: Roboto, sans-serif;*/

  /*    --heading-font: Roboto, sans-serif;*/
  /*    --heading-font: Cabin, sans-serif;*/
  /*    --heading-font: Dosis, sans-serif;*/

  /*    --heading-font: Work Sans, sans-serif;*/
  /*    --text-font: Open Sans, sans-serif;*/

      /* --heading-font: Nunito, sans-serif; */
      --heading-font: ui-rounded, 'Hiragino Maru Gothic ProN', Quicksand, Comfortaa, Manjari, 'Arial Rounded MT', 'Arial Rounded MT Bold', Calibri, source-sans-pro, sans-serif;
  /*    --text-font: PT Sans, sans-serif;*/

  /*    --heading-font: Varela Round, sans-serif;*/
  /*    --text-font: Noto Serif, serif;*/

  /*    --text-font: Lato, sans-serif;*/
      --text-font-size: 17px;

  /*    --text-font: Merriweather, sans-serif;*/
  /*    --text-font-size: 16px;*/

  /* https://css-tricks.com/snippets/css/system-font-stack/ */
  /* https://systemfontstack.com/ */

    /* system font on all platforms */
  /*    --heading-font: -apple-system, system-ui, BlinkMacSystemFont, "Segoe UI", Roboto, Ubuntu;*/
      /* --text-font: -apple-system, system-ui, BlinkMacSystemFont, "Segoe UI", Roboto, Ubuntu; */
      --text-font: -apple-system, system-ui, sans-serif;
			/* system-ui, sans-serif; */


/* Theme colors */

	/* --color-gray-20: #e0e0e0;
	--color-gray-50: #C0C0C0;
	--color-gray-90: #333; */

	--background-color: #fff;

	/* --text-color: var(--color-gray-90); */
	/* --text-color-link: #082840; */

	/* --text-color-link: #ff0000; */
	/* --text-color-link-active: #5f2b48; */
	/* --text-color-link-visited: #17050F; */


	/* --syntax-tab-size: 2; */

	--bright-text-color: #222;
	--link-color: #3273dc;
	/* --link-color: #ff5e6c; */
	--link-visited-color: #6e4bbe;
	--background-color: #fff;
	--text-color: #444;
	--faded-text-color: #777;
	--blockquote-text-color: var(--bright-text-color);
	--faint-color: #ccc;
}

@media (prefers-color-scheme: dark) {
	:root {
		/* --color-gray-20: #e0e0e0; */
		/* --color-gray-50: #C0C0C0; */
		/* --color-gray-90: #dad8d8; */

		/* --text-color is assigned to --color-gray-_ above */
		/* --text-color-link: #1493fb; */
		/* --text-color-link-active: #6969f7; */
		/* --text-color-link-visited: #a6a6f8; */

		--background-color: #15202b;

		--bright-text-color: #eee;
		--link-color: #8cc2dd;
		--link-visited-color: #b9a9e0;
		--background-color: #333;
		--text-color: #ddd;
		--faded-text-color: #aaa;
		--slightly-dimmer-text-color: #ccc;
		--blockquote-text-color: var(--slightly-dimmer-text-color);
		--faint-color: #666;

		color-scheme: dark; /* sets scrollbar colour */
	}

	.theme-affected {
		filter: invert(.8);
	}
}

body {
	box-sizing: border-box;

	/* https://github.com/sindresorhus/github-markdown-css */
	min-width: 200px;
	/* max from old blog */
	/* max-width: 40em; */
	/* tiny bit wider because prism adds some padding */
	max-width: 726px;

	margin: 0 auto;
	padding: 0 20px;

	/* enable ligatures */
	text-rendering: optimizeLegibility;

	font-family: var(--text-font);
	font-size: var(--text-font-size);
	color: var(--text-color);
	background-color: var(--background-color);

	/*
	text-align: left;
	word-wrap: break-word;
	overflow-wrap: break-word;
	*/
	/* line-height: 1.5; */
}

@media (max-width: 767px) {
	body {
		padding: 0px 1em;
	}
}

@view-transition {
	navigation: auto;
}

html {
	overflow-y: scroll;
}

/* https://github.com/Kimeiga/bahunya/blob/master/src/parts/_typography.css */
ul, ol {
  padding-left: 2em;
}

li {
	line-height: 1.5;
}

h1, h2, h3, h4, h5, h6 {
	font-family: var(--heading-font);
	color: var(--bright-text-color);
	font-weight: normal;
	line-height: 1.25;
}

footer {
	padding: 35px;
}

/* header {
	border-bottom: 1px dashed var(--color-gray-20);
} */


/* misc changes from here on */

/* https://www.a11yproject.com/posts/how-to-hide-content/ */
.visually-hidden {
	clip: rect(0 0 0 0);
	clip-path: inset(50%);
	height: 1px;
	overflow: hidden;
	position: absolute;
	white-space: nowrap;
	width: 1px;
}

p:has(img) {
	text-align: center;
}
/* Fluid images via https://www.zachleat.com/web/fluid-images/ */
img{
  max-width: 100%;
}
img[width][height] {
  height: auto;
}
/* img[src$=".svg"] {
  width: 100%;
  height: auto;
  max-width: none;
} */
video,
iframe {
	width: 100%;
	height: auto;
}
iframe {
	aspect-ratio: 16/9;
}

p:last-child {
	margin-bottom: 0;
}
p {
	line-height: 1.5;
}

a[href] {
	color: var(--link-color);
	text-decoration: none;
}

/* a[href]:visited {
	color: var(--link-visited-color);
} */

/* a[href]:hover,
a[href]:active { */
	/* color: var(--text-color-link-active); */
	/* text-decoration: underline; */
	/* text-decoration-thickness: 2px; */
/* } */

/* main :first-child {
	margin-top: 0;
} */

/* .links-nextprev {
	display: flex;
	justify-content: space-between;
	gap: .5em 1em;
	list-style: "";
	border-top: 1px dashed var(--color-gray-20);
	padding: 1em 0;
}
.links-nextprev > * {
	flex-grow: 1;
}
.links-nextprev-next {
	text-align: right;
} */

table {
	margin: 1em 0;
	border-collapse: collapse;
}
table td,
table th {
	padding-right: 1em;
}
/* table thead tr th {
  border-bottom: solid var(--text-color) 2px;
  border-top: solid var(--text-color) 2px;
} */

.table-lines td {
  border-bottom: solid var(--text-color) 1px;
  border-top: solid var(--text-color) 1px;
}

/* pre,
code {
	font-family: var(--font-family-monospace) !important;
	font-size: 14px !important;
} */

/* override prism */
/* https://github.com/orgs/PrismJS/discussions/2859 */
code[class*="language-"],
pre[class*="language-"] {
	font-family: var(--font-family-monospace);
	font-size: 14px;
}

pre[class*="language-"] {
	margin-top: 0;
	margin-bottom: 1em;
}

pre:not([class*="language-"]) {
	margin: .5em 0;
	line-height: 1.375; /* 22px /16 */
	/* -moz-tab-size: var(--syntax-tab-size); */
	/* -o-tab-size: var(--syntax-tab-size); */
	/* tab-size: var(--syntax-tab-size); */
	-webkit-hyphens: none;
	-ms-hyphens: none;
	hyphens: none;
	direction: ltr;
	text-align: left;
	white-space: pre;
	word-spacing: normal;
	word-break: normal;
	overflow-x: auto;
}

.scroll-when-overflowing, pre {
	overflow-x: scroll;
  -ms-overflow-style: none;  /* IE and Edge */
  scrollbar-width: none;  /* Firefox */
}

.scroll-when-overflowing::-webkit-scrollbar, pre::-webkit-scrollbar {
  display: none;
}

/* mathjax v4, where display math is not centered */
mjx-container {
	margin: auto;
}
header {
			/* display: flex; */
			/* gap: 2em; */
			border-right: 10px;
			/* flex-wrap: wrap; */
			/* justify-content: space-between; */
			/* align-items: center; */
			align-items: end;
			padding-top: 1em;
			/* padding: 1em; */
		}
.nav-item {
				font-family: var(--heading-font);
				padding-right: 5px;
				display: inline-block;
			}
			
			.nav-item a[href][aria-current="page"] {
				text-decoration: underline;
				text-decoration-thickness: 2px;
			}</style>
	</head>
	<body>
		<a href="#skip" class="visually-hidden">Skip to main content</a>

		

		<header>

			
			
			
			<a href="/" style="padding-right: 10px; color: var(--text-color); font-family: var(--heading-font); font-size: 1.5em;">Darius Foo</a>
			
				
				
				
				
				
				
			
			
			<nav style="display: inline-block">
				<h2 class="visually-hidden" id="top-level-navigation-menu">Top level navigation menu</h2>
				<ul style="list-style: none; padding: 0; margin: 0;">
					<li class="nav-item"><a href="/blog/">Blog</a></li>
					<li class="nav-item"><a href="/research/">Research</a></li>
					<li class="nav-item"><a href="/work/">Work</a></li>
					<li class="nav-item"><a href="/games/">Games</a></li>
				</ul>
			</nav>
		</header>

		<main id="skip">
			

<h1 style="margin-top: 1rem; margin-bottom: 0.2em" id="visualizing-z3s-proofs">Visualizing Z3&#39;s proofs</h1>



<div class="post-metadata">
	
	<time style="font-size: 0.9em;" datetime="2021-03-21">21 Mar 2021</time>
	
	
</div>

<div class="blog-content">
<p><em>A writeup of a presentation I gave in class.</em></p>
<p>SMT solvers like Z3 are often also called automated theorem provers. Why? What do their proofs look like?</p>
<p>An SMT solver tells us if a formula in first-order logic (augmented with various theories) is <em>satisfiable</em><sup class="footnote-ref"><a href="#fn1" id="fnref1">1</a></sup>: there is some assignment of variables that makes the formula true. Z3 can even produce such an assignment.</p>
<pre class="language-python" tabindex="0"><code class="language-python"><span class="token keyword">from</span> z3 <span class="token keyword">import</span> <span class="token operator">*</span>

i <span class="token operator">=</span> Int<span class="token punctuation">(</span><span class="token string">'i'</span><span class="token punctuation">)</span>
solve<span class="token punctuation">(</span>i <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span></code></pre>
<pre class="language-python" tabindex="0"><code class="language-python"><span class="token punctuation">[</span>i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">]</span></code></pre>
<p>Not every formula is satisfiable, though. In that case, there are two possibilities.</p>
<p>Z3 can say <code>unknown</code>. This is the less interesting one. It means that Z3 ran out of time or memory, or the algorithm it uses to find the assignment is incomplete, or the problem itself is unsolvable in general. In other words, we don't know for sure if an assignment does not exist.</p>
<!-- https://stackoverflow.com/questions/11197344/z3-produces-unknown-for-assertions-without-quantifiers -->
<p>The other outcome is <code>unsat</code>.
This is a much stronger statement than satisfiability, as it means that <em>every</em> assignment of variables must not work.</p>
<p>This has something of the flavour of proving a theorem, where we aim to convince ourselves that a formula is true for <em>every</em> assignment of variables.</p>
<p>We can connect these two views by expressing the theorem we want to prove instead as the non-existence of a <em>refutation</em>, or counterexample, to it.
We do this by negating the formula and asking, &quot;is it possible that there is some way for this formula not to be true?&quot;
<code>unsat</code> means no, i.e. the theorem is always true.</p>
<h2 id="z3s-proofs">Z3's proofs</h2>
<p>Z3 has facilities for explaining its deductions, in the form of proofs.
Let's try them on a really simple theorem, <mjx-container class="MathJax" jax="SVG" overflow="overflow"><svg style="vertical-align: -0.522ex;" xmlns="http://www.w3.org/2000/svg" width="4.373ex" height="2.088ex" role="img" focusable="false" viewBox="0 -750 2094.7 1000" xmlns:xlink="http://www.w3.org/1999/xlink"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math" data-latex="\exists a. a = a"><g data-mml-node="mi" data-latex="\exists"><use data-c="2203" xlink:href="#MJX-251-STX-N-2203"></use></g><g data-mml-node="mi" data-latex="a" transform="translate(573,0)"><use data-c="1D44E" xlink:href="#MJX-251-STX-I-1D44E"></use></g><g data-mml-node="mo" data-latex="." transform="translate(1128,0)"><use data-c="2E" xlink:href="#MJX-251-STX-N-2E"></use></g><g data-mml-node="mi" data-latex="a" transform="translate(1539.7,0)"><use data-c="1D44E" xlink:href="#MJX-251-STX-I-1D44E"></use></g></g></g><defs><path id="MJX-251-STX-N-2203" d="M498 0L498 678L75 678L75 610L431 610L431 372L87 372L87 305L431 305L431 67L75 67L75 0Z"></path><path id="MJX-251-STX-I-1D44E" d="M502 472L449 472L413 426L409 426C388 456 358 479 305 479C174 479 49 341 49 159C49 43 100-12 172-12C229-12 288 22 339 85L346 85C343 67 339 53 339 38C339 5 359-10 395-10C455-10 497 33 539 97L519 112C506 95 477 60 445 60C429 60 425 68 425 81C425 96 430 118 430 118M389 344C389 313 378 240 358 181C329 96 285 54 218 54C168 54 138 77 138 169C138 303 202 441 302 441C358 441 389 397 389 344Z"></path><path id="MJX-251-STX-N-2E" d="M183 50C183 84 161 114 122 114C85 114 62 85 62 51C62 17 81-8 121-8C161-8 183 19 183 50Z"></path><path id="MJX-251-STX-N-3D" d="M658 327L658 395L62 395L62 327M658 123L658 190L62 190L62 123Z"></path></defs></svg><mjx-break size="4"> </mjx-break><svg style="vertical-align: -0.522ex;" xmlns="http://www.w3.org/2000/svg" width="3.242ex" height="2.088ex" role="img" focusable="false" viewBox="0 -750 1552.8 1000" xmlns:xlink="http://www.w3.org/1999/xlink"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math" data-latex="\exists a. a = a"><g data-mml-node="mo" data-latex="="><use data-c="3D" xlink:href="#MJX-251-STX-N-3D"></use></g><g data-mml-node="mi" data-latex="a" transform="translate(997.8,0)"><use data-c="1D44E" xlink:href="#MJX-251-STX-I-1D44E"></use></g></g></g></svg></mjx-container>.</p>
<!-- https://stackoverflow.com/questions/49874498/can-i-replay-a-proof-in-z3 -->
<pre class="language-python" tabindex="0"><code class="language-python"><span class="token keyword">from</span> z3 <span class="token keyword">import</span> <span class="token operator">*</span>

set_param<span class="token punctuation">(</span>proof<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
s <span class="token operator">=</span> Solver<span class="token punctuation">(</span><span class="token punctuation">)</span>

a <span class="token operator">=</span> Bool<span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">)</span>
f <span class="token operator">=</span> a <span class="token operator">==</span> a
s<span class="token punctuation">.</span>add<span class="token punctuation">(</span>Not<span class="token punctuation">(</span>f<span class="token punctuation">)</span><span class="token punctuation">)</span>

res <span class="token operator">=</span> s<span class="token punctuation">.</span>check<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>
<span class="token keyword">if</span> res <span class="token operator">==</span> sat<span class="token punctuation">:</span>
  <span class="token keyword">print</span><span class="token punctuation">(</span>s<span class="token punctuation">.</span>model<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">else</span><span class="token punctuation">:</span>
  p <span class="token operator">=</span> s<span class="token punctuation">.</span>proof<span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">print</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span></code></pre>
<p>Something to note that is that variables in SMT are implicitly existentially quantified. Therefore we are searching for a counterexample by seeing if <mjx-container class="MathJax" jax="SVG" overflow="overflow"><svg style="vertical-align: -0.522ex;" xmlns="http://www.w3.org/2000/svg" width="4.373ex" height="2.088ex" role="img" focusable="false" viewBox="0 -750 2094.7 1000" xmlns:xlink="http://www.w3.org/1999/xlink"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math" data-latex="\forall a. a \neq a"><g data-mml-node="mi" data-latex="\forall"><use data-c="2200" xlink:href="#MJX-252-STX-N-2200"></use></g><g data-mml-node="mi" data-latex="a" transform="translate(573,0)"><use data-c="1D44E" xlink:href="#MJX-252-STX-I-1D44E"></use></g><g data-mml-node="mo" data-latex="." transform="translate(1128,0)"><use data-c="2E" xlink:href="#MJX-252-STX-N-2E"></use></g><g data-mml-node="mi" data-latex="a" transform="translate(1539.7,0)"><use data-c="1D44E" xlink:href="#MJX-252-STX-I-1D44E"></use></g></g></g><defs><path id="MJX-252-STX-N-2200" d="M571 678L498 678L423 474L150 474L75 678L2 678L253 0L320 0M400 412L286 105L173 412Z"></path><path id="MJX-252-STX-I-1D44E" d="M502 472L449 472L413 426L409 426C388 456 358 479 305 479C174 479 49 341 49 159C49 43 100-12 172-12C229-12 288 22 339 85L346 85C343 67 339 53 339 38C339 5 359-10 395-10C455-10 497 33 539 97L519 112C506 95 477 60 445 60C429 60 425 68 425 81C425 96 430 118 430 118M389 344C389 313 378 240 358 181C329 96 285 54 218 54C168 54 138 77 138 169C138 303 202 441 302 441C358 441 389 397 389 344Z"></path><path id="MJX-252-STX-N-2E" d="M183 50C183 84 161 114 122 114C85 114 62 85 62 51C62 17 81-8 121-8C161-8 183 19 183 50Z"></path><path id="MJX-252-STX-N-2260" d="M658 123L658 190L357 190L417 327L658 327L658 395L446 395L570 678L515 678L392 395L62 395L62 327L362 327L302 190L62 190L62 123L272 123L149-160L204-160L327 123Z"></path></defs></svg><mjx-break size="4"> </mjx-break><svg style="vertical-align: -0.522ex;" xmlns="http://www.w3.org/2000/svg" width="3.242ex" height="2.088ex" role="img" focusable="false" viewBox="0 -750 1552.8 1000" xmlns:xlink="http://www.w3.org/1999/xlink"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math" data-latex="\forall a. a \neq a"><g data-mml-node="mo" data-latex="\neq"><use data-c="2260" xlink:href="#MJX-252-STX-N-2260"></use></g><g data-mml-node="mi" data-latex="a" transform="translate(997.8,0)"><use data-c="1D44E" xlink:href="#MJX-252-STX-I-1D44E"></use></g></g></g></svg></mjx-container> is satisfiable.</p>
<pre class="language-python" tabindex="0"><code class="language-python">unsat
mp<span class="token punctuation">(</span>asserted<span class="token punctuation">(</span>Not<span class="token punctuation">(</span>a <span class="token operator">==</span> a<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
   trans<span class="token punctuation">(</span>monotonicity<span class="token punctuation">(</span>rewrite<span class="token punctuation">(</span><span class="token punctuation">(</span>a <span class="token operator">==</span> a<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                      Not<span class="token punctuation">(</span>a <span class="token operator">==</span> a<span class="token punctuation">)</span> <span class="token operator">==</span> Not<span class="token punctuation">(</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
         rewrite<span class="token punctuation">(</span>Not<span class="token punctuation">(</span><span class="token boolean">True</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token boolean">False</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
         Not<span class="token punctuation">(</span>a <span class="token operator">==</span> a<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token boolean">False</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
   <span class="token boolean">False</span><span class="token punctuation">)</span></code></pre>
<p>Unsurprisingly, it is not.
Z3 outputs a <em>proof tree</em>, which we can traverse and pretty-print.</p>
<p><picture><source type="image/avif" srcset="/blog/z3-proofs/eCd6ZZJBEd-964.avif 964w"><source type="image/webp" srcset="/blog/z3-proofs/eCd6ZZJBEd-964.webp 964w"><img loading="lazy" decoding="async" src="/blog/z3-proofs/eCd6ZZJBEd-964.png" class="theme-affected" alt="first pretty-printed proof tree" width="964" height="156"></picture></p>
<p>Firstly, we see that the conclusion at the bottom is <code>False</code>.
This may seem odd, but recall that the goal is to show that negation of the original theorem cannot be proved, so this is the only conclusion which makes sense.</p>
<p>Next, we see some of Z3's inference rules<sup class="footnote-ref"><a href="#fn2" id="fnref2">2</a></sup> in action.
Our original goal is <code>asserted</code>.
We have two instances of <code>rewrite</code>, where built-in equalities are used to simplify terms.
There is an application of <code>monotonicity</code>, where we negate both sides.
Finally we use the <code>trans</code>itivity of equality and modus ponens to derive the conclusion.</p>
<p>Let's try <mjx-container class="MathJax" jax="SVG" overflow="overflow"><svg style="vertical-align: -0.522ex;" xmlns="http://www.w3.org/2000/svg" width="4.373ex" height="2.088ex" role="img" focusable="false" viewBox="0 -750 2094.7 1000" xmlns:xlink="http://www.w3.org/1999/xlink"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math" data-latex="\exists a. a = \neg (\neg a)"><g data-mml-node="mi" data-latex="\exists"><use data-c="2203" xlink:href="#MJX-253-STX-N-2203"></use></g><g data-mml-node="mi" data-latex="a" transform="translate(573,0)"><use data-c="1D44E" xlink:href="#MJX-253-STX-I-1D44E"></use></g><g data-mml-node="mo" data-latex="." transform="translate(1128,0)"><use data-c="2E" xlink:href="#MJX-253-STX-N-2E"></use></g><g data-mml-node="mi" data-latex="a" transform="translate(1539.7,0)"><use data-c="1D44E" xlink:href="#MJX-253-STX-I-1D44E"></use></g></g></g><defs><path id="MJX-253-STX-N-2203" d="M498 0L498 678L75 678L75 610L431 610L431 372L87 372L87 305L431 305L431 67L75 67L75 0Z"></path><path id="MJX-253-STX-I-1D44E" d="M502 472L449 472L413 426L409 426C388 456 358 479 305 479C174 479 49 341 49 159C49 43 100-12 172-12C229-12 288 22 339 85L346 85C343 67 339 53 339 38C339 5 359-10 395-10C455-10 497 33 539 97L519 112C506 95 477 60 445 60C429 60 425 68 425 81C425 96 430 118 430 118M389 344C389 313 378 240 358 181C329 96 285 54 218 54C168 54 138 77 138 169C138 303 202 441 302 441C358 441 389 397 389 344Z"></path><path id="MJX-253-STX-N-2E" d="M183 50C183 84 161 114 122 114C85 114 62 85 62 51C62 17 81-8 121-8C161-8 183 19 183 50Z"></path><path id="MJX-253-STX-N-3D" d="M658 327L658 395L62 395L62 327M658 123L658 190L62 190L62 123Z"></path><path id="MJX-253-STX-N-AC" d="M638 83L638 416L62 416L62 348L566 348L566 83Z"></path><path id="MJX-253-STX-N-28" d="M45 270C45 47 150-112 311-196L327-170C181-71 127 66 127 270C127 474 181 611 327 710L311 736C150 652 45 493 45 270Z"></path><path id="MJX-253-STX-N-29" d="M312 270C312 493 207 652 46 736L30 710C176 611 230 474 230 270C230 66 176-71 30-170L46-196C207-112 312 47 312 270Z"></path></defs></svg><mjx-break size="4"> </mjx-break><svg style="vertical-align: -0.522ex;" xmlns="http://www.w3.org/2000/svg" width="7.739ex" height="2.088ex" role="img" focusable="false" viewBox="0 -750 3706.8 1000" xmlns:xlink="http://www.w3.org/1999/xlink"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math" data-latex="\exists a. a = \neg (\neg a)"><g data-mml-node="mo" data-latex="="><use data-c="3D" xlink:href="#MJX-253-STX-N-3D"></use></g><g data-mml-node="mi" data-latex="\neg" transform="translate(997.8,0)"><use data-c="AC" xlink:href="#MJX-253-STX-N-AC"></use></g><g data-mml-node="mo" data-latex="(" transform="translate(1717.8,0) translate(0 -20)"><use data-c="28" xlink:href="#MJX-253-STX-N-28"></use></g><g data-mml-node="mi" data-latex="\neg" transform="translate(2074.8,0)"><use data-c="AC" xlink:href="#MJX-253-STX-N-AC"></use></g><g data-mml-node="mi" data-latex="a" transform="translate(2794.8,0)"><use data-c="1D44E" xlink:href="#MJX-253-STX-I-1D44E"></use></g><g data-mml-node="mo" data-latex=")" transform="translate(3349.8,0) translate(0 -20)"><use data-c="29" xlink:href="#MJX-253-STX-N-29"></use></g></g></g></svg></mjx-container>.</p>
<p><picture><source type="image/avif" srcset="/blog/z3-proofs/HV6aMLnxj0-1743.avif 1743w"><source type="image/webp" srcset="/blog/z3-proofs/HV6aMLnxj0-1743.webp 1743w"><img loading="lazy" decoding="async" src="/blog/z3-proofs/HV6aMLnxj0-1743.png" class="theme-affected" alt="another proof tree" width="1743" height="290"></picture></p>
<p>And here's another for the linear arithmetic formula <mjx-container class="MathJax" jax="SVG" overflow="overflow"><svg style="vertical-align: -0.522ex;" xmlns="http://www.w3.org/2000/svg" width="6.488ex" height="2.088ex" role="img" focusable="false" viewBox="0 -750 3107.7 1000" xmlns:xlink="http://www.w3.org/1999/xlink"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math" data-latex="\exists x y. 2 x \leq 3 y, y > x, x > 0"><g data-mml-node="mi" data-latex="\exists"><use data-c="2203" xlink:href="#MJX-254-STX-N-2203"></use></g><g data-mml-node="mi" data-latex="x" transform="translate(573,0)"><use data-c="1D465" xlink:href="#MJX-254-STX-I-1D465"></use></g><g data-mml-node="mi" data-latex="y" transform="translate(1132,0)"><use data-c="1D466" xlink:href="#MJX-254-STX-I-1D466"></use></g><g data-mml-node="mo" data-latex="." transform="translate(1642,0)"><use data-c="2E" xlink:href="#MJX-254-STX-N-2E"></use></g><g data-mml-node="mn" data-latex="2" transform="translate(2053.7,0)"><use data-c="32" xlink:href="#MJX-254-STX-N-32"></use></g><g data-mml-node="mi" data-latex="x" transform="translate(2548.7,0)"><use data-c="1D465" xlink:href="#MJX-254-STX-I-1D465"></use></g></g></g><defs><path id="MJX-254-STX-N-2203" d="M498 0L498 678L75 678L75 610L431 610L431 372L87 372L87 305L431 305L431 67L75 67L75 0Z"></path><path id="MJX-254-STX-I-1D465" d="M315 298L312 298L300 349C286 403 267 447 243 475L228 475L89 459L89 429C89 429 104 432 120 432C186 433 203 406 230 322L258 231L186 126C147 70 129 69 125 69C108 69 84 82 62 82C38 82 23 60 23 40C23 15 38-9 81-9C141-9 174 38 206 90L270 194L274 194L299 93C313 28 335-10 381-10C449-10 491 58 520 102L499 118C472 82 453 62 427 62C396 62 376 99 348 191L327 259L388 356C405 384 419 398 442 398C455 398 478 388 494 388C521 388 540 411 540 435C540 463 528 479 490 479C431 479 391 430 364 382Z"></path><path id="MJX-254-STX-I-1D466" d="M251 325C239 405 232 437 210 475L195 475L53 464L53 435C53 435 74 437 88 437C149 437 154 388 161 343L220-9C192-52 112-165 93-165C71-165 60-112 22-112C-1-112-17-125-17-155C-17-192 18-220 60-220C136-220 197-112 289 15C341 87 398 173 452 268C484 322 496 367 496 406C496 449 470 482 433 482C404 482 389 464 389 443C389 405 438 377 438 351C438 327 429 303 405 264L290 79L284 79L275 179Z"></path><path id="MJX-254-STX-N-2E" d="M183 50C183 84 161 114 122 114C85 114 62 85 62 51C62 17 81-8 121-8C161-8 183 19 183 50Z"></path><path id="MJX-254-STX-N-32" d="M464 160L435 160C412 100 399 79 346 79L207 79L137 76L137 81L269 206C375 313 432 382 432 471C432 576 353 644 240 644C143 644 75 588 44 491L68 481C105 556 149 579 214 579C291 579 339 531 339 456C339 351 289 288 190 186L38 34L38 0L432 0Z"></path><path id="MJX-254-STX-N-2264" d="M650 52L650 116L207 337L650 557L650 623L71 342L71 332M650-106L650-38L71-38L71-106Z"></path><path id="MJX-254-STX-N-33" d="M86 498C120 551 157 579 217 579C279 579 319 545 319 486C319 405 248 350 180 350L161 350L161 312L181 312C277 312 362 253 362 164C362 66 301 37 238 37C214 37 200 41 157 63C122 81 114 86 98 86C72 86 59 63 59 42C59 16 81-13 171-13C317-13 444 57 444 194C444 283 377 336 297 361L297 364C360 404 405 441 405 510C405 586 346 644 244 644C162 644 100 598 63 511Z"></path><path id="MJX-254-STX-N-2C" d="M70-132C110-114 194-80 194 33C194 88 167 121 117 121C77 121 55 94 55 62C55 33 71 8 110 8C121 8 130 10 141 14C141-67 95-91 58-107Z"></path><path id="MJX-254-STX-N-3E" d="M650 255L650 265L71 547L71 478L513 260L71 42L71-25Z"></path><path id="MJX-254-STX-N-30" d="M468 317C468 523 378 642 249 642C104 642 27 510 27 320C27 143 86-11 247-11C404-11 468 146 468 317M371 311C371 119 326 25 247 25C167 25 123 121 123 315C123 513 167 608 246 608C328 608 371 514 371 311Z"></path></defs></svg><mjx-break size="4"> </mjx-break><svg style="vertical-align: -0.522ex;" xmlns="http://www.w3.org/2000/svg" width="6.105ex" height="2.088ex" role="img" focusable="false" viewBox="0 -750 2924.4 1000" xmlns:xlink="http://www.w3.org/1999/xlink"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math" data-latex="\exists x y. 2 x \leq 3 y, y > x, x > 0"><g data-mml-node="mo" data-latex="\leq"><use data-c="2264" xlink:href="#MJX-254-STX-N-2264"></use></g><g data-mml-node="mn" data-latex="3" transform="translate(997.8,0)"><use data-c="33" xlink:href="#MJX-254-STX-N-33"></use></g><g data-mml-node="mi" data-latex="y" transform="translate(1492.8,0)"><use data-c="1D466" xlink:href="#MJX-254-STX-I-1D466"></use></g><g data-mml-node="mo" data-latex="," transform="translate(2002.8,0)"><use data-c="2C" xlink:href="#MJX-254-STX-N-2C"></use></g><g data-mml-node="mi" data-latex="y" transform="translate(2414.4,0)"><use data-c="1D466" xlink:href="#MJX-254-STX-I-1D466"></use></g></g></g></svg><mjx-break size="4"> </mjx-break><svg style="vertical-align: -0.522ex;" xmlns="http://www.w3.org/2000/svg" width="5.277ex" height="2.088ex" role="img" focusable="false" viewBox="0 -750 2527.4 1000" xmlns:xlink="http://www.w3.org/1999/xlink"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math" data-latex="\exists x y. 2 x \leq 3 y, y > x, x > 0"><g data-mml-node="mo" data-latex=">"><use data-c="3E" xlink:href="#MJX-254-STX-N-3E"></use></g><g data-mml-node="mi" data-latex="x" transform="translate(997.8,0)"><use data-c="1D465" xlink:href="#MJX-254-STX-I-1D465"></use></g><g data-mml-node="mo" data-latex="," transform="translate(1556.8,0)"><use data-c="2C" xlink:href="#MJX-254-STX-N-2C"></use></g><g data-mml-node="mi" data-latex="x" transform="translate(1968.4,0)"><use data-c="1D465" xlink:href="#MJX-254-STX-I-1D465"></use></g></g></g></svg><mjx-break size="4"> </mjx-break><svg style="vertical-align: -0.522ex;" xmlns="http://www.w3.org/2000/svg" width="3.116ex" height="2.088ex" role="img" focusable="false" viewBox="0 -750 1492.8 1000" xmlns:xlink="http://www.w3.org/1999/xlink"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math" data-latex="\exists x y. 2 x \leq 3 y, y > x, x > 0"><g data-mml-node="mo" data-latex=">"><use data-c="3E" xlink:href="#MJX-254-STX-N-3E"></use></g><g data-mml-node="mn" data-latex="0" transform="translate(997.8,0)"><use data-c="30" xlink:href="#MJX-254-STX-N-30"></use></g></g></g></svg></mjx-container>.</p>
<p><picture><source type="image/avif" srcset="/blog/z3-proofs/8PuYupz8iZ-2726.avif 2726w"><source type="image/webp" srcset="/blog/z3-proofs/8PuYupz8iZ-2726.webp 2726w"><img loading="lazy" decoding="async" src="/blog/z3-proofs/8PuYupz8iZ-2726.png" class="theme-affected" alt="linear arithmetic formula proof, overwhelming detail" width="2726" height="165"></picture></p>
<p>Clearly, these generated proofs quickly get too large to be comprehensible.
They're also largely mechanical and not very meaningful.
Still, it's intriguing to see the automated reasoning that Z3 performs.</p>
<p>A final point about the last one is the application of the rule <code>th-lemma</code> to derive the conclusion.</p>
<p><picture><source type="image/avif" srcset="/blog/z3-proofs/92fQ8tuCpw-489.avif 489w"><source type="image/webp" srcset="/blog/z3-proofs/92fQ8tuCpw-489.webp 489w"><img loading="lazy" decoding="async" src="/blog/z3-proofs/92fQ8tuCpw-489.png" class="theme-affected" alt="theory lemma" width="489" height="59"></picture></p>
<p>This is a theory lemma, a placeholder rule for a possibly-opaque decision from a theory solver.</p>
<p>If you want to generate these proofs yourself, the code is <a href="https://gist.github.com/dariusf/1fbb17816bea7417e4a104d58d2053d8">here</a>.</p>
<hr class="footnotes-sep">
<section class="footnotes">
<ol class="footnotes-list">
<li id="fn1" class="footnote-item"><p>For a more thorough introduction to satisfiability, check out <a href="https://homes.cs.washington.edu/~emina/blog/2017-06-23-a-primer-on-sat.html#satisfiability-and-validity">this blog post</a>. <a href="#fnref1" class="footnote-backref">↩︎</a></p>
</li>
<li id="fn2" class="footnote-item"><p>There's a more complete list of rules in Section 3.3 of <a href="https://www21.in.tum.de/~boehmes/proofrec.pdf">this paper</a>. <a href="#fnref2" class="footnote-backref">↩︎</a></p>
</li>
</ol>
</section>

</div>

		</main>

		<footer>
			
		</footer>

		<!-- This page `/blog/z3-proofs/` was built on 2025-11-29T07:36:07.435Z -->
		
	</body>
</html>
