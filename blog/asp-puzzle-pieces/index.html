<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, shrink-to-fit=no">

		<meta property="og:title" content="Darius Foo">
		<meta property="og:type" content="article">
		<meta property="og:url" content="https://dariusf.github.io">
		<meta property="og:image" content="https://dariusf.github.io/avatar.png">

		<title>Bags of puzzle pieces in ASP</title>
		<meta name="description" content="PhD student, programming languages and formal verification">
		<link rel="alternate" href="/feed/feed.xml" type="application/atom+xml" title="Darius Foo">


		

		

		

		

		
		
		<style>@media (prefers-color-scheme: light) { /**
 * prism.js default theme for JavaScript, CSS and HTML
 * Based on dabblet (http://dabblet.com)
 * @author Lea Verou
 */

code[class*="language-"],
pre[class*="language-"] {
	color: black;
	background: none;
	text-shadow: 0 1px white;
	font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
	font-size: 1em;
	text-align: left;
	white-space: pre;
	word-spacing: normal;
	word-break: normal;
	word-wrap: normal;
	line-height: 1.5;

	-moz-tab-size: 4;
	-o-tab-size: 4;
	tab-size: 4;

	-webkit-hyphens: none;
	-moz-hyphens: none;
	-ms-hyphens: none;
	hyphens: none;
}

pre[class*="language-"]::-moz-selection, pre[class*="language-"] ::-moz-selection,
code[class*="language-"]::-moz-selection, code[class*="language-"] ::-moz-selection {
	text-shadow: none;
	background: #b3d4fc;
}

pre[class*="language-"]::selection, pre[class*="language-"] ::selection,
code[class*="language-"]::selection, code[class*="language-"] ::selection {
	text-shadow: none;
	background: #b3d4fc;
}

@media print {
	code[class*="language-"],
	pre[class*="language-"] {
		text-shadow: none;
	}
}

/* Code blocks */
pre[class*="language-"] {
	padding: 1em;
	margin: .5em 0;
	overflow: auto;
}

:not(pre) > code[class*="language-"],
pre[class*="language-"] {
	background: #f5f2f0;
}

/* Inline code */
:not(pre) > code[class*="language-"] {
	padding: .1em;
	border-radius: .3em;
	white-space: normal;
}

.token.comment,
.token.prolog,
.token.doctype,
.token.cdata {
	color: slategray;
}

.token.punctuation {
	color: #999;
}

.token.namespace {
	opacity: .7;
}

.token.property,
.token.tag,
.token.boolean,
.token.number,
.token.constant,
.token.symbol,
.token.deleted {
	color: #905;
}

.token.selector,
.token.attr-name,
.token.string,
.token.char,
.token.builtin,
.token.inserted {
	color: #690;
}

.token.operator,
.token.entity,
.token.url,
.language-css .token.string,
.style .token.string {
	color: #9a6e3a;
	/* This background color was intended by the author of this theme. */
	background: hsla(0, 0%, 100%, .5);
}

.token.atrule,
.token.attr-value,
.token.keyword {
	color: #07a;
}

.token.function,
.token.class-name {
	color: #DD4A68;
}

.token.regex,
.token.important,
.token.variable {
	color: #e90;
}

.token.important,
.token.bold {
	font-weight: bold;
}
.token.italic {
	font-style: italic;
}

.token.entity {
	cursor: help;
}
 }
@media (prefers-color-scheme: dark) { /**
 * prism.js tomorrow night eighties for JavaScript, CoffeeScript, CSS and HTML
 * Based on https://github.com/chriskempson/tomorrow-theme
 * @author Rose Pritchard
 */

code[class*="language-"],
pre[class*="language-"] {
	color: #ccc;
	background: none;
	font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
	font-size: 1em;
	text-align: left;
	white-space: pre;
	word-spacing: normal;
	word-break: normal;
	word-wrap: normal;
	line-height: 1.5;

	-moz-tab-size: 4;
	-o-tab-size: 4;
	tab-size: 4;

	-webkit-hyphens: none;
	-moz-hyphens: none;
	-ms-hyphens: none;
	hyphens: none;

}

/* Code blocks */
pre[class*="language-"] {
	padding: 1em;
	margin: .5em 0;
	overflow: auto;
}

:not(pre) > code[class*="language-"],
pre[class*="language-"] {
	background: #2d2d2d;
}

/* Inline code */
:not(pre) > code[class*="language-"] {
	padding: .1em;
	border-radius: .3em;
	white-space: normal;
}

.token.comment,
.token.block-comment,
.token.prolog,
.token.doctype,
.token.cdata {
	color: #999;
}

.token.punctuation {
	color: #ccc;
}

.token.tag,
.token.attr-name,
.token.namespace,
.token.deleted {
	color: #e2777a;
}

.token.function-name {
	color: #6196cc;
}

.token.boolean,
.token.number,
.token.function {
	color: #f08d49;
}

.token.property,
.token.class-name,
.token.constant,
.token.symbol {
	color: #f8c555;
}

.token.selector,
.token.important,
.token.atrule,
.token.keyword,
.token.builtin {
	color: #cc99cd;
}

.token.string,
.token.char,
.token.attr-value,
.token.regex,
.token.variable {
	color: #7ec699;
}

.token.operator,
.token.entity,
.token.url {
	color: #67cdcc;
}

.token.important,
.token.bold {
	font-weight: bold;
}
.token.italic {
	font-style: italic;
}

.token.entity {
	cursor: help;
}

.token.inserted {
	color: green;
}
 }
/* This is an arbitrary CSS string added to the bundle */
:root {
	/* --font-family: -apple-system, system-ui, sans-serif; */
	/* --font-family-monospace: Consolas, Menlo, Monaco, Andale Mono WT, Andale Mono, Lucida Console, Lucida Sans Typewriter, DejaVu Sans Mono, Bitstream Vera Sans Mono, Liberation Mono, Nimbus Mono L, Courier New, Courier, monospace;
	*/

    --font-family-monospace: Fira Code, Menlo, Consolas, Monaco, Liberation Mono, Lucida Console, monospace;


  /*    --text-font: Crimson Text, serif;*/
  /*    --text-font: Poppins, Verdana, sans-serif;*/
  /*    --heading-font: Quicksand, sans-serif;*/
  /*    --text-font: Open Sans, sans-serif;*/
  /*    --text-font-size: 16px;*/
  /*    --heading-font: Open Sans, sans-serif;*/
  /*    --text-font: Cabin, sans-serif;*/
  /*    --text-font-size: 16px;*/
  /*    --text-font: Roboto, sans-serif;*/

  /*    --heading-font: Roboto, sans-serif;*/
  /*    --heading-font: Cabin, sans-serif;*/
  /*    --heading-font: Dosis, sans-serif;*/

  /*    --heading-font: Work Sans, sans-serif;*/
  /*    --text-font: Open Sans, sans-serif;*/

      /* --heading-font: Nunito, sans-serif; */
      --heading-font: ui-rounded, 'Hiragino Maru Gothic ProN', Quicksand, Comfortaa, Manjari, 'Arial Rounded MT', 'Arial Rounded MT Bold', Calibri, source-sans-pro, sans-serif;
  /*    --text-font: PT Sans, sans-serif;*/

  /*    --heading-font: Varela Round, sans-serif;*/
  /*    --text-font: Noto Serif, serif;*/

  /*    --text-font: Lato, sans-serif;*/
      --text-font-size: 17px;

  /*    --text-font: Merriweather, sans-serif;*/
  /*    --text-font-size: 16px;*/

  /* https://css-tricks.com/snippets/css/system-font-stack/ */
  /* https://systemfontstack.com/ */

    /* system font on all platforms */
  /*    --heading-font: -apple-system, system-ui, BlinkMacSystemFont, "Segoe UI", Roboto, Ubuntu;*/
      /* --text-font: -apple-system, system-ui, BlinkMacSystemFont, "Segoe UI", Roboto, Ubuntu; */
      --text-font: -apple-system, system-ui, sans-serif;
			/* system-ui, sans-serif; */


/* Theme colors */

	/* --color-gray-20: #e0e0e0;
	--color-gray-50: #C0C0C0;
	--color-gray-90: #333; */

	--background-color: #fff;

	/* --text-color: var(--color-gray-90); */
	/* --text-color-link: #082840; */

	/* --text-color-link: #ff0000; */
	/* --text-color-link-active: #5f2b48; */
	/* --text-color-link-visited: #17050F; */


	/* --syntax-tab-size: 2; */

	--bright-text-color: #222;
	--link-color: #3273dc;
	/* --link-color: #ff5e6c; */
	--link-visited-color: #6e4bbe;
	--background-color: #fff;
	--text-color: #444;
	--faded-text-color: #777;
	--blockquote-text-color: var(--bright-text-color);
	--faint-color: #ccc;
}

@media (prefers-color-scheme: dark) {
	:root {
		/* --color-gray-20: #e0e0e0; */
		/* --color-gray-50: #C0C0C0; */
		/* --color-gray-90: #dad8d8; */

		/* --text-color is assigned to --color-gray-_ above */
		/* --text-color-link: #1493fb; */
		/* --text-color-link-active: #6969f7; */
		/* --text-color-link-visited: #a6a6f8; */

		--background-color: #15202b;

		--bright-text-color: #eee;
		--link-color: #8cc2dd;
		--link-visited-color: #b9a9e0;
		--background-color: #333;
		--text-color: #ddd;
		--faded-text-color: #aaa;
		--slightly-dimmer-text-color: #ccc;
		--blockquote-text-color: var(--slightly-dimmer-text-color);
		--faint-color: #666;

		color-scheme: dark; /* sets scrollbar colour */
	}

	.theme-affected {
		filter: invert(.8);
	}
}

body {
	box-sizing: border-box;

	/* https://github.com/sindresorhus/github-markdown-css */
	min-width: 200px;
	/* max from old blog */
	/* max-width: 40em; */
	/* tiny bit wider because prism adds some padding */
	max-width: 726px;

	margin: 0 auto;
	padding: 0 20px;

	/* enable ligatures */
	text-rendering: optimizeLegibility;

	font-family: var(--text-font);
	font-size: var(--text-font-size);
	color: var(--text-color);
	background-color: var(--background-color);

	/*
	text-align: left;
	word-wrap: break-word;
	overflow-wrap: break-word;
	*/
	/* line-height: 1.5; */
}

@media (max-width: 767px) {
	body {
		padding: 0px 1em;
	}
}

@view-transition {
	navigation: auto;
}

html {
	overflow-y: scroll;
}

/* https://github.com/Kimeiga/bahunya/blob/master/src/parts/_typography.css */
ul, ol {
  padding-left: 2em;
}

li {
	line-height: 1.5;
}

h1, h2, h3, h4, h5, h6 {
	font-family: var(--heading-font);
	color: var(--bright-text-color);
	font-weight: normal;
	line-height: 1.25;
}

footer {
	padding: 35px;
}

/* header {
	border-bottom: 1px dashed var(--color-gray-20);
} */


/* misc changes from here on */

/* https://www.a11yproject.com/posts/how-to-hide-content/ */
.visually-hidden {
	clip: rect(0 0 0 0);
	clip-path: inset(50%);
	height: 1px;
	overflow: hidden;
	position: absolute;
	white-space: nowrap;
	width: 1px;
}

p:has(img) {
	text-align: center;
}
/* Fluid images via https://www.zachleat.com/web/fluid-images/ */
img{
  max-width: 100%;
}
img[width][height] {
  height: auto;
}
/* img[src$=".svg"] {
  width: 100%;
  height: auto;
  max-width: none;
} */
video,
iframe {
	width: 100%;
	height: auto;
}
iframe {
	aspect-ratio: 16/9;
}

p:last-child {
	margin-bottom: 0;
}
p {
	line-height: 1.5;
}

a[href] {
	color: var(--link-color);
	text-decoration: none;
}

/* a[href]:visited {
	color: var(--link-visited-color);
} */

/* a[href]:hover,
a[href]:active { */
	/* color: var(--text-color-link-active); */
	/* text-decoration: underline; */
	/* text-decoration-thickness: 2px; */
/* } */

/* main :first-child {
	margin-top: 0;
} */

/* .links-nextprev {
	display: flex;
	justify-content: space-between;
	gap: .5em 1em;
	list-style: "";
	border-top: 1px dashed var(--color-gray-20);
	padding: 1em 0;
}
.links-nextprev > * {
	flex-grow: 1;
}
.links-nextprev-next {
	text-align: right;
} */

table {
	margin: 1em 0;
	border-collapse: collapse;
}
table td,
table th {
	padding-right: 1em;
}
/* table thead tr th {
  border-bottom: solid var(--text-color) 2px;
  border-top: solid var(--text-color) 2px;
} */

.table-lines td {
  border-bottom: solid var(--text-color) 1px;
  border-top: solid var(--text-color) 1px;
}

/* pre,
code {
	font-family: var(--font-family-monospace) !important;
	font-size: 14px !important;
} */

/* override prism */
/* https://github.com/orgs/PrismJS/discussions/2859 */
code[class*="language-"],
pre[class*="language-"] {
	font-family: var(--font-family-monospace);
	font-size: 14px;
}

pre[class*="language-"] {
	margin-top: 0;
	margin-bottom: 1em;
}

pre:not([class*="language-"]) {
	margin: .5em 0;
	line-height: 1.375; /* 22px /16 */
	/* -moz-tab-size: var(--syntax-tab-size); */
	/* -o-tab-size: var(--syntax-tab-size); */
	/* tab-size: var(--syntax-tab-size); */
	-webkit-hyphens: none;
	-ms-hyphens: none;
	hyphens: none;
	direction: ltr;
	text-align: left;
	white-space: pre;
	word-spacing: normal;
	word-break: normal;
	overflow-x: auto;
}

.scroll-when-overflowing, pre {
	overflow-x: scroll;
  -ms-overflow-style: none;  /* IE and Edge */
  scrollbar-width: none;  /* Firefox */
}

.scroll-when-overflowing::-webkit-scrollbar, pre::-webkit-scrollbar {
  display: none;
}

/* mathjax v4, where display math is not centered */
mjx-container {
	margin: auto;
}
header {
			/* display: flex; */
			/* gap: 2em; */
			border-right: 10px;
			/* flex-wrap: wrap; */
			/* justify-content: space-between; */
			/* align-items: center; */
			align-items: end;
			padding-top: 1em;
			/* padding: 1em; */
		}
.nav-item {
				font-family: var(--heading-font);
				padding-right: 5px;
				display: inline-block;
			}
			
			.nav-item a[href][aria-current="page"] {
				text-decoration: underline;
				text-decoration-thickness: 2px;
			}</style>
	</head>
	<body>
		<a href="#skip" class="visually-hidden">Skip to main content</a>

		

		<header>

			
			
			
			<a href="/" style="padding-right: 10px; color: var(--text-color); font-family: var(--heading-font); font-size: 1.5em;">Darius Foo</a>
			
				
				
				
				
				
				
			
			
			<nav style="display: inline-block">
				<h2 class="visually-hidden" id="top-level-navigation-menu">Top level navigation menu</h2>
				<ul style="list-style: none; padding: 0; margin: 0;">
					<li class="nav-item"><a href="/blog/">Blog</a></li>
					<li class="nav-item"><a href="/research/">Research</a></li>
					<li class="nav-item"><a href="/work/">Work</a></li>
					<li class="nav-item"><a href="/games/">Games</a></li>
				</ul>
			</nav>
		</header>

		<main id="skip">
			

<h1 style="margin-top: 1rem; margin-bottom: 0.2em" id="bags-of-puzzle-pieces-in-asp">Bags of puzzle pieces in ASP</h1>



<div class="post-metadata">
	
	<time style="font-size: 0.9em;" datetime="2017-11-25">25 Nov 2017</time>
	
	
</div>

<div class="blog-content">
<p>Answer set programming is an offshoot of traditional logic programming with a number of nice properties: programs always terminate, are fully declarative (i.e. clause ordering doesn't matter and search is complete, unlike Prolog), and have a <a href="https://en.wikipedia.org/wiki/Stable_model_semantics">well-defined semantics</a>. Modelling a domain with relations is a wonderfully high-level way to reason about things, allowing complex rules to be represented <a href="https://en.wikipedia.org/wiki/Answer_set_programming#Examples_of_ASP_programs">concisely</a>.</p>
<p>ASP is typically applied to hard search problems, but can model pretty much anything. One area it's popular in is game design, particularly for <a href="https://adamsmith.as/papers/tciaig-asp4pcg.pdf">procedural content generation</a>: if we can write down the rules of, say, a puzzle game, we can straightforwardly sample valid puzzles (or even <a href="https://adamsmith.as/papers/fdg2013_shortcuts.pdf">solutions to puzzles</a>) with desirable properties.</p>
<p>Here, we'll explore one way of sampling puzzle pieces: given an infinite bag of heterogeneous pieces, we want to grab a <em>handful</em>, put them on the game board, then rule out the worlds where the pieces don't form a valid puzzle.</p>
<p>Incidentally, this is how one typically approaches problems with ASP: defining the <em>entire</em> problem space and how to prune it down to the interesting bits.</p>
<p>By a <em>handful</em>, we intuitively mean <em>some</em> quantity of pieces with <em>some</em> types. For example, we might generate <a href="https://en.wikipedia.org/wiki/Pipe_Mania">Pipe Mania</a> or <a href="https://en.wikipedia.org/wiki/Rush_Hour_(puzzle)">Rush Hour</a> boards such that we get a puzzle of appropriate size or difficulty.</p>
<p>Generally, the number of piece types is finite and much smaller than the size of the game board, so we'll want to allow duplicate pieces. We'll represent pieces very abstractly, indexed by an identifier and piece type.</p>
<pre class="language-erlang" tabindex="0"><code class="language-erlang"><span class="token function">piece</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token atom">a</span><span class="token punctuation">)</span><span class="token punctuation">.</span></code></pre>
<p>We'll start with 4 piece types, and an upper limit on the maximum number of pieces we want per puzzle -- ASP programs must terminate, so domains must be finite.</p>
<pre class="language-erlang" tabindex="0"><code class="language-erlang"><span class="token punctuation">#</span><span class="token atom">const</span> <span class="token atom">max_n</span><span class="token operator">=</span><span class="token number">4.</span>

<span class="token function">piece_type</span><span class="token punctuation">(</span><span class="token atom">a</span><span class="token punctuation">;</span><span class="token atom">b</span><span class="token punctuation">;</span><span class="token atom">c</span><span class="token punctuation">;</span><span class="token atom">d</span><span class="token punctuation">)</span><span class="token punctuation">.</span>
<span class="token function">piece_n</span><span class="token punctuation">(</span><span class="token number">1.</span><span class="token punctuation">.</span><span class="token atom">max_n</span><span class="token punctuation">)</span><span class="token punctuation">.</span></code></pre>
<p>Two pieces of type <code>b</code> and one piece of type <code>a</code> might be represented as follows.</p>
<pre class="language-erlang" tabindex="0"><code class="language-erlang"><span class="token function">piece</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token atom">a</span><span class="token punctuation">)</span><span class="token punctuation">.</span>
<span class="token function">piece</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token atom">b</span><span class="token punctuation">)</span><span class="token punctuation">.</span>
<span class="token function">piece</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token atom">b</span><span class="token punctuation">)</span><span class="token punctuation">.</span></code></pre>
<p>Now to get our handful of pieces. There are two quantities to vary: the number of pieces and the piece types. We express this using a couple of choice rules, where one depends on the other.</p>
<pre class="language-erlang" tabindex="0"><code class="language-erlang"><span class="token comment">% guess a subset of pieces used</span>
<span class="token punctuation">{</span> <span class="token function">used</span><span class="token punctuation">(</span><span class="token variable">I</span><span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token function">piece_n</span><span class="token punctuation">(</span><span class="token variable">I</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">.</span>

<span class="token comment">% guess a single type for each used piece</span>
<span class="token punctuation">{</span> <span class="token function">piece</span><span class="token punctuation">(</span><span class="token variable">I</span><span class="token punctuation">,</span><span class="token variable">T</span><span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token function">piece_type</span><span class="token punctuation">(</span><span class="token variable">T</span><span class="token punctuation">)</span> <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token number">1</span> <span class="token punctuation">:</span><span class="token operator">-</span> <span class="token function">used</span><span class="token punctuation">(</span><span class="token variable">I</span><span class="token punctuation">)</span><span class="token punctuation">.</span>

<span class="token punctuation">#</span><span class="token atom">show</span> <span class="token atom">piece</span><span class="token operator">/</span><span class="token number">2.</span></code></pre>
<p>Let's try running this with <a href="https://potassco.org/clingo/run/">clingo</a>. We'll generate all answer sets, which is possible because we're still only working with tiny puzzles.</p>
<pre><code>$ clingo puzzle.lp 0 -q
clingo version 5.2.1
Reading from puzzle.lp
Solving...
SATISFIABLE

Models       : 625
Calls        : 1
Time         : 0.002s (Solving: 0.00s 1st Model: 0.00s Unsat: 0.00s)
CPU Time     : 0.002s
</code></pre>
<p>We're getting there, but 625 models is probably too many for only 4 pieces. Looking at the generated answer sets, we see that there are many duplicates. For one, the earlier example appears again, this time represented as:</p>
<pre class="language-erlang" tabindex="0"><code class="language-erlang"><span class="token function">piece</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token atom">a</span><span class="token punctuation">)</span><span class="token punctuation">.</span>
<span class="token function">piece</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token atom">b</span><span class="token punctuation">)</span><span class="token punctuation">.</span>
<span class="token function">piece</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token atom">b</span><span class="token punctuation">)</span><span class="token punctuation">.</span></code></pre>
<p>Yet another occurrence:</p>
<pre class="language-erlang" tabindex="0"><code class="language-erlang"><span class="token function">piece</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token atom">b</span><span class="token punctuation">)</span><span class="token punctuation">.</span>
<span class="token function">piece</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token atom">a</span><span class="token punctuation">)</span><span class="token punctuation">.</span>
<span class="token function">piece</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token atom">b</span><span class="token punctuation">)</span><span class="token punctuation">.</span></code></pre>
<p>We don't really gain anything from having the same handful of pieces represented multiple times, as that skews the distribution of puzzles in difficult-to-predict ways once we start sampling them randomly.</p>
<p>In both examples above, we can see that the two arguments of <code>piece</code> are out of order and not contiguously increasing. That's somewhere we can start: giving pieces a canonical ordering, so it's easier to filter duplicates.</p>
<p>We first define an auxiliary predicate to capture the maximum index used. This is also the number of pieces actually generated.</p>
<pre class="language-erlang" tabindex="0"><code class="language-erlang"><span class="token function">max</span><span class="token punctuation">(</span><span class="token variable">I</span><span class="token punctuation">)</span> <span class="token punctuation">:</span><span class="token operator">-</span> <span class="token punctuation">{</span> <span class="token function">used</span><span class="token punctuation">(</span><span class="token variable">_</span><span class="token punctuation">)</span> <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token variable">I</span><span class="token punctuation">.</span></code></pre>
<p>We then say what it means for the piece indexes to be contiguously increasing with an inductive rule. <code>1</code> is always part of an increasing sequence, and so is <code>N+1</code> if <code>N</code> is <em>and</em> we haven't exceeded the maximum index.</p>
<pre class="language-erlang" tabindex="0"><code class="language-erlang"><span class="token function">increasing</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>
<span class="token function">increasing</span><span class="token punctuation">(</span><span class="token variable">N</span><span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">:</span><span class="token operator">-</span> <span class="token function">increasing</span><span class="token punctuation">(</span><span class="token variable">N</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token variable">N</span> <span class="token operator">&lt;</span> <span class="token variable">I</span><span class="token punctuation">,</span> <span class="token function">max</span><span class="token punctuation">(</span><span class="token variable">I</span><span class="token punctuation">)</span><span class="token punctuation">.</span></code></pre>
<p>Finally, we rule out cases where a piece index is selected, but isn't in an increasing sequence.</p>
<pre class="language-erlang" tabindex="0"><code class="language-erlang"><span class="token punctuation">:</span><span class="token operator">-</span> <span class="token function">used</span><span class="token punctuation">(</span><span class="token variable">I</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">not</span> <span class="token function">increasing</span><span class="token punctuation">(</span><span class="token variable">I</span><span class="token punctuation">)</span><span class="token punctuation">.</span></code></pre>
<p>This brings us down to 341 models. Next, we ensure that pieces are sorted by index and type, by ruling out cases where they appear out of order.</p>
<pre class="language-erlang" tabindex="0"><code class="language-erlang"><span class="token punctuation">:</span><span class="token operator">-</span> <span class="token function">piece</span><span class="token punctuation">(</span><span class="token variable">I1</span><span class="token punctuation">,</span><span class="token variable">V1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">piece</span><span class="token punctuation">(</span><span class="token variable">I2</span><span class="token punctuation">,</span><span class="token variable">V2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token variable">I1</span> <span class="token operator">&lt;</span> <span class="token variable">I2</span><span class="token punctuation">,</span> <span class="token variable">V1</span> <span class="token operator">></span> <span class="token variable">V2</span><span class="token punctuation">.</span></code></pre>
<p>We get 70 models now. A manual look at the answers seems promising, showing no obvious duplicates, but how do we know we're done, i.e. all answer sets are unique?</p>
<p>It turns out that what we're doing -- grabbing a handful of heterogeneous pieces from an infinite bag -- is an instance of <a href="https://en.wikipedia.org/wiki/Combination#Number_of_combinations_with_repetition">combinations with repetition</a>. The number of ways of taking <code>k</code> pieces from a bag of <code>n</code> unique pieces is given by</p>
<div style="display: flex; align-items: center;"><mjx-container class="MathJax" jax="SVG" overflow="overflow" display="true"><svg style="vertical-align: -1.716ex;" xmlns="http://www.w3.org/2000/svg" width="10.163ex" height="4.599ex" role="img" focusable="false" viewBox="0 -1381 4867.9 2203" xmlns:xlink="http://www.w3.org/1999/xlink"><defs><path id="MJX-1-STX-S5-28" d="M68 270C68-209 219-610 416-802L441-779C257-543 166-157 166 270C166 697 257 1083 441 1319L416 1342C219 1150 68 749 68 270Z"></path><path id="MJX-1-STX-I-1D45B" d="M521 112C506 93 481 60 447 60C433 60 428 68 428 79C428 91 430 103 430 103L487 334C490 348 496 382 496 408C496 444 481 479 430 479C312 479 227 334 185 259L177 259L227 476L205 476L66 465L66 438C66 438 86 440 99 440C122 440 131 430 131 413C131 398 128 380 128 380L47 0L129 0L165 158C197 227 307 407 380 407C403 407 410 390 410 367C410 347 403 319 403 319L344 88C343 83 339 65 339 49C339 19 354-10 404-10C476-10 516 60 542 97Z"></path><path id="MJX-1-STX-N-2B" d="M658 225L658 293L396 293L396 558L324 558L324 293L62 293L62 225L324 225L324-40L396-40L396 225Z"></path><path id="MJX-1-STX-I-1D458" d="M256 705L234 705L96 694L96 668C96 668 115 670 127 670C152 670 162 661 162 638C162 625 159 608 159 608L41 0L123 0L158 184L216 235L285 68C300 32 318-10 369-10C446-10 497 83 507 102L486 116C464 85 441 58 407 58C377 58 367 79 353 112L279 284L390 382C423 412 454 440 522 442L525 467L310 467L307 442C331 442 352 437 352 416C352 402 342 391 328 379L172 238L167 238Z"></path><path id="MJX-1-STX-N-2212" d="M658 225L658 293L62 293L62 225Z"></path><path id="MJX-1-STX-N-31" d="M426 0L426 28C334 28 297 46 297 95L297 639L268 639L74 584L74 551C105 561 156 567 176 567C201 567 209 553 209 518L209 95C209 45 174 28 80 28L80 0Z"></path><path id="MJX-1-STX-S5-29" d="M405 270C405 749 254 1150 57 1342L32 1319C216 1083 307 697 307 270C307-157 216-543 32-779L57-802C254-610 405-209 405 270Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math" data-latex="\binom{n+k-1}{k}
"><g data-mml-node="mrow" data-latex="\binom{n+k-1}{k}
"><g data-mml-node="TeXAtom" data-latex="\biggl (" data-mjx-texclass="OPEN"><g data-mml-node="mo" transform="translate(0 -20)"><use data-c="28" xlink:href="#MJX-1-STX-S5-28"></use></g></g><g data-mml-node="mfrac" transform="translate(473,0)"><g data-mml-node="mrow" data-latex="n+k-1" transform="translate(0,676)"><g data-mml-node="mi" data-latex="n"><use data-c="1D45B" xlink:href="#MJX-1-STX-I-1D45B"></use></g><g data-mml-node="mo" data-latex="+" transform="translate(787.2,0)"><use data-c="2B" xlink:href="#MJX-1-STX-N-2B"></use></g><g data-mml-node="mi" data-latex="k" transform="translate(1729.4,0)"><use data-c="1D458" xlink:href="#MJX-1-STX-I-1D458"></use></g><g data-mml-node="mo" data-latex="-" transform="translate(2484.7,0)"><use data-c="2212" xlink:href="#MJX-1-STX-N-2212"></use></g><g data-mml-node="mn" data-latex="1" transform="translate(3426.9,0)"><use data-c="31" xlink:href="#MJX-1-STX-N-31"></use></g></g><g data-mml-node="mi" data-latex="k" transform="translate(1694.4,-686)"><use data-c="1D458" xlink:href="#MJX-1-STX-I-1D458"></use></g></g><g data-mml-node="TeXAtom" data-latex="\biggr )" data-mjx-texclass="CLOSE" transform="translate(4394.9,0)"><g data-mml-node="mo" transform="translate(0 -20)"><use data-c="29" xlink:href="#MJX-1-STX-S5-29"></use></g></g></g></g></g></svg></mjx-container></div><p>For the case of 4 pieces, we're sampling one piece, then two, etc. We add one for the case where we pick <em>no</em> pieces.</p>
<div style="display: flex; align-items: center;"><mjx-container class="MathJax" jax="SVG" overflow="overflow" display="true"><svg style="vertical-align: -1.716ex;" xmlns="http://www.w3.org/2000/svg" width="27.521ex" height="4.476ex" role="img" focusable="false" viewBox="0 -1322 13182.3 2144" xmlns:xlink="http://www.w3.org/1999/xlink"><defs><path id="MJX-2-STX-S5-28" d="M68 270C68-209 219-610 416-802L441-779C257-543 166-157 166 270C166 697 257 1083 441 1319L416 1342C219 1150 68 749 68 270Z"></path><path id="MJX-2-STX-N-37" d="M464 599L464 630L82 630L42 477L73 474C100 539 108 549 164 549L387 549L151-8L230-8Z"></path><path id="MJX-2-STX-N-34" d="M481 158L481 227L379 227L379 645L318 645L13 221L13 158L290 158L290 0L379 0L379 158M290 227L68 227L68 231L286 536L290 536Z"></path><path id="MJX-2-STX-S5-29" d="M405 270C405 749 254 1150 57 1342L32 1319C216 1083 307 697 307 270C307-157 216-543 32-779L57-802C254-610 405-209 405 270Z"></path><path id="MJX-2-STX-N-2B" d="M658 225L658 293L396 293L396 558L324 558L324 293L62 293L62 225L324 225L324-40L396-40L396 225Z"></path><path id="MJX-2-STX-N-36" d="M415 646C200 637 45 498 45 257C45 110 110-12 259-12C385-12 457 67 457 203C457 334 386 413 277 413C225 413 188 391 147 351L140 352C165 498 277 596 417 617M370 195C370 68 330 23 263 23C176 23 135 112 135 236C135 323 189 355 247 355C330 355 370 285 370 195Z"></path><path id="MJX-2-STX-N-33" d="M86 498C120 551 157 579 217 579C279 579 319 545 319 486C319 405 248 350 180 350L161 350L161 312L181 312C277 312 362 253 362 164C362 66 301 37 238 37C214 37 200 41 157 63C122 81 114 86 98 86C72 86 59 63 59 42C59 16 81-13 171-13C317-13 444 57 444 194C444 283 377 336 297 361L297 364C360 404 405 441 405 510C405 586 346 644 244 644C162 644 100 598 63 511Z"></path><path id="MJX-2-STX-N-35" d="M417 549L433 630L159 630L97 369L109 354C123 354 128 354 154 352C292 345 370 304 370 179C370 75 307 37 236 37C172 37 139 86 99 86C74 86 59 66 59 43C59 6 97-13 174-13C333-13 443 65 443 219C443 376 320 423 202 432L155 435L182 549Z"></path><path id="MJX-2-STX-N-32" d="M464 160L435 160C412 100 399 79 346 79L207 79L137 76L137 81L269 206C375 313 432 382 432 471C432 576 353 644 240 644C143 644 75 588 44 491L68 481C105 556 149 579 214 579C291 579 339 531 339 456C339 351 289 288 190 186L38 34L38 0L432 0Z"></path><path id="MJX-2-STX-N-31" d="M426 0L426 28C334 28 297 46 297 95L297 639L268 639L74 584L74 551C105 561 156 567 176 567C201 567 209 553 209 518L209 95C209 45 174 28 80 28L80 0Z"></path><path id="MJX-2-STX-N-3D" d="M658 327L658 395L62 395L62 327M658 123L658 190L62 190L62 123Z"></path><path id="MJX-2-STX-N-30" d="M468 317C468 523 378 642 249 642C104 642 27 510 27 320C27 143 86-11 247-11C404-11 468 146 468 317M371 311C371 119 326 25 247 25C167 25 123 121 123 315C123 513 167 608 246 608C328 608 371 514 371 311Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math" data-latex="\binom{7}{4}+\binom{6}{3}+\binom{5}{2}+\binom{4}{1}+1=70
"><g data-mml-node="mrow" data-latex="\binom{7}{4}"><g data-mml-node="TeXAtom" data-latex="\biggl (" data-mjx-texclass="OPEN"><g data-mml-node="mo" transform="translate(0 -20)"><use data-c="28" xlink:href="#MJX-2-STX-S5-28"></use></g></g><g data-mml-node="mfrac" transform="translate(473,0)"><g data-mml-node="mn" data-latex="7" transform="translate(0,676)"><use data-c="37" xlink:href="#MJX-2-STX-N-37"></use></g><g data-mml-node="mn" data-latex="4" transform="translate(0,-686)"><use data-c="34" xlink:href="#MJX-2-STX-N-34"></use></g></g><g data-mml-node="TeXAtom" data-latex="\biggr )" data-mjx-texclass="CLOSE" transform="translate(968,0)"><g data-mml-node="mo" transform="translate(0 -20)"><use data-c="29" xlink:href="#MJX-2-STX-S5-29"></use></g></g></g><g data-mml-node="mo" data-latex="+" transform="translate(1663.2,0)"><use data-c="2B" xlink:href="#MJX-2-STX-N-2B"></use></g><g data-mml-node="mrow" data-latex="\binom{6}{3}" transform="translate(2605.4,0)"><g data-mml-node="TeXAtom" data-latex="\biggl (" data-mjx-texclass="OPEN"><g data-mml-node="mo" transform="translate(0 -20)"><use data-c="28" xlink:href="#MJX-2-STX-S5-28"></use></g></g><g data-mml-node="mfrac" transform="translate(473,0)"><g data-mml-node="mn" data-latex="6" transform="translate(0,676)"><use data-c="36" xlink:href="#MJX-2-STX-N-36"></use></g><g data-mml-node="mn" data-latex="3" transform="translate(0,-686)"><use data-c="33" xlink:href="#MJX-2-STX-N-33"></use></g></g><g data-mml-node="TeXAtom" data-latex="\biggr )" data-mjx-texclass="CLOSE" transform="translate(968,0)"><g data-mml-node="mo" transform="translate(0 -20)"><use data-c="29" xlink:href="#MJX-2-STX-S5-29"></use></g></g></g><g data-mml-node="mo" data-latex="+" transform="translate(4268.7,0)"><use data-c="2B" xlink:href="#MJX-2-STX-N-2B"></use></g><g data-mml-node="mrow" data-latex="\binom{5}{2}" transform="translate(5210.9,0)"><g data-mml-node="TeXAtom" data-latex="\biggl (" data-mjx-texclass="OPEN"><g data-mml-node="mo" transform="translate(0 -20)"><use data-c="28" xlink:href="#MJX-2-STX-S5-28"></use></g></g><g data-mml-node="mfrac" transform="translate(473,0)"><g data-mml-node="mn" data-latex="5" transform="translate(0,676)"><use data-c="35" xlink:href="#MJX-2-STX-N-35"></use></g><g data-mml-node="mn" data-latex="2" transform="translate(0,-686)"><use data-c="32" xlink:href="#MJX-2-STX-N-32"></use></g></g><g data-mml-node="TeXAtom" data-latex="\biggr )" data-mjx-texclass="CLOSE" transform="translate(968,0)"><g data-mml-node="mo" transform="translate(0 -20)"><use data-c="29" xlink:href="#MJX-2-STX-S5-29"></use></g></g></g><g data-mml-node="mo" data-latex="+" transform="translate(6874.1,0)"><use data-c="2B" xlink:href="#MJX-2-STX-N-2B"></use></g><g data-mml-node="mrow" data-latex="\binom{4}{1}" transform="translate(7816.3,0)"><g data-mml-node="TeXAtom" data-latex="\biggl (" data-mjx-texclass="OPEN"><g data-mml-node="mo" transform="translate(0 -20)"><use data-c="28" xlink:href="#MJX-2-STX-S5-28"></use></g></g><g data-mml-node="mfrac" transform="translate(473,0)"><g data-mml-node="mn" data-latex="4" transform="translate(0,676)"><use data-c="34" xlink:href="#MJX-2-STX-N-34"></use></g><g data-mml-node="mn" data-latex="1" transform="translate(0,-686)"><use data-c="31" xlink:href="#MJX-2-STX-N-31"></use></g></g><g data-mml-node="TeXAtom" data-latex="\biggr )" data-mjx-texclass="CLOSE" transform="translate(968,0)"><g data-mml-node="mo" transform="translate(0 -20)"><use data-c="29" xlink:href="#MJX-2-STX-S5-29"></use></g></g></g><g data-mml-node="mo" data-latex="+" transform="translate(9479.6,0)"><use data-c="2B" xlink:href="#MJX-2-STX-N-2B"></use></g><g data-mml-node="mn" data-latex="1" transform="translate(10421.8,0)"><use data-c="31" xlink:href="#MJX-2-STX-N-31"></use></g><g data-mml-node="mo" data-latex="=" transform="translate(11194.6,0)"><use data-c="3D" xlink:href="#MJX-2-STX-N-3D"></use></g><g data-mml-node="mn" data-latex="0" transform="translate(12192.3,0)"><use data-c="37" xlink:href="#MJX-2-STX-N-37"></use><use data-c="30" xlink:href="#MJX-2-STX-N-30" transform="translate(495,0)"></use></g></g></g></svg></mjx-container></div><p>Success!</p>

</div>

		</main>

		<footer>
			
		</footer>

		<!-- This page `/blog/asp-puzzle-pieces/` was built on 2025-10-29T09:40:23.873Z -->
		
	</body>
</html>
