<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, shrink-to-fit=no">

		<meta property="og:title" content="Darius Foo">
		<meta property="og:type" content="article">
		<meta property="og:url" content="https://dariusf.github.io">
		<meta property="og:image" content="https://dariusf.github.io/avatar.png">

		<title>Bags of puzzle pieces in ASP</title>
		<meta name="description" content="PhD student, programming languages and formal verification">
		<link rel="alternate" href="/feed/feed.xml" type="application/atom+xml" title="Darius Foo">


		

		

		

		

		
		
		<style>@media (prefers-color-scheme: light) { /**
 * prism.js default theme for JavaScript, CSS and HTML
 * Based on dabblet (http://dabblet.com)
 * @author Lea Verou
 */

code[class*="language-"],
pre[class*="language-"] {
	color: black;
	background: none;
	text-shadow: 0 1px white;
	font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
	font-size: 1em;
	text-align: left;
	white-space: pre;
	word-spacing: normal;
	word-break: normal;
	word-wrap: normal;
	line-height: 1.5;

	-moz-tab-size: 4;
	-o-tab-size: 4;
	tab-size: 4;

	-webkit-hyphens: none;
	-moz-hyphens: none;
	-ms-hyphens: none;
	hyphens: none;
}

pre[class*="language-"]::-moz-selection, pre[class*="language-"] ::-moz-selection,
code[class*="language-"]::-moz-selection, code[class*="language-"] ::-moz-selection {
	text-shadow: none;
	background: #b3d4fc;
}

pre[class*="language-"]::selection, pre[class*="language-"] ::selection,
code[class*="language-"]::selection, code[class*="language-"] ::selection {
	text-shadow: none;
	background: #b3d4fc;
}

@media print {
	code[class*="language-"],
	pre[class*="language-"] {
		text-shadow: none;
	}
}

/* Code blocks */
pre[class*="language-"] {
	padding: 1em;
	margin: .5em 0;
	overflow: auto;
}

:not(pre) > code[class*="language-"],
pre[class*="language-"] {
	background: #f5f2f0;
}

/* Inline code */
:not(pre) > code[class*="language-"] {
	padding: .1em;
	border-radius: .3em;
	white-space: normal;
}

.token.comment,
.token.prolog,
.token.doctype,
.token.cdata {
	color: slategray;
}

.token.punctuation {
	color: #999;
}

.token.namespace {
	opacity: .7;
}

.token.property,
.token.tag,
.token.boolean,
.token.number,
.token.constant,
.token.symbol,
.token.deleted {
	color: #905;
}

.token.selector,
.token.attr-name,
.token.string,
.token.char,
.token.builtin,
.token.inserted {
	color: #690;
}

.token.operator,
.token.entity,
.token.url,
.language-css .token.string,
.style .token.string {
	color: #9a6e3a;
	/* This background color was intended by the author of this theme. */
	background: hsla(0, 0%, 100%, .5);
}

.token.atrule,
.token.attr-value,
.token.keyword {
	color: #07a;
}

.token.function,
.token.class-name {
	color: #DD4A68;
}

.token.regex,
.token.important,
.token.variable {
	color: #e90;
}

.token.important,
.token.bold {
	font-weight: bold;
}
.token.italic {
	font-style: italic;
}

.token.entity {
	cursor: help;
}
 }
@media (prefers-color-scheme: dark) { /**
 * prism.js tomorrow night eighties for JavaScript, CoffeeScript, CSS and HTML
 * Based on https://github.com/chriskempson/tomorrow-theme
 * @author Rose Pritchard
 */

code[class*="language-"],
pre[class*="language-"] {
	color: #ccc;
	background: none;
	font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
	font-size: 1em;
	text-align: left;
	white-space: pre;
	word-spacing: normal;
	word-break: normal;
	word-wrap: normal;
	line-height: 1.5;

	-moz-tab-size: 4;
	-o-tab-size: 4;
	tab-size: 4;

	-webkit-hyphens: none;
	-moz-hyphens: none;
	-ms-hyphens: none;
	hyphens: none;

}

/* Code blocks */
pre[class*="language-"] {
	padding: 1em;
	margin: .5em 0;
	overflow: auto;
}

:not(pre) > code[class*="language-"],
pre[class*="language-"] {
	background: #2d2d2d;
}

/* Inline code */
:not(pre) > code[class*="language-"] {
	padding: .1em;
	border-radius: .3em;
	white-space: normal;
}

.token.comment,
.token.block-comment,
.token.prolog,
.token.doctype,
.token.cdata {
	color: #999;
}

.token.punctuation {
	color: #ccc;
}

.token.tag,
.token.attr-name,
.token.namespace,
.token.deleted {
	color: #e2777a;
}

.token.function-name {
	color: #6196cc;
}

.token.boolean,
.token.number,
.token.function {
	color: #f08d49;
}

.token.property,
.token.class-name,
.token.constant,
.token.symbol {
	color: #f8c555;
}

.token.selector,
.token.important,
.token.atrule,
.token.keyword,
.token.builtin {
	color: #cc99cd;
}

.token.string,
.token.char,
.token.attr-value,
.token.regex,
.token.variable {
	color: #7ec699;
}

.token.operator,
.token.entity,
.token.url {
	color: #67cdcc;
}

.token.important,
.token.bold {
	font-weight: bold;
}
.token.italic {
	font-style: italic;
}

.token.entity {
	cursor: help;
}

.token.inserted {
	color: green;
}
 }
/* This is an arbitrary CSS string added to the bundle */
:root {
	/* --font-family: -apple-system, system-ui, sans-serif; */
	/* --font-family-monospace: Consolas, Menlo, Monaco, Andale Mono WT, Andale Mono, Lucida Console, Lucida Sans Typewriter, DejaVu Sans Mono, Bitstream Vera Sans Mono, Liberation Mono, Nimbus Mono L, Courier New, Courier, monospace;
	*/

    --font-family-monospace: Fira Code, Menlo, Consolas, Monaco, Liberation Mono, Lucida Console, monospace;


  /*    --text-font: Crimson Text, serif;*/
  /*    --text-font: Poppins, Verdana, sans-serif;*/
  /*    --heading-font: Quicksand, sans-serif;*/
  /*    --text-font: Open Sans, sans-serif;*/
  /*    --text-font-size: 16px;*/
  /*    --heading-font: Open Sans, sans-serif;*/
  /*    --text-font: Cabin, sans-serif;*/
  /*    --text-font-size: 16px;*/
  /*    --text-font: Roboto, sans-serif;*/

  /*    --heading-font: Roboto, sans-serif;*/
  /*    --heading-font: Cabin, sans-serif;*/
  /*    --heading-font: Dosis, sans-serif;*/

  /*    --heading-font: Work Sans, sans-serif;*/
  /*    --text-font: Open Sans, sans-serif;*/

      /* --heading-font: Nunito, sans-serif; */
      --heading-font: ui-rounded, 'Hiragino Maru Gothic ProN', Quicksand, Comfortaa, Manjari, 'Arial Rounded MT', 'Arial Rounded MT Bold', Calibri, source-sans-pro, sans-serif;
  /*    --text-font: PT Sans, sans-serif;*/

  /*    --heading-font: Varela Round, sans-serif;*/
  /*    --text-font: Noto Serif, serif;*/

  /*    --text-font: Lato, sans-serif;*/
      --text-font-size: 17px;

  /*    --text-font: Merriweather, sans-serif;*/
  /*    --text-font-size: 16px;*/

  /* https://css-tricks.com/snippets/css/system-font-stack/ */
  /* https://systemfontstack.com/ */

    /* system font on all platforms */
  /*    --heading-font: -apple-system, system-ui, BlinkMacSystemFont, "Segoe UI", Roboto, Ubuntu;*/
      /* --text-font: -apple-system, system-ui, BlinkMacSystemFont, "Segoe UI", Roboto, Ubuntu; */
      --text-font: -apple-system, system-ui, sans-serif;
			/* system-ui, sans-serif; */


/* Theme colors */

	/* --color-gray-20: #e0e0e0;
	--color-gray-50: #C0C0C0;
	--color-gray-90: #333; */

	--background-color: #fff;

	/* --text-color: var(--color-gray-90); */
	/* --text-color-link: #082840; */

	/* --text-color-link: #ff0000; */
	/* --text-color-link-active: #5f2b48; */
	/* --text-color-link-visited: #17050F; */


	/* --syntax-tab-size: 2; */

	--bright-text-color: #222;
	--link-color: #3273dc;
	/* --link-color: #ff5e6c; */
	--link-visited-color: #6e4bbe;
	--background-color: #fff;
	--text-color: #444;
	--faded-text-color: #777;
	--blockquote-text-color: var(--bright-text-color);
	--faint-color: #ccc;
}

@media (prefers-color-scheme: dark) {
	:root {
		/* --color-gray-20: #e0e0e0; */
		/* --color-gray-50: #C0C0C0; */
		/* --color-gray-90: #dad8d8; */

		/* --text-color is assigned to --color-gray-_ above */
		/* --text-color-link: #1493fb; */
		/* --text-color-link-active: #6969f7; */
		/* --text-color-link-visited: #a6a6f8; */

		--background-color: #15202b;

		--bright-text-color: #eee;
		--link-color: #8cc2dd;
		--link-visited-color: #b9a9e0;
		--background-color: #333;
		--text-color: #ddd;
		--faded-text-color: #aaa;
		--slightly-dimmer-text-color: #ccc;
		--blockquote-text-color: var(--slightly-dimmer-text-color);
		--faint-color: #666;

		color-scheme: dark; /* sets scrollbar colour */
	}

	.theme-affected {
		filter: invert(.8);
	}
}

body {
	box-sizing: border-box;

	/* https://github.com/sindresorhus/github-markdown-css */
	min-width: 200px;
	/* max from old blog */
	/* max-width: 40em; */
	/* tiny bit wider because prism adds some padding */
	max-width: 726px;

	margin: 0 auto;
	padding: 0 20px;

	/* enable ligatures */
	text-rendering: optimizeLegibility;

	font-family: var(--text-font);
	font-size: var(--text-font-size);
	color: var(--text-color);
	background-color: var(--background-color);

	/*
	text-align: left;
	word-wrap: break-word;
	overflow-wrap: break-word;
	*/
	/* line-height: 1.5; */
}

@media (max-width: 767px) {
	body {
		padding: 0px 1em;
	}
}

@view-transition {
	navigation: auto;
}

html {
	overflow-y: scroll;
}

/* https://github.com/Kimeiga/bahunya/blob/master/src/parts/_typography.css */
ul, ol {
  padding-left: 2em;
}

li {
	line-height: 1.5;
}

h1, h2, h3, h4, h5, h6 {
	font-family: var(--heading-font);
	color: var(--bright-text-color);
	font-weight: normal;
	line-height: 1.25;
}

footer {
	padding: 35px;
}

/* header {
	border-bottom: 1px dashed var(--color-gray-20);
} */


/* misc changes from here on */

/* https://www.a11yproject.com/posts/how-to-hide-content/ */
.visually-hidden {
	clip: rect(0 0 0 0);
	clip-path: inset(50%);
	height: 1px;
	overflow: hidden;
	position: absolute;
	white-space: nowrap;
	width: 1px;
}

p:has(img) {
	text-align: center;
}
/* Fluid images via https://www.zachleat.com/web/fluid-images/ */
img{
  max-width: 100%;
}
img[width][height] {
  height: auto;
}
/* img[src$=".svg"] {
  width: 100%;
  height: auto;
  max-width: none;
} */
video,
iframe {
	width: 100%;
	height: auto;
}
iframe {
	aspect-ratio: 16/9;
}

p:last-child {
	margin-bottom: 0;
}
p {
	line-height: 1.5;
}

a[href] {
	color: var(--link-color);
	text-decoration: none;
}

/* a[href]:visited {
	color: var(--link-visited-color);
} */

/* a[href]:hover,
a[href]:active { */
	/* color: var(--text-color-link-active); */
	/* text-decoration: underline; */
	/* text-decoration-thickness: 2px; */
/* } */

/* main :first-child {
	margin-top: 0;
} */

/* .links-nextprev {
	display: flex;
	justify-content: space-between;
	gap: .5em 1em;
	list-style: "";
	border-top: 1px dashed var(--color-gray-20);
	padding: 1em 0;
}
.links-nextprev > * {
	flex-grow: 1;
}
.links-nextprev-next {
	text-align: right;
} */

table {
	margin: 1em 0;
	border-collapse: collapse;
}
table td,
table th {
	padding-right: 1em;
}
/* table thead tr th {
  border-bottom: solid var(--text-color) 2px;
  border-top: solid var(--text-color) 2px;
} */

.table-lines td {
  border-bottom: solid var(--text-color) 1px;
  border-top: solid var(--text-color) 1px;
}

/* pre,
code {
	font-family: var(--font-family-monospace) !important;
	font-size: 14px !important;
} */

/* override prism */
/* https://github.com/orgs/PrismJS/discussions/2859 */
code[class*="language-"],
pre[class*="language-"] {
	font-family: var(--font-family-monospace);
	font-size: 14px;
}

pre[class*="language-"] {
	margin-top: 0;
	margin-bottom: 1em;
}

pre:not([class*="language-"]) {
	margin: .5em 0;
	line-height: 1.375; /* 22px /16 */
	/* -moz-tab-size: var(--syntax-tab-size); */
	/* -o-tab-size: var(--syntax-tab-size); */
	/* tab-size: var(--syntax-tab-size); */
	-webkit-hyphens: none;
	-ms-hyphens: none;
	hyphens: none;
	direction: ltr;
	text-align: left;
	white-space: pre;
	word-spacing: normal;
	word-break: normal;
	overflow-x: auto;
}

.scroll-when-overflowing, pre {
	overflow-x: scroll;
  -ms-overflow-style: none;  /* IE and Edge */
  scrollbar-width: none;  /* Firefox */
}

.scroll-when-overflowing::-webkit-scrollbar, pre::-webkit-scrollbar {
  display: none;
}

/* mathjax v4, where display math is not centered */
mjx-container {
	margin: auto;
}
header {
			/* display: flex; */
			/* gap: 2em; */
			border-right: 10px;
			/* flex-wrap: wrap; */
			/* justify-content: space-between; */
			/* align-items: center; */
			align-items: end;
			padding-top: 1em;
			/* padding: 1em; */
		}
.nav-item {
				font-family: var(--heading-font);
				padding-right: 5px;
				display: inline-block;
			}
			
			.nav-item a[href][aria-current="page"] {
				text-decoration: underline;
				text-decoration-thickness: 2px;
			}</style>
	</head>
	<body>
		<a href="#skip" class="visually-hidden">Skip to main content</a>

		

		<header>

			
			
			
			<a href="/" style="padding-right: 10px; color: var(--text-color); font-family: var(--heading-font); font-size: 1.5em;">Darius Foo</a>
			
				
				
				
				
				
				
			
			
			<nav style="display: inline-block">
				<h2 class="visually-hidden" id="top-level-navigation-menu">Top level navigation menu</h2>
				<ul style="list-style: none; padding: 0; margin: 0;">
					<li class="nav-item"><a href="/blog/">Blog</a></li>
					<li class="nav-item"><a href="/research/">Research</a></li>
					<li class="nav-item"><a href="/work/">Work</a></li>
					<li class="nav-item"><a href="/games/">Games</a></li>
				</ul>
			</nav>
		</header>

		<main id="skip">
			

<h1 style="margin-top: 1rem; margin-bottom: 0.2em" id="bags-of-puzzle-pieces-in-asp">Bags of puzzle pieces in ASP</h1>



<div class="post-metadata">
	
	<time style="font-size: 0.9em;" datetime="2017-11-25">25 Nov 2017</time>
	
	
</div>

<div class="blog-content">
<p>Answer set programming is an offshoot of traditional logic programming with a number of nice properties: programs always terminate, are fully declarative (i.e. clause ordering doesn't matter and search is complete, unlike Prolog), and have a <a href="https://en.wikipedia.org/wiki/Stable_model_semantics">well-defined semantics</a>. Modelling a domain with relations is a wonderfully high-level way to reason about things, allowing complex rules to be represented <a href="https://en.wikipedia.org/wiki/Answer_set_programming#Examples_of_ASP_programs">concisely</a>.</p>
<p>ASP is typically applied to hard search problems, but can model pretty much anything. One area it's popular in is game design, particularly for <a href="https://adamsmith.as/papers/tciaig-asp4pcg.pdf">procedural content generation</a>: if we can write down the rules of, say, a puzzle game, we can straightforwardly sample valid puzzles (or even <a href="https://adamsmith.as/papers/fdg2013_shortcuts.pdf">solutions to puzzles</a>) with desirable properties.</p>
<p>Here, we'll explore one way of sampling puzzle pieces: given an infinite bag of heterogeneous pieces, we want to grab a <em>handful</em>, put them on the game board, then rule out the worlds where the pieces don't form a valid puzzle.</p>
<p>Incidentally, this is how one typically approaches problems with ASP: defining the <em>entire</em> problem space and how to prune it down to the interesting bits.</p>
<p>By a <em>handful</em>, we intuitively mean <em>some</em> quantity of pieces with <em>some</em> types. For example, we might generate <a href="https://en.wikipedia.org/wiki/Pipe_Mania">Pipe Mania</a> or <a href="https://en.wikipedia.org/wiki/Rush_Hour_(puzzle)">Rush Hour</a> boards such that we get a puzzle of appropriate size or difficulty.</p>
<p>Generally, the number of piece types is finite and much smaller than the size of the game board, so we'll want to allow duplicate pieces. We'll represent pieces very abstractly, indexed by an identifier and piece type.</p>
<pre class="language-erlang" tabindex="0"><code class="language-erlang"><span class="token function">piece</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token atom">a</span><span class="token punctuation">)</span><span class="token punctuation">.</span></code></pre>
<p>We'll start with 4 piece types, and an upper limit on the maximum number of pieces we want per puzzle -- ASP programs must terminate, so domains must be finite.</p>
<pre class="language-erlang" tabindex="0"><code class="language-erlang"><span class="token punctuation">#</span><span class="token atom">const</span> <span class="token atom">max_n</span><span class="token operator">=</span><span class="token number">4.</span>

<span class="token function">piece_type</span><span class="token punctuation">(</span><span class="token atom">a</span><span class="token punctuation">;</span><span class="token atom">b</span><span class="token punctuation">;</span><span class="token atom">c</span><span class="token punctuation">;</span><span class="token atom">d</span><span class="token punctuation">)</span><span class="token punctuation">.</span>
<span class="token function">piece_n</span><span class="token punctuation">(</span><span class="token number">1.</span><span class="token punctuation">.</span><span class="token atom">max_n</span><span class="token punctuation">)</span><span class="token punctuation">.</span></code></pre>
<p>Two pieces of type <code>b</code> and one piece of type <code>a</code> might be represented as follows.</p>
<pre class="language-erlang" tabindex="0"><code class="language-erlang"><span class="token function">piece</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token atom">a</span><span class="token punctuation">)</span><span class="token punctuation">.</span>
<span class="token function">piece</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token atom">b</span><span class="token punctuation">)</span><span class="token punctuation">.</span>
<span class="token function">piece</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token atom">b</span><span class="token punctuation">)</span><span class="token punctuation">.</span></code></pre>
<p>Now to get our handful of pieces. There are two quantities to vary: the number of pieces and the piece types. We express this using a couple of choice rules, where one depends on the other.</p>
<pre class="language-erlang" tabindex="0"><code class="language-erlang"><span class="token comment">% guess a subset of pieces used</span>
<span class="token punctuation">{</span> <span class="token function">used</span><span class="token punctuation">(</span><span class="token variable">I</span><span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token function">piece_n</span><span class="token punctuation">(</span><span class="token variable">I</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">.</span>

<span class="token comment">% guess a single type for each used piece</span>
<span class="token punctuation">{</span> <span class="token function">piece</span><span class="token punctuation">(</span><span class="token variable">I</span><span class="token punctuation">,</span><span class="token variable">T</span><span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token function">piece_type</span><span class="token punctuation">(</span><span class="token variable">T</span><span class="token punctuation">)</span> <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token number">1</span> <span class="token punctuation">:</span><span class="token operator">-</span> <span class="token function">used</span><span class="token punctuation">(</span><span class="token variable">I</span><span class="token punctuation">)</span><span class="token punctuation">.</span>

<span class="token punctuation">#</span><span class="token atom">show</span> <span class="token atom">piece</span><span class="token operator">/</span><span class="token number">2.</span></code></pre>
<p>Let's try running this with <a href="https://potassco.org/clingo/run/">clingo</a>. We'll generate all answer sets, which is possible because we're still only working with tiny puzzles.</p>
<pre><code>$ clingo puzzle.lp 0 -q
clingo version 5.2.1
Reading from puzzle.lp
Solving...
SATISFIABLE

Models       : 625
Calls        : 1
Time         : 0.002s (Solving: 0.00s 1st Model: 0.00s Unsat: 0.00s)
CPU Time     : 0.002s
</code></pre>
<p>We're getting there, but 625 models is probably too many for only 4 pieces. Looking at the generated answer sets, we see that there are many duplicates. For one, the earlier example appears again, this time represented as:</p>
<pre class="language-erlang" tabindex="0"><code class="language-erlang"><span class="token function">piece</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token atom">a</span><span class="token punctuation">)</span><span class="token punctuation">.</span>
<span class="token function">piece</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token atom">b</span><span class="token punctuation">)</span><span class="token punctuation">.</span>
<span class="token function">piece</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token atom">b</span><span class="token punctuation">)</span><span class="token punctuation">.</span></code></pre>
<p>Yet another occurrence:</p>
<pre class="language-erlang" tabindex="0"><code class="language-erlang"><span class="token function">piece</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token atom">b</span><span class="token punctuation">)</span><span class="token punctuation">.</span>
<span class="token function">piece</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token atom">a</span><span class="token punctuation">)</span><span class="token punctuation">.</span>
<span class="token function">piece</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token atom">b</span><span class="token punctuation">)</span><span class="token punctuation">.</span></code></pre>
<p>We don't really gain anything from having the same handful of pieces represented multiple times, as that skews the distribution of puzzles in difficult-to-predict ways once we start sampling them randomly.</p>
<p>In both examples above, we can see that the two arguments of <code>piece</code> are out of order and not contiguously increasing. That's somewhere we can start: giving pieces a canonical ordering, so it's easier to filter duplicates.</p>
<p>We first define an auxiliary predicate to capture the maximum index used. This is also the number of pieces actually generated.</p>
<pre class="language-erlang" tabindex="0"><code class="language-erlang"><span class="token function">max</span><span class="token punctuation">(</span><span class="token variable">I</span><span class="token punctuation">)</span> <span class="token punctuation">:</span><span class="token operator">-</span> <span class="token punctuation">{</span> <span class="token function">used</span><span class="token punctuation">(</span><span class="token variable">_</span><span class="token punctuation">)</span> <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token variable">I</span><span class="token punctuation">.</span></code></pre>
<p>We then say what it means for the piece indexes to be contiguously increasing with an inductive rule. <code>1</code> is always part of an increasing sequence, and so is <code>N+1</code> if <code>N</code> is <em>and</em> we haven't exceeded the maximum index.</p>
<pre class="language-erlang" tabindex="0"><code class="language-erlang"><span class="token function">increasing</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>
<span class="token function">increasing</span><span class="token punctuation">(</span><span class="token variable">N</span><span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">:</span><span class="token operator">-</span> <span class="token function">increasing</span><span class="token punctuation">(</span><span class="token variable">N</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token variable">N</span> <span class="token operator">&lt;</span> <span class="token variable">I</span><span class="token punctuation">,</span> <span class="token function">max</span><span class="token punctuation">(</span><span class="token variable">I</span><span class="token punctuation">)</span><span class="token punctuation">.</span></code></pre>
<p>Finally, we rule out cases where a piece index is selected, but isn't in an increasing sequence.</p>
<pre class="language-erlang" tabindex="0"><code class="language-erlang"><span class="token punctuation">:</span><span class="token operator">-</span> <span class="token function">used</span><span class="token punctuation">(</span><span class="token variable">I</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">not</span> <span class="token function">increasing</span><span class="token punctuation">(</span><span class="token variable">I</span><span class="token punctuation">)</span><span class="token punctuation">.</span></code></pre>
<p>This brings us down to 341 models. Next, we ensure that pieces are sorted by index and type, by ruling out cases where they appear out of order.</p>
<pre class="language-erlang" tabindex="0"><code class="language-erlang"><span class="token punctuation">:</span><span class="token operator">-</span> <span class="token function">piece</span><span class="token punctuation">(</span><span class="token variable">I1</span><span class="token punctuation">,</span><span class="token variable">V1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">piece</span><span class="token punctuation">(</span><span class="token variable">I2</span><span class="token punctuation">,</span><span class="token variable">V2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token variable">I1</span> <span class="token operator">&lt;</span> <span class="token variable">I2</span><span class="token punctuation">,</span> <span class="token variable">V1</span> <span class="token operator">></span> <span class="token variable">V2</span><span class="token punctuation">.</span></code></pre>
<p>We get 70 models now. A manual look at the answers seems promising, showing no obvious duplicates, but how do we know we're done, i.e. all answer sets are unique?</p>
<p>It turns out that what we're doing -- grabbing a handful of heterogeneous pieces from an infinite bag -- is an instance of <a href="https://en.wikipedia.org/wiki/Combination#Number_of_combinations_with_repetition">combinations with repetition</a>. The number of ways of taking <code>k</code> pieces from a bag of <code>n</code> unique pieces is given by</p>
[object Promise]<p>For the case of 4 pieces, we're sampling one piece, then two, etc. We add one for the case where we pick <em>no</em> pieces.</p>
[object Promise]<p>Success!</p>

</div>

		</main>

		<footer>
			
		</footer>

		<!-- This page `/blog/asp-puzzle-pieces/` was built on 2025-12-06T06:57:03.498Z -->
		
	</body>
</html>
