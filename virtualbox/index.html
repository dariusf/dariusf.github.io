<!doctype html><html lang=en-us><head><meta http-equiv=x-clacks-overhead content="GNU Terry Pratchett"><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><link rel="shortcut icon" href=https://dariusf.github.io/images/favicon.png><title>From Docker to VirtualBox | Darius Foo</title><meta name=title content="From Docker to VirtualBox"><meta name=description content="Docker is great for quickly dropping into a Linux environment, but isn't compatible with certain obscure use cases (mine being testing version-locked Java GUIs).
After a period of unsuccessfully installing random packages and toggling flags, I figured the next-easiest thing to do was to use VirtualBox. Perhaps surprisingly, it comes with an able CLI. Here's how it compares to Docker's.
Getting Started brew install --cask virtualbox There's no equivalent of docker run -it to start a VM and give me a shell; we'll have to use ssh."><meta name=keywords content><meta property="og:title" content="From Docker to VirtualBox"><meta property="og:description" content="Docker is great for quickly dropping into a Linux environment, but isn't compatible with certain obscure use cases (mine being testing version-locked Java GUIs).
After a period of unsuccessfully installing random packages and toggling flags, I figured the next-easiest thing to do was to use VirtualBox. Perhaps surprisingly, it comes with an able CLI. Here's how it compares to Docker's.
Getting Started brew install --cask virtualbox There's no equivalent of docker run -it to start a VM and give me a shell; we'll have to use ssh."><meta property="og:type" content="article"><meta property="og:url" content="https://dariusf.github.io/virtualbox/"><meta property="og:image" content="https://dariusf.github.io/images/favicon.png"><meta property="article:section" content="blog"><meta property="article:published_time" content="2021-09-13T11:07:06+08:00"><meta property="article:modified_time" content="2021-09-13T11:07:06+08:00"><meta property="og:site_name" content="Darius Foo"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://dariusf.github.io/images/favicon.png"><meta name=twitter:title content="From Docker to VirtualBox"><meta name=twitter:description content="Docker is great for quickly dropping into a Linux environment, but isn't compatible with certain obscure use cases (mine being testing version-locked Java GUIs).
After a period of unsuccessfully installing random packages and toggling flags, I figured the next-easiest thing to do was to use VirtualBox. Perhaps surprisingly, it comes with an able CLI. Here's how it compares to Docker's.
Getting Started brew install --cask virtualbox There's no equivalent of docker run -it to start a VM and give me a shell; we'll have to use ssh."><meta itemprop=name content="From Docker to VirtualBox"><meta itemprop=description content="Docker is great for quickly dropping into a Linux environment, but isn't compatible with certain obscure use cases (mine being testing version-locked Java GUIs).
After a period of unsuccessfully installing random packages and toggling flags, I figured the next-easiest thing to do was to use VirtualBox. Perhaps surprisingly, it comes with an able CLI. Here's how it compares to Docker's.
Getting Started brew install --cask virtualbox There's no equivalent of docker run -it to start a VM and give me a shell; we'll have to use ssh."><meta itemprop=datePublished content="2021-09-13T11:07:06+08:00"><meta itemprop=dateModified content="2021-09-13T11:07:06+08:00"><meta itemprop=wordCount content="515"><meta itemprop=image content="https://dariusf.github.io/images/favicon.png"><meta itemprop=keywords content><meta name=referrer content="no-referrer-when-downgrade"><style>@media(prefers-color-scheme:light){:root{--bright-text-color:#222;--link-color:#3273dc;--link-visited-color:#6e4bbe;--background-color:#fff;--text-color:#444;--faded-text-color:#777;--blockquote-text-color:var(--bright-text-color);--faint-color:#ccc}.chroma{background-color:#fff}.chroma .x{}.chroma .err{color:#000}.chroma .lntd{vertical-align:top;padding:0;margin:0;border:0}.chroma .lntable{border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block}.chroma .hl{display:block;width:100%;background-color:#ffc}.chroma .lnt{margin-right:.4em;padding:0 .4em;color:#7f7f7f}.chroma .ln{margin-right:.4em;padding:0 .4em;color:#7f7f7f}.chroma .k{color:#a90d91}.chroma .kc{color:#a90d91}.chroma .kd{color:#a90d91}.chroma .kn{color:#a90d91}.chroma .kp{color:#a90d91}.chroma .kr{color:#a90d91}.chroma .kt{color:#a90d91}.chroma .n{color:#000}.chroma .na{color:#836c28}.chroma .nb{color:#a90d91}.chroma .bp{color:#5b269a}.chroma .nc{color:#3f6e75}.chroma .no{color:#000}.chroma .nd{color:#000}.chroma .ni{color:#000}.chroma .ne{color:#000}.chroma .nf{color:#000}.chroma .fm{color:#000}.chroma .nl{color:#000}.chroma .nn{color:#000}.chroma .nx{color:#000}.chroma .py{color:#000}.chroma .nt{color:#000}.chroma .nv{color:#000}.chroma .vc{color:#000}.chroma .vg{color:#000}.chroma .vi{color:#000}.chroma .vm{color:#000}.chroma .l{color:#1c01ce}.chroma .ld{color:#1c01ce}.chroma .s{color:#c41a16}.chroma .sa{color:#c41a16}.chroma .sb{color:#c41a16}.chroma .sc{color:#2300ce}.chroma .dl{color:#c41a16}.chroma .sd{color:#c41a16}.chroma .s2{color:#c41a16}.chroma .se{color:#c41a16}.chroma .sh{color:#c41a16}.chroma .si{color:#c41a16}.chroma .sx{color:#c41a16}.chroma .sr{color:#c41a16}.chroma .s1{color:#c41a16}.chroma .ss{color:#c41a16}.chroma .m{color:#1c01ce}.chroma .mb{color:#1c01ce}.chroma .mf{color:#1c01ce}.chroma .mh{color:#1c01ce}.chroma .mi{color:#1c01ce}.chroma .il{color:#1c01ce}.chroma .mo{color:#1c01ce}.chroma .o{color:#000}.chroma .ow{color:#000}.chroma .p{}.chroma .c{color:#177500}.chroma .ch{color:#177500}.chroma .cm{color:#177500}.chroma .c1{color:#177500}.chroma .cs{color:#177500}.chroma .cp{color:#633820}.chroma .cpf{color:#633820}.chroma .g{}.chroma .gd{}.chroma .ge{}.chroma .gr{}.chroma .gh{}.chroma .gi{}.chroma .go{}.chroma .gp{}.chroma .gs{}.chroma .gu{}.chroma .gt{}.chroma .gl{}.chroma .w{}}@media(prefers-color-scheme:dark){:root{--bright-text-color:#eee;--link-color:#8cc2dd;--link-visited-color:#b9a9e0;--background-color:#333;--text-color:#ddd;--faded-text-color:#aaa;--slightly-dimmer-text-color:#ccc;--blockquote-text-color:var(--slightly-dimmer-text-color);--faint-color:#666;color-scheme:dark}img.diagram{filter:invert(.8)}.chroma{color:#e2e4e5;background-color:#282a36}.chroma .x{}.chroma .err{color:#ff5c57}.chroma .lntd{vertical-align:top;padding:0;margin:0;border:0}.chroma .lntable{border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block}.chroma .hl{display:block;width:100%;background-color:#ffc}.chroma .lnt{margin-right:.4em;padding:0 .4em;color:#7f7f7f}.chroma .ln{margin-right:.4em;padding:0 .4em;color:#7f7f7f}.chroma .k{color:#ff6ac1}.chroma .kc{color:#ff6ac1}.chroma .kd{color:#ff5c57}.chroma .kn{color:#ff6ac1}.chroma .kp{color:#ff6ac1}.chroma .kr{color:#ff6ac1}.chroma .kt{color:#9aedfe}.chroma .n{}.chroma .na{color:#57c7ff}.chroma .nb{color:#ff5c57}.chroma .bp{}.chroma .nc{color:#f3f99d}.chroma .no{color:#ff9f43}.chroma .nd{color:#ff9f43}.chroma .ni{}.chroma .ne{}.chroma .nf{color:#57c7ff}.chroma .fm{}.chroma .nl{color:#ff5c57}.chroma .nn{}.chroma .nx{}.chroma .py{}.chroma .nt{color:#ff6ac1}.chroma .nv{color:#ff5c57}.chroma .vc{color:#ff5c57}.chroma .vg{color:#ff5c57}.chroma .vi{color:#ff5c57}.chroma .vm{}.chroma .l{}.chroma .ld{}.chroma .s{color:#5af78e}.chroma .sa{color:#5af78e}.chroma .sb{color:#5af78e}.chroma .sc{color:#5af78e}.chroma .dl{color:#5af78e}.chroma .sd{color:#5af78e}.chroma .s2{color:#5af78e}.chroma .se{color:#5af78e}.chroma .sh{color:#5af78e}.chroma .si{color:#5af78e}.chroma .sx{color:#5af78e}.chroma .sr{color:#5af78e}.chroma .s1{color:#5af78e}.chroma .ss{color:#5af78e}.chroma .m{color:#ff9f43}.chroma .mb{color:#ff9f43}.chroma .mf{color:#ff9f43}.chroma .mh{color:#ff9f43}.chroma .mi{color:#ff9f43}.chroma .il{color:#ff9f43}.chroma .mo{color:#ff9f43}.chroma .o{color:#ff6ac1}.chroma .ow{color:#ff6ac1}.chroma .p{}.chroma .c{color:#78787e}.chroma .ch{color:#78787e}.chroma .cm{color:#78787e}.chroma .c1{color:#78787e}.chroma .cs{color:#78787e}.chroma .cp{color:#78787e}.chroma .cpf{color:#78787e}.chroma .g{}.chroma .gd{color:#ff5c57}.chroma .ge{text-decoration:underline}.chroma .gr{color:#ff5c57}.chroma .gh{font-weight:700}.chroma .gi{font-weight:700}.chroma .go{color:#43454f}.chroma .gp{}.chroma .gs{font-style:italic}.chroma .gu{font-weight:700}.chroma .gt{}.chroma .gl{text-decoration:underline}.chroma .w{}}html{overflow-x:hidden;margin-right:calc(-1 * (100vw - 100%))}body{font-family:Verdana,sans-serif;margin:auto;padding:20px;max-width:720px;text-align:left;background-color:var(--background-color);color:var(--text-color);word-wrap:break-word;overflow-wrap:break-word;line-height:1.5}h1,h2,h3,h4,h5,h6,strong,b{color:var(--bright-text-color)}a{color:var(--link-color);text-decoration:none}.title{text-decoration:none;border:0}.title span{font-weight:400}nav a{margin-right:10px}textarea{width:100%;font-size:16px}input{font-size:16px}content{line-height:1.6}table{width:100%}img{max-width:100%}code{padding:2px 5px;font-family:Fira Code,Inconsolata,monospace;font-size:14px}p code{border-radius:4px;border:solid var(--faint-color)1px;margin:2px;padding:3px}pre code{display:block;padding:20px;white-space:pre-wrap}pre{border-radius:10px}blockquote{border-left:1px solid #999;color:var(--blockquote-text-color);padding-left:20px;font-style:italic}footer{padding:25px;text-align:center}.helptext{color:var(--faded-text-color);font-size:small}.deemphasize{color:var(--faded-text-color)}.errorlist{color:#eba613;font-size:small}.menuactive{text-decoration:underline;text-decoration-thickness:2px}ul.blog-posts{list-style-type:none;padding:unset}ul.blog-posts li{display:flex}ul.blog-posts li span{flex:0 0 130px;text-align:right;margin-right:20px}ul.blog-posts li a:visited{color:var(--link-visited-color)}</style></head><body><header><a href=/ class=title><h2>Darius Foo</h2></a><nav><a href=/blog/>Blog</a>
<a href=/research/>Research</a>
<a href=/work/>Work</a>
<a href=/other/>Other</a></nav></header><main><h1>From Docker to VirtualBox</h1><p><time datetime=2021-09-13 pubdate>13 Sep, 2021</time></p><content><p>Docker is great for quickly dropping into a Linux environment, but isn't compatible with certain obscure use cases (mine being testing version-locked Java GUIs).</p><p>After a period of unsuccessfully installing random packages and toggling flags, I figured the next-easiest thing to do was to use VirtualBox.
Perhaps surprisingly, it comes with an able CLI.
Here's how it compares to Docker's.</p><h2 id=getting-started>Getting Started</h2><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>brew install --cask virtualbox
</span></span></code></pre></div><p>There's no equivalent of <code>docker run -it</code> to <em>start a VM and give me a shell</em>; we'll have to use <code>ssh</code>.</p><p>We import the image, the equivalent of <code>docker load</code>. This takes about a minute, for a 4GB image.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>vboxmanage import vm.ova
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># `vm` from now on is the name of our virtual machine, which we can confirm with</span>
</span></span><span class=line><span class=cl>vboxmanage list vms
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># port forward, so we can use ssh. the first port is the host&#39;s</span>
</span></span><span class=line><span class=cl>vboxmanage modifyvm vm --natpf1 <span class=s2>&#34;ssh,tcp,,2222,,22&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># power it on</span>
</span></span><span class=line><span class=cl>vboxmanage startvm vm
</span></span><span class=line><span class=cl>vboxmanage startvm vm --type headless
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># now it appears here</span>
</span></span><span class=line><span class=cl>vboxmanage list runningvms
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># wait for the VM to start, then</span>
</span></span><span class=line><span class=cl>ssh -p <span class=m>2222</span> user@127.0.0.1
</span></span></code></pre></div><p>At this point we can interactively get the VM into the state we want, or write a script to automate it. The subcommand for the latter is <code>guestcontrol</code>, similar to <code>docker exec</code>.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>vboxmanage guestcontrol vm run /bin/sh --username user --password pass --verbose --wait-stdout --wait-stderr -- -c <span class=s2>&#34;echo test&#34;</span>
</span></span></code></pre></div><p>The docs say that stdin is forwarded, but it seems signals aren't, so I couldn't get a piped shell script to run. We can work around that somewhat with the <code>guestcontrol copyto</code> subcommand.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>vboxmanage guestcontrol vm copyto --verbose --username user --password pass host-dir --target-directory /home/vm
</span></span></code></pre></div><p>When we're done, we'll want to power the VM off, export the new state back to an ova file if necessary, then delete it.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>vboxmanage controlvm vm poweroff
</span></span><span class=line><span class=cl>vboxmanage <span class=nb>export</span> vm -o vm1.ova
</span></span><span class=line><span class=cl>vboxmanage unregistervm vm --delete
</span></span></code></pre></div><h2 id=mounted-volumes-aka-shared-folders>Mounted Volumes (aka Shared Folders)</h2><p>I don't actually remember what the Guest Additions CD contributes to this, but it seems we don't need it here.</p><p>First, we tell VirtualBox about the shared folder. We'll have to power off for this.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>vboxmanage sharedfolder add vm --name share --hostpath ~/Downloads/shared
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># we see it here</span>
</span></span><span class=line><span class=cl>vboxmanage showvminfo vm
</span></span></code></pre></div><p>Inside the VM, we get to pick where we want to mount the shared folder.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl><span class=c1># create the directory we want to mount at</span>
</span></span><span class=line><span class=cl>mkdir /home/user/shared
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># add ourselves to the vboxsf group</span>
</span></span><span class=line><span class=cl>sudo usermod -a -G vboxsf user
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>sudo mount -t vboxsf -o <span class=nv>uid</span><span class=o>=</span><span class=k>$(</span>id -u<span class=k>)</span>,gid<span class=o>=</span><span class=k>$(</span>id -g<span class=k>)</span>,rw share /home/user/shared  
</span></span></code></pre></div><p>Powering the VM off unmounts the shared folder, but we can also do it manually.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>sudo umount /home/user/shared
</span></span></code></pre></div><h2 id=snapshots>Snapshots</h2><p>I've not found many opportunities to use <a href=https://docs.docker.com/engine/reference/commandline/checkpoint/>docker checkpoint</a>, but <a href=https://docs.oracle.com/en/virtualization/virtualbox/6.0/user/vboxmanage-snapshot.html>snapshots</a> get a special mention because they're a very useful part of VirtualBox, and the interface is nice and intuitive.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>vboxmanage snapshot vm list
</span></span><span class=line><span class=cl>vboxmanage snapshot vm take s
</span></span><span class=line><span class=cl>vboxmanage snapshot vm restore s
</span></span><span class=line><span class=cl>vboxmanage snapshot vm delete s
</span></span></code></pre></div><h2 id=verdict>Verdict</h2><p>Certainly not as easy as Docker, but it's FOSS and easy enough to automate. It's a great alternative if you just can't get Docker to work or need more isolation or reproducibility.</p></content><p></p></main><footer></footer></body></html>