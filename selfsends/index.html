<!doctype html><html lang=en-US><head><meta http-equiv=X-Clacks-Overhead content="GNU Terry Pratchett"><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><link rel="shortcut icon" href=https://dariusf.github.io/images/favicon.png><title>Self-send projection | Darius Foo</title>
<meta name=title content="Self-send projection"><meta name=description content="$\gdef\kwproj{\mathbin{\upharpoonright}}$
$\gdef\gall#1#2#3{\forall #1 : #2 \cdot #3}$
$\gdef\galls#1#2#3#4{\forall #1 : #2 \setminus #3 \cdot #4}$
$\gdef\galle#1#2#3#4{\forall #1 : #2 \setminus \{#3\} \cdot #4}$
$\gdef\gtransmit#1#2#3{#1 \to #2:#3}$
$\gdef\kwpar{\mathrel{||}}$
$\gdef\spar#1#2{#1 \kwpar #2}$
$\gdef\lsend#1#2{\mathit{send}\ #1\ #2}$
$\gdef\lrecv#1{\mathit{recv\ #1}}$
Session types are a neat and fascinating formalism.
Intuitively, they are small languages for describing communication protocols.
Viewing these protocols as types, a type system may be used to check that a program implements a protocol correctly and has other nice properties, such as deadlock-freedom.
Unlike types which constrain data, session types are behavioral specifications and constrain what programs can do."><meta name=keywords content><meta property="og:url" content="https://dariusf.github.io/selfsends/"><meta property="og:site_name" content="Darius Foo"><meta property="og:title" content="Self-send projection"><meta property="og:description" content="$\gdef\kwproj{\mathbin{\upharpoonright}}$ $\gdef\gall#1#2#3{\forall #1 : #2 \cdot #3}$ $\gdef\galls#1#2#3#4{\forall #1 : #2 \setminus #3 \cdot #4}$ $\gdef\galle#1#2#3#4{\forall #1 : #2 \setminus \{#3\} \cdot #4}$ $\gdef\gtransmit#1#2#3{#1 \to #2:#3}$ $\gdef\kwpar{\mathrel{||}}$ $\gdef\spar#1#2{#1 \kwpar #2}$ $\gdef\lsend#1#2{\mathit{send}\ #1\ #2}$ $\gdef\lrecv#1{\mathit{recv\ #1}}$
Session types are a neat and fascinating formalism. Intuitively, they are small languages for describing communication protocols. Viewing these protocols as types, a type system may be used to check that a program implements a protocol correctly and has other nice properties, such as deadlock-freedom. Unlike types which constrain data, session types are behavioral specifications and constrain what programs can do."><meta property="og:locale" content="en_US"><meta property="og:type" content="article"><meta property="article:section" content="blog"><meta property="article:published_time" content="2023-11-28T10:33:45+08:00"><meta property="article:modified_time" content="2023-11-28T10:33:45+08:00"><meta property="og:image" content="https://dariusf.github.io/images/favicon.png"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://dariusf.github.io/images/favicon.png"><meta name=twitter:title content="Self-send projection"><meta name=twitter:description content="$\gdef\kwproj{\mathbin{\upharpoonright}}$ $\gdef\gall#1#2#3{\forall #1 : #2 \cdot #3}$ $\gdef\galls#1#2#3#4{\forall #1 : #2 \setminus #3 \cdot #4}$ $\gdef\galle#1#2#3#4{\forall #1 : #2 \setminus \{#3\} \cdot #4}$ $\gdef\gtransmit#1#2#3{#1 \to #2:#3}$ $\gdef\kwpar{\mathrel{||}}$ $\gdef\spar#1#2{#1 \kwpar #2}$ $\gdef\lsend#1#2{\mathit{send}\ #1\ #2}$ $\gdef\lrecv#1{\mathit{recv\ #1}}$
Session types are a neat and fascinating formalism. Intuitively, they are small languages for describing communication protocols. Viewing these protocols as types, a type system may be used to check that a program implements a protocol correctly and has other nice properties, such as deadlock-freedom. Unlike types which constrain data, session types are behavioral specifications and constrain what programs can do."><meta itemprop=name content="Self-send projection"><meta itemprop=description content="$\gdef\kwproj{\mathbin{\upharpoonright}}$ $\gdef\gall#1#2#3{\forall #1 : #2 \cdot #3}$ $\gdef\galls#1#2#3#4{\forall #1 : #2 \setminus #3 \cdot #4}$ $\gdef\galle#1#2#3#4{\forall #1 : #2 \setminus \{#3\} \cdot #4}$ $\gdef\gtransmit#1#2#3{#1 \to #2:#3}$ $\gdef\kwpar{\mathrel{||}}$ $\gdef\spar#1#2{#1 \kwpar #2}$ $\gdef\lsend#1#2{\mathit{send}\ #1\ #2}$ $\gdef\lrecv#1{\mathit{recv\ #1}}$
Session types are a neat and fascinating formalism. Intuitively, they are small languages for describing communication protocols. Viewing these protocols as types, a type system may be used to check that a program implements a protocol correctly and has other nice properties, such as deadlock-freedom. Unlike types which constrain data, session types are behavioral specifications and constrain what programs can do."><meta itemprop=datePublished content="2023-11-28T10:33:45+08:00"><meta itemprop=dateModified content="2023-11-28T10:33:45+08:00"><meta itemprop=wordCount content="1524"><meta itemprop=image content="https://dariusf.github.io/images/favicon.png"><meta name=referrer content="no-referrer-when-downgrade"><link rel=preconnect href=https://fonts.googleapis.com><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Fira+Code"><style>@media(prefers-color-scheme:light){:root{--bright-text-color:#222;--link-color:#3273dc;--link-visited-color:#6e4bbe;--background-color:#fff;--text-color:#444;--faded-text-color:#777;--blockquote-text-color:var(--bright-text-color);--faint-color:#ccc}.chroma{background-color:#fff}.chroma .x{}.chroma .err{color:#000}.chroma .lntd{vertical-align:top;padding:0;margin:0;border:0}.chroma .lntable{border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block}.chroma .hl{display:block;width:100%;background-color:#ffc}.chroma .lnt{margin-right:.4em;padding:0 .4em;color:#7f7f7f}.chroma .ln{margin-right:.4em;padding:0 .4em;color:#7f7f7f}.chroma .k{color:#a90d91}.chroma .kc{color:#a90d91}.chroma .kd{color:#a90d91}.chroma .kn{color:#a90d91}.chroma .kp{color:#a90d91}.chroma .kr{color:#a90d91}.chroma .kt{color:#a90d91}.chroma .n{color:#000}.chroma .na{color:#836c28}.chroma .nb{color:#a90d91}.chroma .bp{color:#5b269a}.chroma .nc{color:#3f6e75}.chroma .no{color:#000}.chroma .nd{color:#000}.chroma .ni{color:#000}.chroma .ne{color:#000}.chroma .nf{color:#000}.chroma .fm{color:#000}.chroma .nl{color:#000}.chroma .nn{color:#000}.chroma .nx{color:#000}.chroma .py{color:#000}.chroma .nt{color:#000}.chroma .nv{color:#000}.chroma .vc{color:#000}.chroma .vg{color:#000}.chroma .vi{color:#000}.chroma .vm{color:#000}.chroma .l{color:#1c01ce}.chroma .ld{color:#1c01ce}.chroma .s{color:#c41a16}.chroma .sa{color:#c41a16}.chroma .sb{color:#c41a16}.chroma .sc{color:#2300ce}.chroma .dl{color:#c41a16}.chroma .sd{color:#c41a16}.chroma .s2{color:#c41a16}.chroma .se{color:#c41a16}.chroma .sh{color:#c41a16}.chroma .si{color:#c41a16}.chroma .sx{color:#c41a16}.chroma .sr{color:#c41a16}.chroma .s1{color:#c41a16}.chroma .ss{color:#c41a16}.chroma .m{color:#1c01ce}.chroma .mb{color:#1c01ce}.chroma .mf{color:#1c01ce}.chroma .mh{color:#1c01ce}.chroma .mi{color:#1c01ce}.chroma .il{color:#1c01ce}.chroma .mo{color:#1c01ce}.chroma .o{color:#000}.chroma .ow{color:#000}.chroma .p{}.chroma .c{color:#177500}.chroma .ch{color:#177500}.chroma .cm{color:#177500}.chroma .c1{color:#177500}.chroma .cs{color:#177500}.chroma .cp{color:#633820}.chroma .cpf{color:#633820}.chroma .g{}.chroma .gd{}.chroma .ge{}.chroma .gr{}.chroma .gh{}.chroma .gi{}.chroma .go{}.chroma .gp{}.chroma .gs{}.chroma .gu{}.chroma .gt{}.chroma .gl{}.chroma .w{}}@media(prefers-color-scheme:dark){:root{--bright-text-color:#eee;--link-color:#8cc2dd;--link-visited-color:#b9a9e0;--background-color:#333;--text-color:#ddd;--faded-text-color:#aaa;--slightly-dimmer-text-color:#ccc;--blockquote-text-color:var(--slightly-dimmer-text-color);--faint-color:#666;color-scheme:dark}img.theme-affected{filter:invert(.8)}.chroma{color:#e2e4e5;background-color:#282a36}.chroma .x{}.chroma .err{color:#ff5c57}.chroma .lntd{vertical-align:top;padding:0;margin:0;border:0}.chroma .lntable{border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block}.chroma .hl{display:block;width:100%;background-color:#ffc}.chroma .lnt{margin-right:.4em;padding:0 .4em;color:#7f7f7f}.chroma .ln{margin-right:.4em;padding:0 .4em;color:#7f7f7f}.chroma .k{color:#ff6ac1}.chroma .kc{color:#ff6ac1}.chroma .kd{color:#ff5c57}.chroma .kn{color:#ff6ac1}.chroma .kp{color:#ff6ac1}.chroma .kr{color:#ff6ac1}.chroma .kt{color:#9aedfe}.chroma .n{}.chroma .na{color:#57c7ff}.chroma .nb{color:#ff5c57}.chroma .bp{}.chroma .nc{color:#f3f99d}.chroma .no{color:#ff9f43}.chroma .nd{color:#ff9f43}.chroma .ni{}.chroma .ne{}.chroma .nf{color:#57c7ff}.chroma .fm{}.chroma .nl{color:#ff5c57}.chroma .nn{}.chroma .nx{}.chroma .py{}.chroma .nt{color:#ff6ac1}.chroma .nv{color:#ff5c57}.chroma .vc{color:#ff5c57}.chroma .vg{color:#ff5c57}.chroma .vi{color:#ff5c57}.chroma .vm{}.chroma .l{}.chroma .ld{}.chroma .s{color:#5af78e}.chroma .sa{color:#5af78e}.chroma .sb{color:#5af78e}.chroma .sc{color:#5af78e}.chroma .dl{color:#5af78e}.chroma .sd{color:#5af78e}.chroma .s2{color:#5af78e}.chroma .se{color:#5af78e}.chroma .sh{color:#5af78e}.chroma .si{color:#5af78e}.chroma .sx{color:#5af78e}.chroma .sr{color:#5af78e}.chroma .s1{color:#5af78e}.chroma .ss{color:#5af78e}.chroma .m{color:#ff9f43}.chroma .mb{color:#ff9f43}.chroma .mf{color:#ff9f43}.chroma .mh{color:#ff9f43}.chroma .mi{color:#ff9f43}.chroma .il{color:#ff9f43}.chroma .mo{color:#ff9f43}.chroma .o{color:#ff6ac1}.chroma .ow{color:#ff6ac1}.chroma .p{}.chroma .c{color:#78787e}.chroma .ch{color:#78787e}.chroma .cm{color:#78787e}.chroma .c1{color:#78787e}.chroma .cs{color:#78787e}.chroma .cp{color:#78787e}.chroma .cpf{color:#78787e}.chroma .g{}.chroma .gd{color:#ff5c57}.chroma .ge{text-decoration:underline}.chroma .gr{color:#ff5c57}.chroma .gh{font-weight:700}.chroma .gi{font-weight:700}.chroma .go{color:#43454f}.chroma .gp{}.chroma .gs{font-style:italic}.chroma .gu{font-weight:700}.chroma .gt{}.chroma .gl{text-decoration:underline}.chroma .w{}}:root{--heading-font:ui-rounded, 'Hiragino Maru Gothic ProN', Quicksand, Comfortaa, Manjari, 'Arial Rounded MT', 'Arial Rounded MT Bold', Calibri, source-sans-pro, sans-serif;--text-font-size:17px;--text-font:system-ui, sans-serif}*{margin:0}body{}main{margin-top:.75em}sup{vertical-align:top;font-size:.7em}p{margin-bottom:1em}html{overflow-x:hidden;margin-right:calc(-1 * (100vw - 100%))}body{font-family:var(--text-font);font-size:var(--text-font-size);margin:auto;padding:20px;max-width:720px;text-align:left;background-color:var(--background-color);color:var(--text-color);word-wrap:break-word;overflow-wrap:break-word;line-height:1.5}h1,h2,h3,h4,h5,h6{font-family:var(--heading-font);color:var(--bright-text-color);font-weight:400}.blog-content h1,.blog-content h2,.blog-content h3,.blog-content h4,.blog-content h5,.blog-content h6{margin-top:.5em}hr,ul,ol{margin-bottom:.5em}div>iframe{margin-bottom:.5em}.blog-timestamp{font-size:.9em}.blog-content{margin-top:1.5em}a{color:var(--link-color);text-decoration:none}.title{color:var(--text-color);font-size:1.5em;font-family:var(--heading-font);margin-right:10px}nav a{margin-right:8px;font-family:var(--heading-font)}.paper-item svg{width:16px;vertical-align:text-bottom}.menuactive{text-decoration:underline;text-decoration-thickness:2px}table{width:100%}img{max-width:100%;margin:auto;margin-bottom:.5em;display:block}code{padding:2px 5px;margin-bottom:1em;font-family:Fira Code,monospace;font-size:14px;line-height:1.4}pre code{display:block;padding:20px;white-space:pre-wrap;overflow-x:auto}pre{border-radius:10px}p code,ol code,ul code,summary code{border-radius:4px;border:solid var(--faint-color)1px;margin:0 2px;padding:1px 2px}blockquote{border-left:1px solid #999;color:var(--blockquote-text-color);padding-left:20px;font-style:italic}footer{padding:25px;text-align:center}.deemphasize{color:var(--faded-text-color)}ul.blog-posts{list-style-type:none;padding:unset}ul.blog-posts li{display:flex}ul.blog-posts li span{flex:0 0 130px;text-align:right;margin-right:20px}ul.blog-posts li a:visited{color:var(--link-visited-color)}</style><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css integrity=sha384-n8MVd4RsNIU0tAv4ct0nTaAbDJwPJzDEaqSD1odI+WdtXRGWt2kTvGFasHpSy3SV crossorigin=anonymous><script defer src=https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js integrity=sha384-XjKyOOlGwcjNTAIQHIpgOno0Hl1YQqzUOEleOLALmuqehneUG+vnGctmUb0ZY0l8 crossorigin=anonymous></script><script>const macros={};function render(){renderMathInElement(document.body,{trust:!0,strict:!1,throwOnError:!1,delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1}],macros})}</script><script defer src=https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js integrity=sha384-+VBxd3r6XgURycqtZ117nYw44OOcIax56Z4dCRWbxyPt0Koah1uHoK0o4+/RRE05 crossorigin=anonymous onload=render()></script></head><body><header><a href=/><span class=title>Darius Foo</span></a><nav style=display:inline-block><a href=/blog/>Blog</a>
<a href=/research/>Research</a>
<a href=/work/>Work</a>
<a href=/other/>Other</a></nav></header><main><h1>Self-send projection</h1><div><time class=blog-timestamp datetime=2023-11-28 pubdate>28 Nov, 2023</time></div><div class=blog-content><p>$\gdef\kwproj{\mathbin{\upharpoonright}}$
$\gdef\gall#1#2#3{\forall #1 : #2 \cdot #3}$
$\gdef\galls#1#2#3#4{\forall #1 : #2 \setminus #3 \cdot #4}$
$\gdef\galle#1#2#3#4{\forall #1 : #2 \setminus \{#3\} \cdot #4}$
$\gdef\gtransmit#1#2#3{#1 \to #2:#3}$
$\gdef\kwpar{\mathrel{||}}$
$\gdef\spar#1#2{#1 \kwpar #2}$
$\gdef\lsend#1#2{\mathit{send}\ #1\ #2}$
$\gdef\lrecv#1{\mathit{recv\ #1}}$</p><p><a href=https://wen.works/2020/12/17/an-introduction-to-session-types/>Session types</a> are a neat and fascinating formalism.
Intuitively, they are small languages for describing communication protocols.
Viewing these protocols as types, a type system may be used to check that a program implements a protocol correctly and has other nice properties, such as deadlock-freedom.
Unlike types which constrain data, session types are <em>behavioral</em> specifications and constrain what <em>programs</em> can <em>do</em>.</p><p><em>Multiparty session types</em> concern more than two communicating parties and are usually written in <a href=https://en.wikipedia.org/wiki/Security_protocol_notation>"Alice & Bob notation"</a>, specifying a protocol from a so-called <em>global</em> perspective.</p><p>Here's the syntax of a tiny MPST language.</p>$$G ::= a \to b: m\ |\ G; G$$<p>We can write a type such as</p>$$a \to b: m; \\\ b \to a: n$$<p>which specifies a protocol where party $a$ sends the message $m$ to party $b$, and $b$ <em>then</em> replies with message $n$.</p><p>Say we have a program that implements party $a$, and we want to check it against the protocol.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kd>function</span> <span class=nx>a</span><span class=p>(</span><span class=nx>m</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>Send</span><span class=p>(</span><span class=nx>b</span><span class=p>,</span> <span class=nx>m</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=kd>let</span> <span class=nx>n</span> <span class=o>=</span> <span class=nx>Receive</span><span class=p>(</span><span class=nx>b</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>One approach is to split the global type into two <em>local</em> halves, then check the program against the half for $a$.
This splitting operation is called <em>projection</em> because we are keeping only a slice or subpart of the behavior of the overall system, or some subsequences of its execution traces, etc.</p><p>Here is a tiny language of local types.</p>$$L ::= \mathit{send}\ a\ m\ |\ \mathit{recv}\ b\ |\ L; L$$<p>The projections for $a$ and $b$ would be:</p>$$L_a : \mathit{send}\ b\ m; \mathit{recv}\ b$$$$L_b : \mathit{recv}\ a; \mathit{send}\ a\ n$$<p>How do we compute such a projection?</p>$$(G_1; G_2) \upharpoonright p \equiv (G_1 \upharpoonright p); (G_2 \upharpoonright p)$$$$a \to b: m \upharpoonright a \equiv \mathit{send}\ b$$$$a \to b: m \upharpoonright b \equiv \mathit{recv}\ a$$<p>The rules are very simple for this tiny language:
projection is "pushed through" sequential composition,
and if we are projecting $\to$ with respect to a given party $p$ and we see $p$ is the sender, the result is a $\mathit{send}$, otherwise it is a $\mathit{recv}$.</p><h2 id=multicasts>Multicasts</h2><p>It would be amazing if we could model a real-world protocol like <a href=https://raft.github.io/>Raft</a> as a type and have the conformance of an implementation checked automatically and decideably!</p><p>We are still quite a long way off.
One major missing ingredient is the ability to express a multicast, the first step in leader election.</p><p>Let's extend our language of multiparty session types with a way to talk about communication that happens uniformly across a set of parties, which we'll call a <em>role</em>. We'll use the symbol $\forall$ for it, as an analogy to universal quantification.
We'll also add parallel composition $||$.</p>$$G ::= a \to b: m\ |\ G; G \ |\ G \mathbin{||}G \ |\ \forall x:S \cdot G$$<p>We can now write a type like</p>$$\forall p:\mathit{ps} \cdot c \to p: \mathit{prepare}$$<p>which would suffice for the start of a <a href=https://en.wikipedia.org/wiki/Two-phase_commit_protocol#Basic_algorithm>commit protocol</a>.
Notice that $\forall$ is just n-ary parallel composition for each party in the role.</p><p>Projection should give us</p>$$L_c : \forall p:ps \cdot \mathit{send}\ p\ \mathit{prepare}$$$$L_p : \mathit{recv}\ c$$<p>which matches our intuition neatly:</p><ul><li>when we project with respect to the set of coordinators, we want to get a local type which says what <em>one arbitrary</em> coordinator does. Since this coordinator isn't in $ps$ but interacts with every member of $ps$, the quantifier should remain in the local type $L_c$, which correctly captures the multicast.</li><li>when we project with respect to the set of participants, since our arbitrary participant is in $ps$, it is involved in <em>only one</em> $\mathit{recv}$, so the quantifier should disappear.</li></ul><p>Here is the projection function for $\forall$, which is now defined with respect to a role $S$.</p>$$\forall x:S \cdot G \upharpoonright S \equiv G \upharpoonright S$$$$\forall x:S \cdot G \upharpoonright S' \equiv \forall x:S \cdot (G \upharpoonright S)\\\ (S \neq S')$$<h2 id=self-sends>Self-sends</h2><p>For leader election, however, we quickly run into a problem.</p>$$\forall s:\mathit{servers} \cdot s \to s: \mathit{RequestVote}$$<p>The rules from before don't help us much - do we keep the quantifier or not?
Also, it seems that a server should both $\mathit{send}$ and $\mathit{recv}$, but since there is only one role to project with respect to, we can only have one of those.</p><p>We call this sort of intra-role communication a <em>self-send</em>.</p><p>The paper <a href=http://mrg.doc.ic.ac.uk/publications/dynamic-multirole-session-types/dynamic-multirole-session-types.pdf>Dynamic Multirole Session Types (2013)</a> proposes an elegant solution, based on the following observation, or lemma: given an arbitrary party $z$ in role $S$, the following types are equivalent.</p>$$\forall x:S\cdot G\\\ \equiv\\\ G[z/x]\ ||\ \forall x:S\setminus \\{z\\}\cdot G$$<p>That is, a universal quantification is just the parallel composition of "what $z$ does" and "what everyone else does".</p><p>The solution is thus to project the parallel composition instead,
with respect to <em>the party</em> $z$, instead of "an arbitrary party of role $S$".
Before, these were equivalent because we didn't need to be sensitive to which party in a role we were concerned with.</p><p>For explicitness, we'll refine $\forall$ with a set of exclusions $e$, which may be empty.</p>$$G ::= ...\ |\ \forall x:S\setminus e \cdot G$$<p>There are two cases for $\forall$.</p><ol><li><p>If $z \in S$ but $z \notin e$, i.e. it is possible that the quantifier involves $z$, we first apply the lemma above, which separates the behavior of $z$ from that of everyone else in $S$, then recursively project on both sides.</p>$$(\forall x:S\setminus e\cdot G) \kwproj z \equiv (G[z/x] \kwproj z) \kwpar (\forall x:S\setminus (\\{z\\}\cup e)\cdot (G \kwproj z))$$<p>Intuitively, the left arm is what $z$ does, while the right is <em>what other parties do to</em> $z$.
$z$ is involved in both sides of the $\kwpar$ precisely because members of the same set being quantified over are interacting.
If we were projecting a protocol without a self-send, the right arm would be unobservable and disappear, and we would the same result as the projection function from the previous section!</p></li><li><p>Otherwise (if $z \notin S$ or $z \in e$), we keep the quantifier and project under it, for the same reason as before: $z$ may interact with the parties of role $S$.</p>$$(\forall x:S\setminus e\cdot G) \kwproj z \equiv \forall x:S\setminus e\cdot (G \kwproj z)$$</li></ol><p>The extension for $\to$ is simple: since we are projecting with respect to $z$, we can just check if an occurrence of communication involves $z$ directly. If it involves $z$ as both sender and receiver, we correspondingly produce both $\mathit{send}$ and $\mathit{recv}$.</p><p>Let's walk through an example.</p>$$\begin{array}{rll}
& \gall{x}{C}{\galle{y}{C}{x}{\gtransmit{x}{y}{m}}} \kwproj z & (1) \\
= & (\galle{y}{C}{z}{\gtransmit{z}{y}{m}} \kwproj z) & (2) \\
& \quad \kwpar (\galle{x}{C}{z}{\galle{y}{C}{x}{\gtransmit{x}{y}{m}}} \kwproj z) \\
= & (\galle{y}{C}{z}{(\gtransmit{z}{y}{m} \kwproj z)}) & (3) \\
& \quad \kwpar (\galle{x}{C}{z}{(\galle{y}{C}{x}{\gtransmit{x}{y}{m}} \kwproj z)}) \\
= & (\galle{y}{C}{z}{\lsend{y}{m}}) & (4) \\
& \quad \kwpar (\galle{x}{C}{z}{(\gtransmit{x}{z}{m} \kwproj z} \\
& \qquad \kwpar (\galle{y}{C}{z,x}{\gtransmit{x}{y}{m}} \kwproj z))) \\
= & (\galle{y}{C}{z}{\lsend{y}{m}}) & (5) \\
& \quad \kwpar (\galle{x}{C}{z}{(\lrecv{x}} \\
& \qquad \kwpar (\galle{y}{C}{z,x}{(\gtransmit{x}{y}{m} \kwproj z)}))) \\
= & (\galle{y}{C}{z}{\lsend{y}{m}}) & (6) \\
& \quad \kwpar (\galle{x}{C}{z}{\lrecv{x}}) \\
\end{array}$$<p>The type in (1) represents a protocol where every party in role $C$ pings every other, sending a message and receiving a reply.</p><p>In (2), $z$ could be in $C$, so we apply $\forall$ case 1.
In the left arm, we push the projection inward until we are able to project the communication into a $\mathit{send}$ (4).
In the right arm, we add $z$ to the set of exclusions for the quantifier for $x$ and continue (3), but since $y$ may also be $z$, we find ourselves having to apply case 1 again (4).
The left arm there projects to a receive (5), while the right is a no-op, as the communication between $x$ and $y$ is unobservable to $z$.
This gives us the protocol at (6), which says exactly what we started out with.</p><p>The title of the paper mentioned earlier should make sense now.
Protocols with self-sends and universal quantification are "multirole" because parties may act as both sender and receiver, and have two distinct classes of behaviors.</p><p>The paper uses "dynamic" in the sense that parties can join and leave, and the $\forall$ thus specifies the behavior of a possibly infinite set of parties. We aren't (yet?) concerned with this aspect.
We are, however, concerned with two different senses of "dynamic", which is that roles may be <em>computed</em> in the course of the protocol, or dynamic changes; we return to this shortly.</p><h1 id=choreographic-pluscal>Choreographic PlusCal</h1><p>This is the heart of the projection function that is implemented in <a href=/cpluscal>Choreographic PlusCal</a>, a choreographic specification language I worked on.</p><p>It brings the succinctness and clarity of session types to a much more expressive specification language, one which scales up to real-world distributed protocols, which compute and branch, and are much closer to algorithms than sequences of transmissions.</p><p>The tradeoff is that Choreographic PlusCal models cannot be verified by simple type checking.
Even properties such as deadlock-freedom cannot be guaranteed with things like <code>await FALSE;</code> in the language.
Fortunately, being a PlusCal dialect, it has access to TLC, making it an exceedingly practical point in the design space.</p></div><p></p></main><footer></footer></body></html>